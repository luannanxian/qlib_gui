
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
<div itemprop="articleBody">
<section id="api-reference">
<span id="api"></span><h1>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this heading"></a></h1>
<p>Here you can find all <code class="docutils literal notranslate"><span class="pre">Qlib</span></code> interfaces.</p>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this heading"></a></h2>
<section id="module-qlib.data.data">
<span id="provider"></span><h3>Provider<a class="headerlink" href="#module-qlib.data.data" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.ProviderBackendMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">ProviderBackendMixin</span></span><a class="headerlink" href="#qlib.data.data.ProviderBackendMixin" title="Permalink to this definition"></a></dt>
<dd><p>This helper class tries to make the provider based on storage backend more convenient
It is not necessary to inherent this class if that provider don’t rely on the backend storage</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.CalendarProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">CalendarProvider</span></span><a class="headerlink" href="#qlib.data.data.CalendarProvider" title="Permalink to this definition"></a></dt>
<dd><p>Calendar provider base class</p>
<p>Provide calendar data.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.CalendarProvider.calendar">
<span class="sig-name descname"><span class="pre">calendar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">future</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.CalendarProvider.calendar" title="Permalink to this definition"></a></dt>
<dd><p>Get calendar of certain market in given time range.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency, available: year/quarter/month/week/day.</p></li>
<li><p><strong>future</strong> (<em>bool</em>) – whether including future trading day.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>calendar list</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.CalendarProvider.locate_index">
<span class="sig-name descname"><span class="pre">locate_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">future</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.CalendarProvider.locate_index" title="Permalink to this definition"></a></dt>
<dd><p>Locate the start time index and end time index in a calendar under certain frequency.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_time</strong> (<em>pd.Timestamp</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>pd.Timestamp</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency, available: year/quarter/month/week/day.</p></li>
<li><p><strong>future</strong> (<em>bool</em>) – whether including future trading day.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>pd.Timestamp</em> – the real start time.</p></li>
<li><p><em>pd.Timestamp</em> – the real end time.</p></li>
<li><p><em>int</em> – the index of start time.</p></li>
<li><p><em>int</em> – the index of end time.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.CalendarProvider.load_calendar">
<span class="sig-name descname"><span class="pre">load_calendar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">future</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.CalendarProvider.load_calendar" title="Permalink to this definition"></a></dt>
<dd><p>Load original calendar timestamp from file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>freq</strong> (<em>str</em>) – frequency of read calendar file.</p></li>
<li><p><strong>future</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of timestamps</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.InstrumentProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">InstrumentProvider</span></span><a class="headerlink" href="#qlib.data.data.InstrumentProvider" title="Permalink to this definition"></a></dt>
<dd><p>Instrument provider base class</p>
<p>Provide instrument data.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.InstrumentProvider.instruments">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">instruments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">market</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_pipe</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.InstrumentProvider.instruments" title="Permalink to this definition"></a></dt>
<dd><p>Get the general config dictionary for a base market adding several dynamic filters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>market</strong> (<em>Union</em><em>[</em><em>List</em><em>, </em><em>str</em><em>]</em>) – <dl class="simple">
<dt>str:</dt><dd><p>market/industry/index shortname, e.g. all/sse/szse/sse50/csi300/csi500.</p>
</dd>
<dt>list:</dt><dd><p>[“ID1”, “ID2”]. A list of stocks</p>
</dd>
</dl>
</p></li>
<li><p><strong>filter_pipe</strong> (<em>list</em>) – the list of dynamic filters.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul>
<li><p><strong>dict</strong> (<em>if isinstance(market, str)</em>) – dict of stockpool config.</p>
<p>{<cite>market</cite> =&gt; base market name, <cite>filter_pipe</cite> =&gt; list of filters}</p>
<p>example :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">'market'</span><span class="p">:</span> <span class="s1">'csi500'</span><span class="p">,</span>
<span class="s1">'filter_pipe'</span><span class="p">:</span> <span class="p">[{</span><span class="s1">'filter_type'</span><span class="p">:</span> <span class="s1">'ExpressionDFilter'</span><span class="p">,</span>
<span class="s1">'rule_expression'</span><span class="p">:</span> <span class="s1">'$open&lt;40'</span><span class="p">,</span>
<span class="s1">'filter_start_time'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">'filter_end_time'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">'keep'</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
<span class="p">{</span><span class="s1">'filter_type'</span><span class="p">:</span> <span class="s1">'NameDFilter'</span><span class="p">,</span>
<span class="s1">'name_rule_re'</span><span class="p">:</span> <span class="s1">'SH[0-9]</span><span class="si">{4}</span><span class="s1">55'</span><span class="p">,</span>
<span class="s1">'filter_start_time'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">'filter_end_time'</span><span class="p">:</span> <span class="kc">None</span><span class="p">}]}</span>
</pre></div>
</div>
</li>
<li><p><strong>list</strong> (<em>if isinstance(market, list)</em>) – just return the original list directly.
NOTE: this will make the instruments compatible with more cases. The user code will be simpler.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.InstrumentProvider.list_instruments">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">list_instruments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.InstrumentProvider.list_instruments" title="Permalink to this definition"></a></dt>
<dd><p>List the instruments based on a certain stockpool config.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>dict</em>) – stockpool config.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>as_list</strong> (<em>bool</em>) – return instruments as list or dict.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>instruments list or dictionary with time spans</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict or list</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.FeatureProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">FeatureProvider</span></span><a class="headerlink" href="#qlib.data.data.FeatureProvider" title="Permalink to this definition"></a></dt>
<dd><p>Feature provider class</p>
<p>Provide feature data.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.FeatureProvider.feature">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.FeatureProvider.feature" title="Permalink to this definition"></a></dt>
<dd><p>Get feature data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instrument</strong> (<em>str</em>) – a certain instrument.</p></li>
<li><p><strong>field</strong> (<em>str</em>) – a certain field of feature.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency, available: year/quarter/month/week/day.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>data of a certain feature</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.PITProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">PITProvider</span></span><a class="headerlink" href="#qlib.data.data.PITProvider" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.PITProvider.period_feature">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">period_feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="headerlink" href="#qlib.data.data.PITProvider.period_feature" title="Permalink to this definition"></a></dt>
<dd><p>get the historical periods data series between <cite>start_index</cite> and <cite>end_index</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_index</strong> (<em>int</em>) – start_index is a relative index to the latest period to cur_time</p></li>
<li><p><strong>end_index</strong> (<em>int</em>) – end_index is a relative index to the latest period to cur_time
in most cases, the start_index and end_index will be a non-positive values
For example, start_index == -3 end_index == 0 and current period index is cur_idx,
then the data between [start_index + cur_idx, end_index + cur_idx] will be retrieved.</p></li>
<li><p><strong>period</strong> (<em>int</em>) – This is used for query specific period.
The period is represented with int in Qlib. (e.g. 202001 may represent the first quarter in 2020)
NOTE: <cite>period</cite>  will override <cite>start_index</cite> and <cite>end_index</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The index will be integers to indicate the periods of the data
An typical examples will be
TODO</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>FileNotFoundError</strong> – This exception will be raised if the queried data do not exist.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.ExpressionProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">ExpressionProvider</span></span><a class="headerlink" href="#qlib.data.data.ExpressionProvider" title="Permalink to this definition"></a></dt>
<dd><p>Expression provider class</p>
<p>Provide Expression data.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.ExpressionProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.ExpressionProvider.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.ExpressionProvider.expression">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">expression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="headerlink" href="#qlib.data.data.ExpressionProvider.expression" title="Permalink to this definition"></a></dt>
<dd><p>Get Expression data.</p>
<p>The responsibility of <cite>expression</cite>
- parse the <cite>field</cite> and <cite>load</cite> the according data.
- When loading the data, it should handle the time dependency of the data. <cite>get_expression_instance</cite> is commonly used in this method</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instrument</strong> (<em>str</em>) – a certain instrument.</p></li>
<li><p><strong>field</strong> (<em>str</em>) – a certain field of feature.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency, available: year/quarter/month/week/day.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>data of a certain expression</p>
<p>The data has two types of format</p>
<ol class="arabic">
<li><p>expression with datetime index</p></li>
<li><p>expression with integer index</p>
<blockquote>
<div><ul class="simple">
<li><p>because the datetime is not as good as</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.DatasetProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">DatasetProvider</span></span><a class="headerlink" href="#qlib.data.data.DatasetProvider" title="Permalink to this definition"></a></dt>
<dd><p>Dataset provider class</p>
<p>Provide Dataset data.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.DatasetProvider.dataset">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.DatasetProvider.dataset" title="Permalink to this definition"></a></dt>
<dd><p>Get dataset data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>list</em><em> or </em><em>dict</em>) – list/dict of instruments or dict of stockpool config.</p></li>
<li><p><strong>fields</strong> (<em>list</em>) – list of feature instances.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency.</p></li>
<li><p><strong>inst_processors</strong> (<em>Iterable</em><em>[</em><em>Union</em><em>[</em><em>dict</em><em>, </em><em>InstProcessor</em><em>]</em><em>]</em>) – the operations performed on each instrument</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a pandas dataframe with &lt;instrument, datetime&gt; index.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.DatasetProvider.get_instruments_d">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_instruments_d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.DatasetProvider.get_instruments_d" title="Permalink to this definition"></a></dt>
<dd><p>Parse different types of input instruments to output instruments_d
Wrong format of input instruments will lead to exception.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.DatasetProvider.get_column_names">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_column_names</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.DatasetProvider.get_column_names" title="Permalink to this definition"></a></dt>
<dd><p>Get column names from input fields</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.DatasetProvider.dataset_processor">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dataset_processor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments_d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.DatasetProvider.dataset_processor" title="Permalink to this definition"></a></dt>
<dd><p>Load and process the data, return the data set.
- default using multi-kernel method.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.DatasetProvider.inst_calculator">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">inst_calculator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spans</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.DatasetProvider.inst_calculator" title="Permalink to this definition"></a></dt>
<dd><p>Calculate the expressions for <strong>one</strong> instrument, return a df result.
If the expression has been calculated before, load from cache.</p>
<p>return value: A data frame with index ‘datetime’ and other data columns.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.LocalCalendarProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">LocalCalendarProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalCalendarProvider" title="Permalink to this definition"></a></dt>
<dd><p>Local calendar data provider class</p>
<p>Provide calendar data from local data source.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalCalendarProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalCalendarProvider.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalCalendarProvider.load_calendar">
<span class="sig-name descname"><span class="pre">load_calendar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">future</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalCalendarProvider.load_calendar" title="Permalink to this definition"></a></dt>
<dd><p>Load original calendar timestamp from file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>freq</strong> (<em>str</em>) – frequency of read calendar file.</p></li>
<li><p><strong>future</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of timestamps</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.LocalInstrumentProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">LocalInstrumentProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalInstrumentProvider" title="Permalink to this definition"></a></dt>
<dd><p>Local instrument data provider class</p>
<p>Provide instrument data from local data source.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalInstrumentProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.data.data.LocalInstrumentProvider.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalInstrumentProvider.list_instruments">
<span class="sig-name descname"><span class="pre">list_instruments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalInstrumentProvider.list_instruments" title="Permalink to this definition"></a></dt>
<dd><p>List the instruments based on a certain stockpool config.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>dict</em>) – stockpool config.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>as_list</strong> (<em>bool</em>) – return instruments as list or dict.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>instruments list or dictionary with time spans</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict or list</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.LocalFeatureProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">LocalFeatureProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalFeatureProvider" title="Permalink to this definition"></a></dt>
<dd><p>Local feature data provider class</p>
<p>Provide feature data from local data source.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalFeatureProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalFeatureProvider.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalFeatureProvider.feature">
<span class="sig-name descname"><span class="pre">feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalFeatureProvider.feature" title="Permalink to this definition"></a></dt>
<dd><p>Get feature data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instrument</strong> (<em>str</em>) – a certain instrument.</p></li>
<li><p><strong>field</strong> (<em>str</em>) – a certain field of feature.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency, available: year/quarter/month/week/day.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>data of a certain feature</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.LocalPITProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">LocalPITProvider</span></span><a class="headerlink" href="#qlib.data.data.LocalPITProvider" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalPITProvider.period_feature">
<span class="sig-name descname"><span class="pre">period_feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">period</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalPITProvider.period_feature" title="Permalink to this definition"></a></dt>
<dd><p>get the historical periods data series between <cite>start_index</cite> and <cite>end_index</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_index</strong> (<em>int</em>) – start_index is a relative index to the latest period to cur_time</p></li>
<li><p><strong>end_index</strong> (<em>int</em>) – end_index is a relative index to the latest period to cur_time
in most cases, the start_index and end_index will be a non-positive values
For example, start_index == -3 end_index == 0 and current period index is cur_idx,
then the data between [start_index + cur_idx, end_index + cur_idx] will be retrieved.</p></li>
<li><p><strong>period</strong> (<em>int</em>) – This is used for query specific period.
The period is represented with int in Qlib. (e.g. 202001 may represent the first quarter in 2020)
NOTE: <cite>period</cite>  will override <cite>start_index</cite> and <cite>end_index</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The index will be integers to indicate the periods of the data
An typical examples will be
TODO</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>FileNotFoundError</strong> – This exception will be raised if the queried data do not exist.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.LocalExpressionProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">LocalExpressionProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time2idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalExpressionProvider" title="Permalink to this definition"></a></dt>
<dd><p>Local expression data provider class</p>
<p>Provide expression data from local data source.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalExpressionProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time2idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalExpressionProvider.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalExpressionProvider.expression">
<span class="sig-name descname"><span class="pre">expression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalExpressionProvider.expression" title="Permalink to this definition"></a></dt>
<dd><p>Get Expression data.</p>
<p>The responsibility of <cite>expression</cite>
- parse the <cite>field</cite> and <cite>load</cite> the according data.
- When loading the data, it should handle the time dependency of the data. <cite>get_expression_instance</cite> is commonly used in this method</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instrument</strong> (<em>str</em>) – a certain instrument.</p></li>
<li><p><strong>field</strong> (<em>str</em>) – a certain field of feature.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency, available: year/quarter/month/week/day.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>data of a certain expression</p>
<p>The data has two types of format</p>
<ol class="arabic">
<li><p>expression with datetime index</p></li>
<li><p>expression with integer index</p>
<blockquote>
<div><ul class="simple">
<li><p>because the datetime is not as good as</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.LocalDatasetProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">LocalDatasetProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">align_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalDatasetProvider" title="Permalink to this definition"></a></dt>
<dd><p>Local dataset data provider class</p>
<p>Provide dataset data from local data source.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalDatasetProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">align_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalDatasetProvider.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>align_time</strong> (<em>bool</em>) – <p>Will we align the time to calendar
the frequency is flexible in some dataset and can’t be aligned.
For the data with fixed frequency with a shared calendar, the align data to the calendar will provides following benefits</p>
<ul class="simple">
<li><p>Align queries to the same parameters, so the cache can be shared.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalDatasetProvider.dataset">
<span class="sig-name descname"><span class="pre">dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalDatasetProvider.dataset" title="Permalink to this definition"></a></dt>
<dd><p>Get dataset data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>list</em><em> or </em><em>dict</em>) – list/dict of instruments or dict of stockpool config.</p></li>
<li><p><strong>fields</strong> (<em>list</em>) – list of feature instances.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency.</p></li>
<li><p><strong>inst_processors</strong> (<em>Iterable</em><em>[</em><em>Union</em><em>[</em><em>dict</em><em>, </em><em>InstProcessor</em><em>]</em><em>]</em>) – the operations performed on each instrument</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a pandas dataframe with &lt;instrument, datetime&gt; index.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalDatasetProvider.multi_cache_walker">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">multi_cache_walker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalDatasetProvider.multi_cache_walker" title="Permalink to this definition"></a></dt>
<dd><p>This method is used to prepare the expression cache for the client.
Then the client will load the data from expression cache by itself.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalDatasetProvider.cache_walker">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cache_walker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalDatasetProvider.cache_walker" title="Permalink to this definition"></a></dt>
<dd><p>If the expressions of one instrument haven’t been calculated before,
calculate it and write it into expression cache.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.ClientCalendarProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">ClientCalendarProvider</span></span><a class="headerlink" href="#qlib.data.data.ClientCalendarProvider" title="Permalink to this definition"></a></dt>
<dd><p>Client calendar data provider class</p>
<p>Provide calendar data by requesting data from server as a client.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.ClientCalendarProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.ClientCalendarProvider.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.ClientCalendarProvider.calendar">
<span class="sig-name descname"><span class="pre">calendar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">future</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.ClientCalendarProvider.calendar" title="Permalink to this definition"></a></dt>
<dd><p>Get calendar of certain market in given time range.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency, available: year/quarter/month/week/day.</p></li>
<li><p><strong>future</strong> (<em>bool</em>) – whether including future trading day.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>calendar list</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.ClientInstrumentProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">ClientInstrumentProvider</span></span><a class="headerlink" href="#qlib.data.data.ClientInstrumentProvider" title="Permalink to this definition"></a></dt>
<dd><p>Client instrument data provider class</p>
<p>Provide instrument data by requesting data from server as a client.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.ClientInstrumentProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.ClientInstrumentProvider.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.ClientInstrumentProvider.list_instruments">
<span class="sig-name descname"><span class="pre">list_instruments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.ClientInstrumentProvider.list_instruments" title="Permalink to this definition"></a></dt>
<dd><p>List the instruments based on a certain stockpool config.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>dict</em>) – stockpool config.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>as_list</strong> (<em>bool</em>) – return instruments as list or dict.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>instruments list or dictionary with time spans</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict or list</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.ClientDatasetProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">ClientDatasetProvider</span></span><a class="headerlink" href="#qlib.data.data.ClientDatasetProvider" title="Permalink to this definition"></a></dt>
<dd><p>Client dataset data provider class</p>
<p>Provide dataset data by requesting data from server as a client.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.ClientDatasetProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.ClientDatasetProvider.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.ClientDatasetProvider.dataset">
<span class="sig-name descname"><span class="pre">dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">disk_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_uri</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.ClientDatasetProvider.dataset" title="Permalink to this definition"></a></dt>
<dd><p>Get dataset data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>list</em><em> or </em><em>dict</em>) – list/dict of instruments or dict of stockpool config.</p></li>
<li><p><strong>fields</strong> (<em>list</em>) – list of feature instances.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – time frequency.</p></li>
<li><p><strong>inst_processors</strong> (<em>Iterable</em><em>[</em><em>Union</em><em>[</em><em>dict</em><em>, </em><em>InstProcessor</em><em>]</em><em>]</em>) – the operations performed on each instrument</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a pandas dataframe with &lt;instrument, datetime&gt; index.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.BaseProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">BaseProvider</span></span><a class="headerlink" href="#qlib.data.data.BaseProvider" title="Permalink to this definition"></a></dt>
<dd><p>Local provider class
It is a set of interface that allow users to access data.
Because PITD is not exposed publicly to users, so it is not included in the interface.</p>
<p>To keep compatible with old qlib provider.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.BaseProvider.features">
<span class="sig-name descname"><span class="pre">features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">disk_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.BaseProvider.features" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>disk_cache</strong> (<em>int</em>) – whether to skip(0)/use(1)/replace(2) disk_cache</p>
</dd>
</dl>
<p>This function will try to use cache method which has a keyword <cite>disk_cache</cite>,
and will use provider method if a type error is raised because the DatasetD instance
is a provider class.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.LocalProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">LocalProvider</span></span><a class="headerlink" href="#qlib.data.data.LocalProvider" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.LocalProvider.features_uri">
<span class="sig-name descname"><span class="pre">features_uri</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">disk_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.LocalProvider.features_uri" title="Permalink to this definition"></a></dt>
<dd><p>Return the uri of the generated cache of features/dataset</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>disk_cache</strong> – </p></li>
<li><p><strong>instruments</strong> – </p></li>
<li><p><strong>fields</strong> – </p></li>
<li><p><strong>start_time</strong> – </p></li>
<li><p><strong>end_time</strong> – </p></li>
<li><p><strong>freq</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.data.ClientProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">ClientProvider</span></span><a class="headerlink" href="#qlib.data.data.ClientProvider" title="Permalink to this definition"></a></dt>
<dd><p>Client Provider</p>
<p>Requesting data from server as a client. Can propose requests:</p>
<blockquote>
<div><ul class="simple">
<li><p>Calendar : Directly respond a list of calendars</p></li>
<li><p>Instruments (without filter): Directly respond a list/dict of instruments</p></li>
<li><p>Instruments (with filters):  Respond a list/dict of instruments</p></li>
<li><p>Features : Respond a cache uri</p></li>
</ul>
</div></blockquote>
<p>The general workflow is described as follows:
When the user use client provider to propose a request, the client provider will connect the server and send the request. The client will start to wait for the response. The response will be made instantly indicating whether the cache is available. The waiting procedure will terminate only when the client get the response saying <cite>feature_available</cite> is true.
<cite>BUG</cite> : Everytime we make request for certain data we need to connect to the server, wait for the response and disconnect from it. We can’t make a sequence of requests within one connection. You can refer to <a class="reference external" href="https://python-socketio.readthedocs.io/en/latest/client.html">https://python-socketio.readthedocs.io/en/latest/client.html</a> for documentation of python-socketIO client.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.data.ClientProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.ClientProvider.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.data.data.CalendarProviderWrapper">
<span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">CalendarProviderWrapper</span></span><a class="headerlink" href="#qlib.data.data.CalendarProviderWrapper" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.data.data.CalendarProvider" title="qlib.data.data.CalendarProvider"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalendarProvider</span></code></a></p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.data.data.InstrumentProviderWrapper">
<span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">InstrumentProviderWrapper</span></span><a class="headerlink" href="#qlib.data.data.InstrumentProviderWrapper" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.data.data.InstrumentProvider" title="qlib.data.data.InstrumentProvider"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstrumentProvider</span></code></a></p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.data.data.FeatureProviderWrapper">
<span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">FeatureProviderWrapper</span></span><a class="headerlink" href="#qlib.data.data.FeatureProviderWrapper" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.data.data.FeatureProvider" title="qlib.data.data.FeatureProvider"><code class="xref py py-class docutils literal notranslate"><span class="pre">FeatureProvider</span></code></a></p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.data.data.PITProviderWrapper">
<span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">PITProviderWrapper</span></span><a class="headerlink" href="#qlib.data.data.PITProviderWrapper" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.data.data.PITProvider" title="qlib.data.data.PITProvider"><code class="xref py py-class docutils literal notranslate"><span class="pre">PITProvider</span></code></a></p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.data.data.ExpressionProviderWrapper">
<span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">ExpressionProviderWrapper</span></span><a class="headerlink" href="#qlib.data.data.ExpressionProviderWrapper" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.data.data.ExpressionProvider" title="qlib.data.data.ExpressionProvider"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpressionProvider</span></code></a></p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.data.data.DatasetProviderWrapper">
<span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">DatasetProviderWrapper</span></span><a class="headerlink" href="#qlib.data.data.DatasetProviderWrapper" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.data.data.DatasetProvider" title="qlib.data.data.DatasetProvider"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatasetProvider</span></code></a></p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.data.data.BaseProviderWrapper">
<span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">BaseProviderWrapper</span></span><a class="headerlink" href="#qlib.data.data.BaseProviderWrapper" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.data.data.BaseProvider" title="qlib.data.data.BaseProvider"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseProvider</span></code></a></p>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.data.data.register_all_wrappers">
<span class="sig-prename descclassname"><span class="pre">qlib.data.data.</span></span><span class="sig-name descname"><span class="pre">register_all_wrappers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">C</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.data.register_all_wrappers" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</section>
<section id="module-qlib.data.filter">
<span id="filter"></span><h3>Filter<a class="headerlink" href="#module-qlib.data.filter" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.filter.BaseDFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.filter.</span></span><span class="sig-name descname"><span class="pre">BaseDFilter</span></span><a class="headerlink" href="#qlib.data.filter.BaseDFilter" title="Permalink to this definition"></a></dt>
<dd><p>Dynamic Instruments Filter Abstract class</p>
<p>Users can override this class to construct their own filter</p>
<p>Override __init__ to input filter regulations</p>
<p>Override filter_main to use the regulations to filter instruments</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.BaseDFilter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.BaseDFilter.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.BaseDFilter.from_config">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.BaseDFilter.from_config" title="Permalink to this definition"></a></dt>
<dd><p>Construct an instance from config dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<em>dict</em>) – dict of config parameters.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.BaseDFilter.to_config">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">to_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.BaseDFilter.to_config" title="Permalink to this definition"></a></dt>
<dd><p>Construct an instance from config dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>return the dict of config parameters.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.filter.SeriesDFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.filter.</span></span><span class="sig-name descname"><span class="pre">SeriesDFilter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fstart_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fend_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.SeriesDFilter" title="Permalink to this definition"></a></dt>
<dd><p>Dynamic Instruments Filter Abstract class to filter a series of certain features</p>
<p>Filters should provide parameters:</p>
<ul class="simple">
<li><p>filter start time</p></li>
<li><p>filter end time</p></li>
<li><p>filter rule</p></li>
</ul>
<p>Override __init__ to assign a certain rule to filter the series.</p>
<p>Override _getFilterSeries to use the rule to filter the series and get a dict of {inst =&gt; series}, or override filter_main for more advanced series filter rule</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.SeriesDFilter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fstart_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fend_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.SeriesDFilter.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="simple">
<dt>Init function for filter base class.</dt><dd><p>Filter a set of instruments based on a certain rule within a certain period assigned by fstart_time and fend_time.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fstart_time</strong> (<em>str</em>) – the time for the filter rule to start filter the instruments.</p></li>
<li><p><strong>fend_time</strong> (<em>str</em>) – the time for the filter rule to stop filter the instruments.</p></li>
<li><p><strong>keep</strong> (<em>bool</em>) – whether to keep the instruments of which features don’t exist in the filter time span.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.SeriesDFilter.filter_main">
<span class="sig-name descname"><span class="pre">filter_main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.SeriesDFilter.filter_main" title="Permalink to this definition"></a></dt>
<dd><p>Implement this method to filter the instruments.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>dict</em>) – input instruments to be filtered.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>filtered instruments, same structure as input instruments.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.filter.NameDFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.filter.</span></span><span class="sig-name descname"><span class="pre">NameDFilter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name_rule_re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fstart_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fend_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.NameDFilter" title="Permalink to this definition"></a></dt>
<dd><p>Name dynamic instrument filter</p>
<p>Filter the instruments based on a regulated name format.</p>
<p>A name rule regular expression is required.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.NameDFilter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name_rule_re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fstart_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fend_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.NameDFilter.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init function for name filter class</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name_rule_re</strong> (<em>str</em>) – regular expression for the name rule.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.NameDFilter.from_config">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.NameDFilter.from_config" title="Permalink to this definition"></a></dt>
<dd><p>Construct an instance from config dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<em>dict</em>) – dict of config parameters.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.NameDFilter.to_config">
<span class="sig-name descname"><span class="pre">to_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.NameDFilter.to_config" title="Permalink to this definition"></a></dt>
<dd><p>Construct an instance from config dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>return the dict of config parameters.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.filter.ExpressionDFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.filter.</span></span><span class="sig-name descname"><span class="pre">ExpressionDFilter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rule_expression</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fstart_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fend_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.ExpressionDFilter" title="Permalink to this definition"></a></dt>
<dd><p>Expression dynamic instrument filter</p>
<p>Filter the instruments based on a certain expression.</p>
<p>An expression rule indicating a certain feature field is required.</p>
<p class="rubric">Examples</p>
<ul class="simple">
<li><p><em>basic features filter</em> : rule_expression = ‘$close/$open&gt;5’</p></li>
<li><p><em>cross-sectional features filter</em> : rule_expression = ‘$rank($close)&lt;10’</p></li>
<li><p><em>time-sequence features filter</em> : rule_expression = ‘$Ref($close, 3)&gt;100’</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.ExpressionDFilter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rule_expression</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fstart_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fend_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.ExpressionDFilter.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init function for expression filter class</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fstart_time</strong> (<em>str</em>) – filter the feature starting from this time.</p></li>
<li><p><strong>fend_time</strong> (<em>str</em>) – filter the feature ending by this time.</p></li>
<li><p><strong>rule_expression</strong> (<em>str</em>) – an input expression for the rule.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.ExpressionDFilter.from_config">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.ExpressionDFilter.from_config" title="Permalink to this definition"></a></dt>
<dd><p>Construct an instance from config dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<em>dict</em>) – dict of config parameters.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.filter.ExpressionDFilter.to_config">
<span class="sig-name descname"><span class="pre">to_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.filter.ExpressionDFilter.to_config" title="Permalink to this definition"></a></dt>
<dd><p>Construct an instance from config dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>return the dict of config parameters.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.data.base">
<span id="class"></span><h3>Class<a class="headerlink" href="#module-qlib.data.base" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.base.Expression">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.base.</span></span><span class="sig-name descname"><span class="pre">Expression</span></span><a class="headerlink" href="#qlib.data.base.Expression" title="Permalink to this definition"></a></dt>
<dd><p>Expression base class</p>
<p>Expression is designed to handle the calculation of data with the format below
data with two dimension for each instrument,</p>
<ul>
<li><p>feature</p></li>
<li><p>time:  it  could be observation time or period time.</p>
<blockquote>
<div><ul class="simple">
<li><p>period time is designed for Point-in-time database.  For example, the period time maybe 2014Q4, its value can observed for multiple times(different value may be observed at different time due to amendment).</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.base.Expression.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_index</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.base.Expression.load" title="Permalink to this definition"></a></dt>
<dd><p>load  feature
This function is responsible for loading feature/expression based on the expression engine.</p>
<p>The concrete implementation will be separated into two parts:</p>
<ol class="arabic">
<li><p>caching data, handle errors.</p>
<blockquote>
<div><ul class="simple">
<li><p>This part is shared by all the expressions and implemented in Expression</p></li>
</ul>
</div></blockquote>
</li>
<li><p>processing and calculating data based on the specific expression.</p>
<blockquote>
<div><ul class="simple">
<li><p>This part is different in each expression and implemented in each expression</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<p>Expression Engine is shared by different data.
Different data will have different extra information for <cite>args</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instrument</strong> (<em>str</em>) – instrument code.</p></li>
<li><p><strong>start_index</strong> (<em>str</em>) – feature start index [in calendar].</p></li>
<li><p><strong>end_index</strong> (<em>str</em>) – feature end  index  [in calendar].</p></li>
<li><p><strong>information</strong> (<em>*args may contain following</em>) – </p></li>
<li><p><strong>data</strong> (<em>2</em><em>) </em><em>if is used in PIT</em>) – <dl class="simple">
<dt>freq: str</dt><dd><p>feature frequency.</p>
</dd>
</dl>
</p></li>
<li><p><strong>arguments</strong> (<em>it contains following</em>) – <dl class="simple">
<dt>freq: str</dt><dd><p>feature frequency.</p>
</dd>
</dl>
</p></li>
<li><p><strong>data</strong> – <dl class="simple">
<dt>cur_pit:</dt><dd><p>it is designed for the point-in-time data.</p>
</dd>
<dt>period: int</dt><dd><p>This is used for query specific period.
The period is represented with int in Qlib. (e.g. 202001 may represent the first quarter in 2020)</p>
</dd>
</dl>
</p></li>
<li><p><strong>arguments</strong> – <dl class="simple">
<dt>cur_pit:</dt><dd><p>it is designed for the point-in-time data.</p>
</dd>
<dt>period: int</dt><dd><p>This is used for query specific period.
The period is represented with int in Qlib. (e.g. 202001 may represent the first quarter in 2020)</p>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>feature series: The index of the series is the calendar index</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.base.Expression.get_longest_back_rolling">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_longest_back_rolling</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.base.Expression.get_longest_back_rolling" title="Permalink to this definition"></a></dt>
<dd><p>Get the longest length of historical data the feature has accessed</p>
<p>This is designed for getting the needed range of the data to calculate
the features in specific range at first.  However, situations like
Ref(Ref($close, -1), 1) can not be handled rightly.</p>
<p>So this will only used for detecting the length of historical data needed.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.base.Expression.get_extended_window_size">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_extended_window_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.base.Expression.get_extended_window_size" title="Permalink to this definition"></a></dt>
<dd><p>get_extend_window_size</p>
<p>For to calculate this Operator in range[start_index, end_index]
We have to get the <em>leaf feature</em> in
range[start_index - lft_etd, end_index + rght_etd].</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>lft_etd, rght_etd</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(int, int)</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.base.Feature">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.base.</span></span><span class="sig-name descname"><span class="pre">Feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.base.Feature" title="Permalink to this definition"></a></dt>
<dd><p>Static Expression</p>
<p>This kind of feature will load data from provider</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.base.Feature.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.base.Feature.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.base.Feature.get_longest_back_rolling">
<span class="sig-name descname"><span class="pre">get_longest_back_rolling</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.base.Feature.get_longest_back_rolling" title="Permalink to this definition"></a></dt>
<dd><p>Get the longest length of historical data the feature has accessed</p>
<p>This is designed for getting the needed range of the data to calculate
the features in specific range at first.  However, situations like
Ref(Ref($close, -1), 1) can not be handled rightly.</p>
<p>So this will only used for detecting the length of historical data needed.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.base.Feature.get_extended_window_size">
<span class="sig-name descname"><span class="pre">get_extended_window_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.base.Feature.get_extended_window_size" title="Permalink to this definition"></a></dt>
<dd><p>get_extend_window_size</p>
<p>For to calculate this Operator in range[start_index, end_index]
We have to get the <em>leaf feature</em> in
range[start_index - lft_etd, end_index + rght_etd].</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>lft_etd, rght_etd</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(int, int)</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.base.PFeature">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.base.</span></span><span class="sig-name descname"><span class="pre">PFeature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.base.PFeature" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.base.ExpressionOps">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.base.</span></span><span class="sig-name descname"><span class="pre">ExpressionOps</span></span><a class="headerlink" href="#qlib.data.base.ExpressionOps" title="Permalink to this definition"></a></dt>
<dd><p>Operator Expression</p>
<p>This kind of feature will use operator for feature
construction on the fly.</p>
</dd></dl>
</section>
<section id="module-qlib.data.ops">
<span id="operator"></span><h3>Operator<a class="headerlink" href="#module-qlib.data.ops" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.ElemOperator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">ElemOperator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.ElemOperator" title="Permalink to this definition"></a></dt>
<dd><p>Element-wise Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>feature operation output</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.ElemOperator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.ElemOperator.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.ElemOperator.get_longest_back_rolling">
<span class="sig-name descname"><span class="pre">get_longest_back_rolling</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.ElemOperator.get_longest_back_rolling" title="Permalink to this definition"></a></dt>
<dd><p>Get the longest length of historical data the feature has accessed</p>
<p>This is designed for getting the needed range of the data to calculate
the features in specific range at first.  However, situations like
Ref(Ref($close, -1), 1) can not be handled rightly.</p>
<p>So this will only used for detecting the length of historical data needed.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.ElemOperator.get_extended_window_size">
<span class="sig-name descname"><span class="pre">get_extended_window_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.ElemOperator.get_extended_window_size" title="Permalink to this definition"></a></dt>
<dd><p>get_extend_window_size</p>
<p>For to calculate this Operator in range[start_index, end_index]
We have to get the <em>leaf feature</em> in
range[start_index - lft_etd, end_index + rght_etd].</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>lft_etd, rght_etd</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(int, int)</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.ChangeInstrument">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">ChangeInstrument</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.ChangeInstrument" title="Permalink to this definition"></a></dt>
<dd><p>Change Instrument Operator
In some case, one may want to change to another instrument when calculating, for example, to
calculate beta of a stock with respect to a market index.
This would require changing the calculation of features from the stock (original instrument) to
the index (reference instrument)
:param instrument: i.e., SH000300 (CSI300 index), or ^GPSC (SP500 index).
:type instrument: new instrument for which the downstream operations should be performed upon.
:param feature:
:type feature: the feature to be calculated for the new instrument.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>feature operation output</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.ChangeInstrument.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.ChangeInstrument.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.ChangeInstrument.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_index</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.ChangeInstrument.load" title="Permalink to this definition"></a></dt>
<dd><p>load  feature
This function is responsible for loading feature/expression based on the expression engine.</p>
<p>The concrete implementation will be separated into two parts:</p>
<ol class="arabic">
<li><p>caching data, handle errors.</p>
<blockquote>
<div><ul class="simple">
<li><p>This part is shared by all the expressions and implemented in Expression</p></li>
</ul>
</div></blockquote>
</li>
<li><p>processing and calculating data based on the specific expression.</p>
<blockquote>
<div><ul class="simple">
<li><p>This part is different in each expression and implemented in each expression</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<p>Expression Engine is shared by different data.
Different data will have different extra information for <cite>args</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instrument</strong> (<em>str</em>) – instrument code.</p></li>
<li><p><strong>start_index</strong> (<em>str</em>) – feature start index [in calendar].</p></li>
<li><p><strong>end_index</strong> (<em>str</em>) – feature end  index  [in calendar].</p></li>
<li><p><strong>information</strong> (<em>*args may contain following</em>) – </p></li>
<li><p><strong>data</strong> (<em>2</em><em>) </em><em>if is used in PIT</em>) – <dl class="simple">
<dt>freq: str</dt><dd><p>feature frequency.</p>
</dd>
</dl>
</p></li>
<li><p><strong>arguments</strong> (<em>it contains following</em>) – <dl class="simple">
<dt>freq: str</dt><dd><p>feature frequency.</p>
</dd>
</dl>
</p></li>
<li><p><strong>data</strong> – <dl class="simple">
<dt>cur_pit:</dt><dd><p>it is designed for the point-in-time data.</p>
</dd>
<dt>period: int</dt><dd><p>This is used for query specific period.
The period is represented with int in Qlib. (e.g. 202001 may represent the first quarter in 2020)</p>
</dd>
</dl>
</p></li>
<li><p><strong>arguments</strong> – <dl class="simple">
<dt>cur_pit:</dt><dd><p>it is designed for the point-in-time data.</p>
</dd>
<dt>period: int</dt><dd><p>This is used for query specific period.
The period is represented with int in Qlib. (e.g. 202001 may represent the first quarter in 2020)</p>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>feature series: The index of the series is the calendar index</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.NpElemOperator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">NpElemOperator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.NpElemOperator" title="Permalink to this definition"></a></dt>
<dd><p>Numpy Element-wise Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>func</strong> (<em>str</em>) – numpy feature operation method</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>feature operation output</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.NpElemOperator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.NpElemOperator.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Abs">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Abs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Abs" title="Permalink to this definition"></a></dt>
<dd><p>Feature Absolute Value</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with absolute output</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Abs.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Abs.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Sign">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Sign</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Sign" title="Permalink to this definition"></a></dt>
<dd><p>Feature Sign</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with sign</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Sign.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Sign.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Log">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Log</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Log" title="Permalink to this definition"></a></dt>
<dd><p>Feature Log</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with log</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Log.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Log.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Mask">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Mask" title="Permalink to this definition"></a></dt>
<dd><p>Feature Mask</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>instrument</strong> (<em>str</em>) – instrument mask</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with masked instrument</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Mask.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Mask.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Not">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Not</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Not" title="Permalink to this definition"></a></dt>
<dd><p>Not Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>feature elementwise not output</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Not.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Not.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.PairOperator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">PairOperator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.PairOperator" title="Permalink to this definition"></a></dt>
<dd><p>Pair-wise operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance or numeric value</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance or numeric value</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>two features’ operation output</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.PairOperator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.PairOperator.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.PairOperator.get_longest_back_rolling">
<span class="sig-name descname"><span class="pre">get_longest_back_rolling</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.PairOperator.get_longest_back_rolling" title="Permalink to this definition"></a></dt>
<dd><p>Get the longest length of historical data the feature has accessed</p>
<p>This is designed for getting the needed range of the data to calculate
the features in specific range at first.  However, situations like
Ref(Ref($close, -1), 1) can not be handled rightly.</p>
<p>So this will only used for detecting the length of historical data needed.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.PairOperator.get_extended_window_size">
<span class="sig-name descname"><span class="pre">get_extended_window_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.PairOperator.get_extended_window_size" title="Permalink to this definition"></a></dt>
<dd><p>get_extend_window_size</p>
<p>For to calculate this Operator in range[start_index, end_index]
We have to get the <em>leaf feature</em> in
range[start_index - lft_etd, end_index + rght_etd].</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>lft_etd, rght_etd</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(int, int)</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.NpPairOperator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">NpPairOperator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.NpPairOperator" title="Permalink to this definition"></a></dt>
<dd><p>Numpy Pair-wise operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance or numeric value</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance or numeric value</p></li>
<li><p><strong>func</strong> (<em>str</em>) – operator function</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>two features’ operation output</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.NpPairOperator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.NpPairOperator.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Power">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Power</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Power" title="Permalink to this definition"></a></dt>
<dd><p>Power Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The bases in feature_left raised to the exponents in feature_right</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Power.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Power.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Add">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Add" title="Permalink to this definition"></a></dt>
<dd><p>Add Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>two features’ sum</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Add.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Add.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Sub">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Sub</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Sub" title="Permalink to this definition"></a></dt>
<dd><p>Subtract Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>two features’ subtraction</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Sub.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Sub.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Mul">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Mul</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Mul" title="Permalink to this definition"></a></dt>
<dd><p>Multiply Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>two features’ product</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Mul.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Mul.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Div">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Div</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Div" title="Permalink to this definition"></a></dt>
<dd><p>Division Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>two features’ division</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Div.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Div.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Greater">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Greater</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Greater" title="Permalink to this definition"></a></dt>
<dd><p>Greater Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>greater elements taken from the input two features</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Greater.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Greater.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Less">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Less</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Less" title="Permalink to this definition"></a></dt>
<dd><p>Less Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>smaller elements taken from the input two features</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Less.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Less.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Gt">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Gt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Gt" title="Permalink to this definition"></a></dt>
<dd><p>Greater Than Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>bool series indicate <cite>left &gt; right</cite></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Gt.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Gt.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Ge">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Ge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Ge" title="Permalink to this definition"></a></dt>
<dd><p>Greater Equal Than Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>bool series indicate <cite>left &gt;= right</cite></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Ge.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Ge.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Lt">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Lt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Lt" title="Permalink to this definition"></a></dt>
<dd><p>Less Than Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>bool series indicate <cite>left &lt; right</cite></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Lt.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Lt.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Le">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Le</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Le" title="Permalink to this definition"></a></dt>
<dd><p>Less Equal Than Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>bool series indicate <cite>left &lt;= right</cite></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Le.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Le.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Eq">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Eq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Eq" title="Permalink to this definition"></a></dt>
<dd><p>Equal Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>bool series indicate <cite>left == right</cite></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Eq.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Eq.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Ne">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Ne</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Ne" title="Permalink to this definition"></a></dt>
<dd><p>Not Equal Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>bool series indicate <cite>left != right</cite></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Ne.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Ne.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.And">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">And</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.And" title="Permalink to this definition"></a></dt>
<dd><p>And Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>two features’ row by row &amp; output</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.And.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.And.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Or">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Or</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Or" title="Permalink to this definition"></a></dt>
<dd><p>Or Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>two features’ row by row | outputs</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Feature" title="qlib.data.base.Feature">Feature</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Or.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Or.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.If">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">If</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">condition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.If" title="Permalink to this definition"></a></dt>
<dd><p>If Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>condition</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance with bool values as condition</p></li>
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.If.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">condition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.If.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.If.get_longest_back_rolling">
<span class="sig-name descname"><span class="pre">get_longest_back_rolling</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.If.get_longest_back_rolling" title="Permalink to this definition"></a></dt>
<dd><p>Get the longest length of historical data the feature has accessed</p>
<p>This is designed for getting the needed range of the data to calculate
the features in specific range at first.  However, situations like
Ref(Ref($close, -1), 1) can not be handled rightly.</p>
<p>So this will only used for detecting the length of historical data needed.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.If.get_extended_window_size">
<span class="sig-name descname"><span class="pre">get_extended_window_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.If.get_extended_window_size" title="Permalink to this definition"></a></dt>
<dd><p>get_extend_window_size</p>
<p>For to calculate this Operator in range[start_index, end_index]
We have to get the <em>leaf feature</em> in
range[start_index - lft_etd, end_index + rght_etd].</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>lft_etd, rght_etd</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(int, int)</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Rolling">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Rolling</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Rolling" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Operator
The meaning of rolling and expanding is the same in pandas.
When the window is set to 0, the behaviour of the operator should follow <cite>expanding</cite>
Otherwise, it follows <cite>rolling</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
<li><p><strong>func</strong> (<em>str</em>) – rolling method</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>rolling outputs</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Rolling.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Rolling.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Rolling.get_longest_back_rolling">
<span class="sig-name descname"><span class="pre">get_longest_back_rolling</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Rolling.get_longest_back_rolling" title="Permalink to this definition"></a></dt>
<dd><p>Get the longest length of historical data the feature has accessed</p>
<p>This is designed for getting the needed range of the data to calculate
the features in specific range at first.  However, situations like
Ref(Ref($close, -1), 1) can not be handled rightly.</p>
<p>So this will only used for detecting the length of historical data needed.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Rolling.get_extended_window_size">
<span class="sig-name descname"><span class="pre">get_extended_window_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Rolling.get_extended_window_size" title="Permalink to this definition"></a></dt>
<dd><p>get_extend_window_size</p>
<p>For to calculate this Operator in range[start_index, end_index]
We have to get the <em>leaf feature</em> in
range[start_index - lft_etd, end_index + rght_etd].</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>lft_etd, rght_etd</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(int, int)</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Ref">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Ref</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Ref" title="Permalink to this definition"></a></dt>
<dd><p>Feature Reference</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – N = 0, retrieve the first data; N &gt; 0, retrieve data of N periods ago; N &lt; 0, future data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with target reference</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Ref.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Ref.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Ref.get_longest_back_rolling">
<span class="sig-name descname"><span class="pre">get_longest_back_rolling</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Ref.get_longest_back_rolling" title="Permalink to this definition"></a></dt>
<dd><p>Get the longest length of historical data the feature has accessed</p>
<p>This is designed for getting the needed range of the data to calculate
the features in specific range at first.  However, situations like
Ref(Ref($close, -1), 1) can not be handled rightly.</p>
<p>So this will only used for detecting the length of historical data needed.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Ref.get_extended_window_size">
<span class="sig-name descname"><span class="pre">get_extended_window_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Ref.get_extended_window_size" title="Permalink to this definition"></a></dt>
<dd><p>get_extend_window_size</p>
<p>For to calculate this Operator in range[start_index, end_index]
We have to get the <em>leaf feature</em> in
range[start_index - lft_etd, end_index + rght_etd].</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>lft_etd, rght_etd</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(int, int)</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Mean">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Mean" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Mean (MA)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling average</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Mean.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Mean.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Sum">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Sum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Sum" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Sum</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling sum</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Sum.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Sum.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Std">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Std</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Std" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Std</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling std</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Std.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Std.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Var">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Var</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Var" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Variance</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling variance</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Var.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Var.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Skew">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Skew</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Skew" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Skewness</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling skewness</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Skew.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Skew.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Kurt">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Kurt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Kurt" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Kurtosis</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling kurtosis</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Kurt.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Kurt.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Max">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Max</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Max" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Max</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling max</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Max.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Max.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.IdxMax">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">IdxMax</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.IdxMax" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Max Index</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling max index</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.IdxMax.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.IdxMax.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Min">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Min</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Min" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Min</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling min</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Min.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Min.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.IdxMin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">IdxMin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.IdxMin" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Min Index</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling min index</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.IdxMin.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.IdxMin.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Quantile">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Quantile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qscore</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Quantile" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Quantile</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling quantile</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Quantile.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qscore</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Quantile.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Med">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Med</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Med" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Median</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling median</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Med.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Med.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Mad">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Mad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Mad" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Mean Absolute Deviation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling mean absolute deviation</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Mad.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Mad.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Rank">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Rank</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Rank" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Rank (Percentile)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling rank</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Rank.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Rank.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Count">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Count" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Count</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling count of number of non-NaN elements</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Count.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Count.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Delta">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Delta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Delta" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Delta</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with end minus start in rolling window</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Delta.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Delta.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Slope">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Slope</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Slope" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Slope
This operator calculate the slope between <cite>idx</cite> and <cite>feature</cite>.
(e.g. [&lt;feature_t1&gt;, &lt;feature_t2&gt;, &lt;feature_t3&gt;] and [1, 2, 3])</p>
<p>Usage Example:
- “Slope($close, %d)/$close”</p>
<p># TODO:
# Some users may want pair-wise rolling like <cite>Slope(A, B, N)</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with linear regression slope of given window</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Slope.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Slope.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Rsquare">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Rsquare</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Rsquare" title="Permalink to this definition"></a></dt>
<dd><p>Rolling R-value Square</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with linear regression r-value square of given window</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Rsquare.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Rsquare.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Resi">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Resi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Resi" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Regression Residuals</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with regression residuals of given window</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Resi.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Resi.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.WMA">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">WMA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.WMA" title="Permalink to this definition"></a></dt>
<dd><p>Rolling WMA</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with weighted moving average output</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.WMA.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.WMA.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.EMA">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">EMA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.EMA" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Exponential Mean (EMA)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em><em>, </em><em>float</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with regression r-value square of given window</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.EMA.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.EMA.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.PairRolling">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">PairRolling</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.PairRolling" title="Permalink to this definition"></a></dt>
<dd><p>Pair Rolling Operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling output of two input features</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.PairRolling.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.PairRolling.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.PairRolling.get_longest_back_rolling">
<span class="sig-name descname"><span class="pre">get_longest_back_rolling</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.PairRolling.get_longest_back_rolling" title="Permalink to this definition"></a></dt>
<dd><p>Get the longest length of historical data the feature has accessed</p>
<p>This is designed for getting the needed range of the data to calculate
the features in specific range at first.  However, situations like
Ref(Ref($close, -1), 1) can not be handled rightly.</p>
<p>So this will only used for detecting the length of historical data needed.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.PairRolling.get_extended_window_size">
<span class="sig-name descname"><span class="pre">get_extended_window_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.PairRolling.get_extended_window_size" title="Permalink to this definition"></a></dt>
<dd><p>get_extend_window_size</p>
<p>For to calculate this Operator in range[start_index, end_index]
We have to get the <em>leaf feature</em> in
range[start_index - lft_etd, end_index + rght_etd].</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>lft_etd, rght_etd</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(int, int)</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Corr">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Corr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Corr" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Correlation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling correlation of two input features</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Corr.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Corr.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.Cov">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">Cov</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Cov" title="Permalink to this definition"></a></dt>
<dd><p>Rolling Covariance</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature_left</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>feature_right</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – feature instance</p></li>
<li><p><strong>N</strong> (<em>int</em>) – rolling window size</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a feature instance with rolling max of two input features</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression">Expression</a></p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.Cov.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_right</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.Cov.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.TResample">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">TResample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.TResample" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.TResample.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.TResample.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Resampling the data to target frequency.
The resample function of pandas is used.</p>
<ul class="simple">
<li><p>the timestamp will be at the start of the time span after resample.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<a class="reference internal" href="#qlib.data.base.Expression" title="qlib.data.base.Expression"><em>Expression</em></a>) – An expression for calculating the feature</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – It will be passed into the resample method for resampling basedn on given frequency</p></li>
<li><p><strong>func</strong> (<em>method</em>) – The method to get the resampled values
Some expression are high frequently used</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.ops.OpsWrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">OpsWrapper</span></span><a class="headerlink" href="#qlib.data.ops.OpsWrapper" title="Permalink to this definition"></a></dt>
<dd><p>Ops Wrapper</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.OpsWrapper.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.OpsWrapper.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.ops.OpsWrapper.register">
<span class="sig-name descname"><span class="pre">register</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ops_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.data.base.ExpressionOps" title="qlib.data.base.ExpressionOps"><span class="pre">ExpressionOps</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.OpsWrapper.register" title="Permalink to this definition"></a></dt>
<dd><p>register operator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ops_list</strong> (<em>List</em><em>[</em><em>Union</em><em>[</em><em>Type</em><em>[</em><a class="reference internal" href="#qlib.data.base.ExpressionOps" title="qlib.data.base.ExpressionOps"><em>ExpressionOps</em></a><em>]</em><em>, </em><em>dict</em><em>]</em><em>]</em>) – <ul>
<li><p>if type(ops_list) is List[Type[ExpressionOps]], each element of ops_list represents the operator class, which should be the subclass of <cite>ExpressionOps</cite>.</p></li>
<li><p>if type(ops_list) is List[dict], each element of ops_list represents the config of operator, which has the following format:</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    "class": class_name,
    "module_path": path,
}
</pre></div>
</div>
<p>Note: <cite>class</cite> should be the class name of operator, <cite>module_path</cite> should be a python module or path of file.</p>
</div></blockquote>
</li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.data.ops.register_all_ops">
<span class="sig-prename descclassname"><span class="pre">qlib.data.ops.</span></span><span class="sig-name descname"><span class="pre">register_all_ops</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">C</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.ops.register_all_ops" title="Permalink to this definition"></a></dt>
<dd><p>register all operator</p>
</dd></dl>
</section>
<section id="cache">
<h3>Cache<a class="headerlink" href="#cache" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.cache.MemCacheUnit">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.cache.</span></span><span class="sig-name descname"><span class="pre">MemCacheUnit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.MemCacheUnit" title="Permalink to this definition"></a></dt>
<dd><p>Memory Cache Unit.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.MemCacheUnit.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.MemCacheUnit.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.cache.MemCacheUnit.limited">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">limited</span></span><a class="headerlink" href="#qlib.data.cache.MemCacheUnit.limited" title="Permalink to this definition"></a></dt>
<dd><p>whether memory cache is limited</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.cache.MemCache">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.cache.</span></span><span class="sig-name descname"><span class="pre">MemCache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mem_cache_size_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'length'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.MemCache" title="Permalink to this definition"></a></dt>
<dd><p>Memory cache.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.MemCache.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mem_cache_size_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'length'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.MemCache.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mem_cache_size_limit</strong> – cache max size.</p></li>
<li><p><strong>limit_type</strong> – length or sizeof; length(call fun: len), size(call fun: sys.getsizeof).</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.cache.ExpressionCache">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.cache.</span></span><span class="sig-name descname"><span class="pre">ExpressionCache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">provider</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.ExpressionCache" title="Permalink to this definition"></a></dt>
<dd><p>Expression cache mechanism base class.</p>
<p>This class is used to wrap expression provider with self-defined expression cache mechanism.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Override the <cite>_uri</cite> and <cite>_expression</cite> method to create your own expression cache mechanism.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.ExpressionCache.expression">
<span class="sig-name descname"><span class="pre">expression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.ExpressionCache.expression" title="Permalink to this definition"></a></dt>
<dd><p>Get expression data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Same interface as <cite>expression</cite> method in expression provider</p>
</div>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.ExpressionCache.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.ExpressionCache.update" title="Permalink to this definition"></a></dt>
<dd><p>Update expression cache to latest calendar.</p>
<p>Override this method to define how to update expression cache corresponding to users’ own cache mechanism.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cache_uri</strong> (<em>str</em><em> or </em><em>Path</em>) – the complete uri of expression cache file (include dir path).</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>0(successful update)/ 1(no need to update)/ 2(update failure).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.cache.DatasetCache">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.cache.</span></span><span class="sig-name descname"><span class="pre">DatasetCache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">provider</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DatasetCache" title="Permalink to this definition"></a></dt>
<dd><p>Dataset cache mechanism base class.</p>
<p>This class is used to wrap dataset provider with self-defined dataset cache mechanism.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Override the <cite>_uri</cite> and <cite>_dataset</cite> method to create your own dataset cache mechanism.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DatasetCache.dataset">
<span class="sig-name descname"><span class="pre">dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">disk_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DatasetCache.dataset" title="Permalink to this definition"></a></dt>
<dd><p>Get feature dataset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Same interface as <cite>dataset</cite> method in dataset provider</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The server use redis_lock to make sure
read-write conflicts will not be triggered
but client readers are not considered.</p>
</div>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DatasetCache.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DatasetCache.update" title="Permalink to this definition"></a></dt>
<dd><p>Update dataset cache to latest calendar.</p>
<p>Override this method to define how to update dataset cache corresponding to users’ own cache mechanism.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cache_uri</strong> (<em>str</em><em> or </em><em>Path</em>) – the complete uri of dataset cache file (include dir path).</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>0(successful update)/ 1(no need to update)/ 2(update failure)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DatasetCache.cache_to_origin_data">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cache_to_origin_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DatasetCache.cache_to_origin_data" title="Permalink to this definition"></a></dt>
<dd><p>cache data to origin data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – pd.DataFrame, cache data.</p></li>
<li><p><strong>fields</strong> – feature fields.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.DataFrame.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DatasetCache.normalize_uri_args">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">normalize_uri_args</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DatasetCache.normalize_uri_args" title="Permalink to this definition"></a></dt>
<dd><p>normalize uri args</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.cache.DiskExpressionCache">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.cache.</span></span><span class="sig-name descname"><span class="pre">DiskExpressionCache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">provider</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskExpressionCache" title="Permalink to this definition"></a></dt>
<dd><p>Prepared cache mechanism for server.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DiskExpressionCache.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">provider</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskExpressionCache.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DiskExpressionCache.gen_expression_cache">
<span class="sig-name descname"><span class="pre">gen_expression_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expression_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_update</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskExpressionCache.gen_expression_cache" title="Permalink to this definition"></a></dt>
<dd><p>use bin file to save like feature-data.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DiskExpressionCache.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_uri</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskExpressionCache.update" title="Permalink to this definition"></a></dt>
<dd><p>Update expression cache to latest calendar.</p>
<p>Override this method to define how to update expression cache corresponding to users’ own cache mechanism.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cache_uri</strong> (<em>str</em><em> or </em><em>Path</em>) – the complete uri of expression cache file (include dir path).</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>0(successful update)/ 1(no need to update)/ 2(update failure).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.cache.DiskDatasetCache">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.cache.</span></span><span class="sig-name descname"><span class="pre">DiskDatasetCache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">provider</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskDatasetCache" title="Permalink to this definition"></a></dt>
<dd><p>Prepared cache mechanism for server.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DiskDatasetCache.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">provider</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskDatasetCache.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DiskDatasetCache.read_data_from_cache">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">read_data_from_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskDatasetCache.read_data_from_cache" title="Permalink to this definition"></a></dt>
<dd><p>read_cache_from</p>
<p>This function can read data from the disk cache dataset</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cache_path</strong> – </p></li>
<li><p><strong>start_time</strong> – </p></li>
<li><p><strong>end_time</strong> – </p></li>
<li><p><strong>fields</strong> – The fields order of the dataset cache is sorted. So rearrange the columns to make it consistent.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.cache.DiskDatasetCache.IndexManager">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">IndexManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskDatasetCache.IndexManager" title="Permalink to this definition"></a></dt>
<dd><p>The lock is not considered in the class. Please consider the lock outside the code.
This class is the proxy of the disk data.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DiskDatasetCache.IndexManager.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskDatasetCache.IndexManager.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DiskDatasetCache.gen_dataset_cache">
<span class="sig-name descname"><span class="pre">gen_dataset_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskDatasetCache.gen_dataset_cache" title="Permalink to this definition"></a></dt>
<dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function does not consider the cache read write lock. Please
acquire the lock outside this function</p>
</div>
<p>The format the cache contains 3 parts(followed by typical filename).</p>
<ul>
<li><p>index : cache/d41366901e25de3ec47297f12e2ba11d.index</p>
<blockquote>
<div><ul>
<li><p>The content of the file may be in following format(pandas.Series)</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                    <span class="n">start</span> <span class="n">end</span>
<span class="mi">1999</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">10</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>   <span class="mi">1</span>
<span class="mi">1999</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">11</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">1</span>   <span class="mi">2</span>
<span class="mi">1999</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">2</span>   <span class="mi">3</span>
<span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The start is closed. The end is open!!!!!</p>
</div>
</div></blockquote>
</li>
<li><p>Each line contains two element &lt;start_index, end_index&gt; with a timestamp as its index.</p></li>
<li><p>It indicates the <cite>start_index</cite> (included) and <cite>end_index</cite> (excluded) of the data for <cite>timestamp</cite></p></li>
</ul>
</div></blockquote>
</li>
<li><p>meta data: cache/d41366901e25de3ec47297f12e2ba11d.meta</p></li>
<li><p>data     : cache/d41366901e25de3ec47297f12e2ba11d</p>
<blockquote>
<div><ul class="simple">
<li><p>This is a hdf file sorted by datetime</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cache_path</strong> – The path to store the cache.</p></li>
<li><p><strong>instruments</strong> – The instruments to store the cache.</p></li>
<li><p><strong>fields</strong> – The fields to store the cache.</p></li>
<li><p><strong>freq</strong> – The freq to store the cache.</p></li>
<li><p><strong>inst_processors</strong> – Instrument processors.</p></li>
</ul>
</dd>
</dl>
<p>:return type pd.DataFrame; The fields of the returned DataFrame are consistent with the parameters of the function.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.cache.DiskDatasetCache.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_uri</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.cache.DiskDatasetCache.update" title="Permalink to this definition"></a></dt>
<dd><p>Update dataset cache to latest calendar.</p>
<p>Override this method to define how to update dataset cache corresponding to users’ own cache mechanism.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cache_uri</strong> (<em>str</em><em> or </em><em>Path</em>) – the complete uri of dataset cache file (include dir path).</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>0(successful update)/ 1(no need to update)/ 2(update failure)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="storage">
<h3>Storage<a class="headerlink" href="#storage" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.storage.storage.BaseStorage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.storage.storage.</span></span><span class="sig-name descname"><span class="pre">BaseStorage</span></span><a class="headerlink" href="#qlib.data.storage.storage.BaseStorage" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.storage.storage.CalendarStorage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.storage.storage.</span></span><span class="sig-name descname"><span class="pre">CalendarStorage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">future</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.storage.CalendarStorage" title="Permalink to this definition"></a></dt>
<dd><p>The behavior of CalendarStorage’s methods and List’s methods of the same name remain consistent</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.storage.CalendarStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">future</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.storage.CalendarStorage.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.storage.CalendarStorage.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.data.storage.storage.CalendarStorage.data" title="Permalink to this definition"></a></dt>
<dd><p>get all data</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the data(storage) does not exist, raise ValueError</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.storage.CalendarStorage.index">
<span class="sig-name descname"><span class="pre">index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#qlib.data.storage.storage.CalendarStorage.index" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the data(storage) does not exist, raise ValueError</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.storage.storage.InstrumentStorage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.storage.storage.</span></span><span class="sig-name descname"><span class="pre">InstrumentStorage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">market</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.storage.InstrumentStorage" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.storage.InstrumentStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">market</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.storage.InstrumentStorage.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.storage.InstrumentStorage.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.data.storage.storage.InstrumentStorage.data" title="Permalink to this definition"></a></dt>
<dd><p>get all data</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the data(storage) does not exist, raise ValueError</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.storage.InstrumentStorage.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="n"><span class="pre">E</span></span></em>, <span class="optional">]</span><em class="sig-param"><span class="n"><span class="pre">**F</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None.</span>  <span class="pre">Update</span> <span class="pre">D</span> <span class="pre">from</span> <span class="pre">mapping/iterable</span> <span class="pre">E</span> <span class="pre">and</span> <span class="pre">F.</span></span></span><a class="headerlink" href="#qlib.data.storage.storage.InstrumentStorage.update" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Notes</p>
<p>If E present and has a .keys() method, does:     for k in E: D[k] = E[k]</p>
<p>If E present and lacks .keys() method, does:     for (k, v) in E: D[k] = v</p>
<p>In either case, this is followed by: for k, v in F.items(): D[k] = v</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.storage.storage.FeatureStorage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.storage.storage.</span></span><span class="sig-name descname"><span class="pre">FeatureStorage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.storage.FeatureStorage" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.storage.FeatureStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.storage.FeatureStorage.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.storage.FeatureStorage.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Series</span></em><a class="headerlink" href="#qlib.data.storage.storage.FeatureStorage.data" title="Permalink to this definition"></a></dt>
<dd><p>get all data</p>
<p class="rubric">Notes</p>
<p>if data(storage) does not exist, return empty pd.Series: <cite>return pd.Series(dtype=np.float32)</cite></p>
</dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.storage.FeatureStorage.start_index">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">start_index</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#qlib.data.storage.storage.FeatureStorage.start_index" title="Permalink to this definition"></a></dt>
<dd><p>get FeatureStorage start index</p>
<p class="rubric">Notes</p>
<p>If the data(storage) does not exist, return None</p>
</dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.storage.FeatureStorage.end_index">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">end_index</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#qlib.data.storage.storage.FeatureStorage.end_index" title="Permalink to this definition"></a></dt>
<dd><p>get FeatureStorage end index</p>
<p class="rubric">Notes</p>
<p>The  right index of the data range (both sides are closed)</p>
<blockquote>
<div><p>The next  data appending point will be  <cite>end_index + 1</cite></p>
</div></blockquote>
<p>If the data(storage) does not exist, return None</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.storage.FeatureStorage.write">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_array</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.storage.FeatureStorage.write" title="Permalink to this definition"></a></dt>
<dd><p>Write data_array to FeatureStorage starting from index.</p>
<p class="rubric">Notes</p>
<p>If index is None, append data_array to feature.</p>
<p>If len(data_array) == 0; return</p>
<p>If (index - self.end_index) &gt;= 1, self[end_index+1: index] will be filled with np.nan</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span><span class="p">:</span>
    <span class="mi">3</span>   <span class="mi">4</span>
    <span class="mi">4</span>   <span class="mi">5</span>
    <span class="mi">5</span>   <span class="mi">6</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="mi">4</span>
        <span class="mi">4</span>   <span class="mi">5</span>
        <span class="mi">5</span>   <span class="mi">6</span>
        <span class="mi">6</span>   <span class="mi">6</span>
        <span class="mi">7</span>   <span class="mi">7</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">8</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="mi">4</span>
        <span class="mi">4</span>   <span class="mi">5</span>
        <span class="mi">5</span>   <span class="mi">6</span>
        <span class="mi">6</span>   <span class="mi">6</span>
        <span class="mi">7</span>   <span class="mi">7</span>
        <span class="mi">8</span>   <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="mi">9</span>   <span class="mi">8</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="mi">1</span>
        <span class="mi">4</span>   <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="mi">5</span>   <span class="mi">6</span>
        <span class="mi">6</span>   <span class="mi">6</span>
        <span class="mi">7</span>   <span class="mi">7</span>
        <span class="mi">8</span>   <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="mi">9</span>   <span class="mi">8</span>
</pre></div>
</div>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.storage.FeatureStorage.rebase">
<span class="sig-name descname"><span class="pre">rebase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.storage.FeatureStorage.rebase" title="Permalink to this definition"></a></dt>
<dd><p>Rebase the start_index and end_index of the FeatureStorage.</p>
<p>start_index and end_index are closed intervals: [start_index, end_index]</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span><span class="p">:</span>
    <span class="mi">3</span>   <span class="mi">4</span>
    <span class="mi">4</span>   <span class="mi">5</span>
    <span class="mi">5</span>   <span class="mi">6</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rebase</span><span class="p">(</span><span class="n">start_index</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">4</span>   <span class="mi">5</span>
        <span class="mi">5</span>   <span class="mi">6</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rebase</span><span class="p">(</span><span class="n">start_index</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="mi">4</span>   <span class="mi">5</span>
        <span class="mi">5</span>   <span class="mi">6</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="mi">3</span>
        <span class="mi">4</span>   <span class="mi">5</span>
        <span class="mi">5</span>   <span class="mi">6</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rebase</span><span class="p">(</span><span class="n">end_index</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="mi">3</span>
        <span class="mi">4</span>   <span class="mi">5</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="mi">3</span>
        <span class="mi">4</span>   <span class="mi">6</span>
        <span class="mi">5</span>   <span class="mi">7</span>
        <span class="mi">6</span>   <span class="mi">8</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rebase</span><span class="p">(</span><span class="n">start_index</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">end_index</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">4</span>   <span class="mi">6</span>
        <span class="mi">5</span>   <span class="mi">7</span>
</pre></div>
</div>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.storage.FeatureStorage.rewrite">
<span class="sig-name descname"><span class="pre">rewrite</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.storage.FeatureStorage.rewrite" title="Permalink to this definition"></a></dt>
<dd><p>overwrite all data in FeatureStorage with data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>Union</em><em>[</em><em>List</em><em>, </em><em>np.ndarray</em><em>, </em><em>Tuple</em><em>]</em>) – data</p></li>
<li><p><strong>index</strong> (<em>int</em>) – data start index</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileStorageMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.storage.file_storage.</span></span><span class="sig-name descname"><span class="pre">FileStorageMixin</span></span><a class="headerlink" href="#qlib.data.storage.file_storage.FileStorageMixin" title="Permalink to this definition"></a></dt>
<dd><p>FileStorageMixin, applicable to FileXXXStorage
Subclasses need to have provider_uri, freq, storage_name, file_name attributes</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileStorageMixin.check">
<span class="sig-name descname"><span class="pre">check</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.file_storage.FileStorageMixin.check" title="Permalink to this definition"></a></dt>
<dd><p>check self.uri</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – </p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileCalendarStorage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.storage.file_storage.</span></span><span class="sig-name descname"><span class="pre">FileCalendarStorage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">future</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">provider_uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.file_storage.FileCalendarStorage" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileCalendarStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">future</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">provider_uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.file_storage.FileCalendarStorage.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileCalendarStorage.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.data.storage.file_storage.FileCalendarStorage.data" title="Permalink to this definition"></a></dt>
<dd><p>get all data</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the data(storage) does not exist, raise ValueError</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileCalendarStorage.index">
<span class="sig-name descname"><span class="pre">index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#qlib.data.storage.file_storage.FileCalendarStorage.index" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the data(storage) does not exist, raise ValueError</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileInstrumentStorage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.storage.file_storage.</span></span><span class="sig-name descname"><span class="pre">FileInstrumentStorage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">market</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">provider_uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.file_storage.FileInstrumentStorage" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileInstrumentStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">market</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">provider_uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.file_storage.FileInstrumentStorage.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileInstrumentStorage.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.data.storage.file_storage.FileInstrumentStorage.data" title="Permalink to this definition"></a></dt>
<dd><p>get all data</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the data(storage) does not exist, raise ValueError</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileInstrumentStorage.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="n"><span class="pre">E</span></span></em>, <span class="optional">]</span><em class="sig-param"><span class="n"><span class="pre">**F</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None.</span>  <span class="pre">Update</span> <span class="pre">D</span> <span class="pre">from</span> <span class="pre">mapping/iterable</span> <span class="pre">E</span> <span class="pre">and</span> <span class="pre">F.</span></span></span><a class="headerlink" href="#qlib.data.storage.file_storage.FileInstrumentStorage.update" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Notes</p>
<p>If E present and has a .keys() method, does:     for k in E: D[k] = E[k]</p>
<p>If E present and lacks .keys() method, does:     for (k, v) in E: D[k] = v</p>
<p>In either case, this is followed by: for k, v in F.items(): D[k] = v</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileFeatureStorage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.storage.file_storage.</span></span><span class="sig-name descname"><span class="pre">FileFeatureStorage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">provider_uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.file_storage.FileFeatureStorage" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileFeatureStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">provider_uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.storage.file_storage.FileFeatureStorage.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileFeatureStorage.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Series</span></em><a class="headerlink" href="#qlib.data.storage.file_storage.FileFeatureStorage.data" title="Permalink to this definition"></a></dt>
<dd><p>get all data</p>
<p class="rubric">Notes</p>
<p>if data(storage) does not exist, return empty pd.Series: <cite>return pd.Series(dtype=np.float32)</cite></p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileFeatureStorage.write">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_array</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.data.storage.file_storage.FileFeatureStorage.write" title="Permalink to this definition"></a></dt>
<dd><p>Write data_array to FeatureStorage starting from index.</p>
<p class="rubric">Notes</p>
<p>If index is None, append data_array to feature.</p>
<p>If len(data_array) == 0; return</p>
<p>If (index - self.end_index) &gt;= 1, self[end_index+1: index] will be filled with np.nan</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span><span class="p">:</span>
    <span class="mi">3</span>   <span class="mi">4</span>
    <span class="mi">4</span>   <span class="mi">5</span>
    <span class="mi">5</span>   <span class="mi">6</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="mi">4</span>
        <span class="mi">4</span>   <span class="mi">5</span>
        <span class="mi">5</span>   <span class="mi">6</span>
        <span class="mi">6</span>   <span class="mi">6</span>
        <span class="mi">7</span>   <span class="mi">7</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">8</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="mi">4</span>
        <span class="mi">4</span>   <span class="mi">5</span>
        <span class="mi">5</span>   <span class="mi">6</span>
        <span class="mi">6</span>   <span class="mi">6</span>
        <span class="mi">7</span>   <span class="mi">7</span>
        <span class="mi">8</span>   <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="mi">9</span>   <span class="mi">8</span>

<span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">feature</span><span class="p">:</span>
        <span class="mi">3</span>   <span class="mi">1</span>
        <span class="mi">4</span>   <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="mi">5</span>   <span class="mi">6</span>
        <span class="mi">6</span>   <span class="mi">6</span>
        <span class="mi">7</span>   <span class="mi">7</span>
        <span class="mi">8</span>   <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="mi">9</span>   <span class="mi">8</span>
</pre></div>
</div>
</dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileFeatureStorage.start_index">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">start_index</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#qlib.data.storage.file_storage.FileFeatureStorage.start_index" title="Permalink to this definition"></a></dt>
<dd><p>get FeatureStorage start index</p>
<p class="rubric">Notes</p>
<p>If the data(storage) does not exist, return None</p>
</dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.data.storage.file_storage.FileFeatureStorage.end_index">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">end_index</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#qlib.data.storage.file_storage.FileFeatureStorage.end_index" title="Permalink to this definition"></a></dt>
<dd><p>get FeatureStorage end index</p>
<p class="rubric">Notes</p>
<p>The  right index of the data range (both sides are closed)</p>
<blockquote>
<div><p>The next  data appending point will be  <cite>end_index + 1</cite></p>
</div></blockquote>
<p>If the data(storage) does not exist, return None</p>
</dd></dl>
</dd></dl>
</section>
<section id="dataset">
<h3>Dataset<a class="headerlink" href="#dataset" title="Permalink to this heading"></a></h3>
<section id="module-qlib.data.dataset.__init__">
<span id="dataset-class"></span><h4>Dataset Class<a class="headerlink" href="#module-qlib.data.dataset.__init__" title="Permalink to this heading"></a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.Dataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.__init__.</span></span><span class="sig-name descname"><span class="pre">Dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.__init__.Dataset" title="Permalink to this definition"></a></dt>
<dd><p>Preparing data for model training and inferencing.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.Dataset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.__init__.Dataset.__init__" title="Permalink to this definition"></a></dt>
<dd><p>init is designed to finish following steps:</p>
<ul class="simple">
<li><dl class="simple">
<dt>init the sub instance and the state of the dataset(info to prepare the data)</dt><dd><ul>
<li><p>The name of essential state for preparing data should not start with ‘_’ so that it could be serialized on disk when serializing.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>setup data</dt><dd><ul>
<li><p>The data related attributes’ names should start with ‘_’ so that it will not be saved on disk when serializing.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The data could specify the info to calculate the essential data for preparation</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.Dataset.config">
<span class="sig-name descname"><span class="pre">config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.__init__.Dataset.config" title="Permalink to this definition"></a></dt>
<dd><p>config is designed to configure and parameters that cannot be learned from the data</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.Dataset.setup_data">
<span class="sig-name descname"><span class="pre">setup_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.__init__.Dataset.setup_data" title="Permalink to this definition"></a></dt>
<dd><p>Setup the data.</p>
<p>We split the setup_data function for following situation:</p>
<ul class="simple">
<li><p>User have a Dataset object with learned status on disk.</p></li>
<li><p>User load the Dataset object from the disk.</p></li>
<li><p>User call <cite>setup_data</cite> to load new data.</p></li>
<li><p>User prepare data for model based on previous status.</p></li>
</ul>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.Dataset.prepare">
<span class="sig-name descname"><span class="pre">prepare</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#qlib.data.dataset.__init__.Dataset.prepare" title="Permalink to this definition"></a></dt>
<dd><p>The type of dataset depends on the model. (It could be pd.DataFrame, pytorch.DataLoader, etc.)
The parameters should specify the scope for the prepared data
The method should:
- process the data</p>
<ul class="simple">
<li><p>return the processed data</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>return the object</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>object</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.DatasetH">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.__init__.</span></span><span class="sig-name descname"><span class="pre">DatasetH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.data.dataset.handler.DataHandler" title="qlib.data.dataset.handler.DataHandler"><span class="pre">DataHandler</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">segments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fetch_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.__init__.DatasetH" title="Permalink to this definition"></a></dt>
<dd><p>Dataset with Data(H)andler</p>
<p>User should try to put the data preprocessing functions into handler.
Only following data processing functions should be placed in Dataset:</p>
<ul class="simple">
<li><p>The processing is related to specific model.</p></li>
<li><p>The processing is related to data split.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.DatasetH.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.data.dataset.handler.DataHandler" title="qlib.data.dataset.handler.DataHandler"><span class="pre">DataHandler</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">segments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fetch_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.__init__.DatasetH.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Setup the underlying data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>handler</strong> (<em>Union</em><em>[</em><em>dict</em><em>, </em><a class="reference internal" href="#qlib.data.dataset.handler.DataHandler" title="qlib.data.dataset.handler.DataHandler"><em>DataHandler</em></a><em>]</em>) – <p>handler could be:</p>
<ul>
<li><p>instance of <cite>DataHandler</cite></p></li>
<li><p>config of <cite>DataHandler</cite>.  Please refer to <cite>DataHandler</cite></p></li>
</ul>
</p></li>
<li><p><strong>segments</strong> (<em>dict</em>) – <p>Describe the options to segment the data.
Here are some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">)</span> <span class="s1">'segments'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'train'</span><span class="p">:</span> <span class="p">(</span><span class="s2">"2008-01-01"</span><span class="p">,</span> <span class="s2">"2014-12-31"</span><span class="p">),</span>
        <span class="s1">'valid'</span><span class="p">:</span> <span class="p">(</span><span class="s2">"2017-01-01"</span><span class="p">,</span> <span class="s2">"2020-08-01"</span><span class="p">,),</span>
        <span class="s1">'test'</span><span class="p">:</span> <span class="p">(</span><span class="s2">"2015-01-01"</span><span class="p">,</span> <span class="s2">"2016-12-31"</span><span class="p">,),</span>
    <span class="p">}</span>
<span class="mi">2</span><span class="p">)</span> <span class="s1">'segments'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'insample'</span><span class="p">:</span> <span class="p">(</span><span class="s2">"2008-01-01"</span><span class="p">,</span> <span class="s2">"2014-12-31"</span><span class="p">),</span>
        <span class="s1">'outsample'</span><span class="p">:</span> <span class="p">(</span><span class="s2">"2017-01-01"</span><span class="p">,</span> <span class="s2">"2020-08-01"</span><span class="p">,),</span>
    <span class="p">}</span>
</pre></div>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.DatasetH.config">
<span class="sig-name descname"><span class="pre">config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.__init__.DatasetH.config" title="Permalink to this definition"></a></dt>
<dd><p>Initialize the DatasetH</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>handler_kwargs</strong> (<em>dict</em>) – <p>Config of DataHandler, which could include the following arguments:</p>
<ul>
<li><p>arguments of DataHandler.conf_data, such as ‘instruments’, ‘start_time’ and ‘end_time’.</p></li>
</ul>
</p></li>
<li><p><strong>kwargs</strong> (<em>dict</em>) – <p>Config of DatasetH, such as</p>
<ul>
<li><dl class="simple">
<dt>segments<span class="classifier">dict</span></dt><dd><p>Config of segments which is same as ‘segments’ in self.__init__</p>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.DatasetH.setup_data">
<span class="sig-name descname"><span class="pre">setup_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.__init__.DatasetH.setup_data" title="Permalink to this definition"></a></dt>
<dd><p>Setup the Data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>handler_kwargs</strong> (<em>dict</em>) – <p>init arguments of DataHandler, which could include the following arguments:</p>
<ul class="simple">
<li><p>init_type : Init Type of Handler</p></li>
<li><p>enable_cache : whether to enable cache</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.__init__.DatasetH.prepare">
<span class="sig-name descname"><span class="pre">prepare</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">segments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">slice</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'__all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'infer'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.__init__.DatasetH.prepare" title="Permalink to this definition"></a></dt>
<dd><p>Prepare the data for learning and inference.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>segments</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><em>Text</em><em>]</em><em>, </em><em>Tuple</em><em>[</em><em>Text</em><em>]</em><em>, </em><em>Text</em><em>, </em><em>slice</em><em>]</em>) – <p>Describe the scope of the data to be prepared
Here are some examples:</p>
<ul>
<li><p>’train’</p></li>
<li><p>[‘train’, ‘valid’]</p></li>
</ul>
</p></li>
<li><p><strong>col_set</strong> (<em>str</em>) – <p>The col_set will be passed to self.handler when fetching data.
TODO: make it automatic:</p>
<ul>
<li><p>select DK_I for test data</p></li>
<li><p>select DK_L for training data.</p></li>
</ul>
</p></li>
<li><p><strong>data_key</strong> (<em>str</em>) – The data to fetch:  DK_*
Default is DK_I, which indicate fetching data for <strong>inference</strong>.</p></li>
<li><p><strong>kwargs</strong> – <dl class="simple">
<dt>The parameters that kwargs may contain:</dt><dd><dl class="simple">
<dt>flt_col<span class="classifier">str</span></dt><dd><p>It only exists in TSDatasetH, can be used to add a column of data(True or False) to filter data.
This parameter is only supported when it is an instance of TSDatasetH.</p>
</dd>
</dl>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Union[List[pd.DataFrame], pd.DataFrame]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>NotImplementedError:</strong> – </p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.data.dataset.loader">
<span id="data-loader"></span><h4>Data Loader<a class="headerlink" href="#module-qlib.data.dataset.loader" title="Permalink to this heading"></a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.DataLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.loader.</span></span><span class="sig-name descname"><span class="pre">DataLoader</span></span><a class="headerlink" href="#qlib.data.dataset.loader.DataLoader" title="Permalink to this definition"></a></dt>
<dd><p>DataLoader is designed for loading raw data from original data source.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.DataLoader.load">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.loader.DataLoader.load" title="Permalink to this definition"></a></dt>
<dd><p>load the data as pd.DataFrame.</p>
<p>Example of the data (The multi-index of the columns is optional.):</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                        feature                                                             label
                        $close     $volume     Ref($close, 1)  Mean($close, 3)  $high-$low  LABEL0
datetime    instrument
2010-01-04  SH600000    81.807068  17145150.0       83.737389        83.016739    2.741058  0.0032
            SH600004    13.313329  11800983.0       13.313329        13.317701    0.183632  0.0042
            SH600005    37.796539  12231662.0       38.258602        37.919757    0.970325  0.0289
</pre></div>
</div>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>str</em><em> or </em><em>dict</em>) – it can either be the market name or the config file of instruments generated by InstrumentProvider.
If the value of instruments is None, it means that no filtering is done.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>data load from the under layer source</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>KeyError:</strong> – if the instruments filter is not supported, raise KeyError</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.DLWParser">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.loader.</span></span><span class="sig-name descname"><span class="pre">DLWParser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.loader.DLWParser" title="Permalink to this definition"></a></dt>
<dd><p>(D)ata(L)oader (W)ith (P)arser for features and names</p>
<p>Extracting this class so that QlibDataLoader and other dataloaders(such as QdbDataLoader) can share the fields.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.DLWParser.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.loader.DLWParser.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<em>Union</em><em>[</em><em>list</em><em>, </em><em>tuple</em><em>, </em><em>dict</em><em>]</em>) – <p>Config will be used to describe the fields and column names</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">config</span><span class="o">&gt;</span> <span class="o">:=</span> <span class="p">{</span>
    <span class="s2">"group_name1"</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">fields_info1</span><span class="o">&gt;</span>
    <span class="s2">"group_name2"</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">fields_info2</span><span class="o">&gt;</span>
<span class="p">}</span>
<span class="ow">or</span>
<span class="o">&lt;</span><span class="n">config</span><span class="o">&gt;</span> <span class="o">:=</span> <span class="o">&lt;</span><span class="n">fields_info</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">fields_info</span><span class="o">&gt;</span> <span class="o">:=</span> <span class="p">[</span><span class="s2">"expr"</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="p">([</span><span class="s2">"expr"</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="p">[</span><span class="s2">"col_name"</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<span class="c1"># NOTE: list or tuple will be treated as the things when parsing</span>
</pre></div>
</div>
</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.DLWParser.load_group_df">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_group_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exprs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gp_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.loader.DLWParser.load_group_df" title="Permalink to this definition"></a></dt>
<dd><p>load the dataframe for specific group</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> – the instruments.</p></li>
<li><p><strong>exprs</strong> (<em>list</em>) – the expressions to describe the content of the data.</p></li>
<li><p><strong>names</strong> (<em>list</em>) – the name of the data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the queried dataframe.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.DLWParser.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.loader.DLWParser.load" title="Permalink to this definition"></a></dt>
<dd><p>load the data as pd.DataFrame.</p>
<p>Example of the data (The multi-index of the columns is optional.):</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                        feature                                                             label
                        $close     $volume     Ref($close, 1)  Mean($close, 3)  $high-$low  LABEL0
datetime    instrument
2010-01-04  SH600000    81.807068  17145150.0       83.737389        83.016739    2.741058  0.0032
            SH600004    13.313329  11800983.0       13.313329        13.317701    0.183632  0.0042
            SH600005    37.796539  12231662.0       38.258602        37.919757    0.970325  0.0289
</pre></div>
</div>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>str</em><em> or </em><em>dict</em>) – it can either be the market name or the config file of instruments generated by InstrumentProvider.
If the value of instruments is None, it means that no filtering is done.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>data load from the under layer source</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>KeyError:</strong> – if the instruments filter is not supported, raise KeyError</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.QlibDataLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.loader.</span></span><span class="sig-name descname"><span class="pre">QlibDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_pipe</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">swap_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.loader.QlibDataLoader" title="Permalink to this definition"></a></dt>
<dd><p>Same as QlibDataLoader. The fields can be define by config</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.QlibDataLoader.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_pipe</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">swap_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst_processors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.loader.QlibDataLoader.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> (<em>Tuple</em><em>[</em><em>list</em><em>, </em><em>tuple</em><em>, </em><em>dict</em><em>]</em>) – Please refer to the doc of DLWParser</p></li>
<li><p><strong>filter_pipe</strong> – Filter pipe for the instruments</p></li>
<li><p><strong>swap_level</strong> – Whether to swap level of MultiIndex</p></li>
<li><p><strong>freq</strong> (<em>dict</em><em> or </em><em>str</em>) – If type(config) == dict and type(freq) == str, load config data using freq.
If type(config) == dict and type(freq) == dict, load config[&lt;group_name&gt;] data using freq[&lt;group_name&gt;]</p></li>
<li><p><strong>inst_processors</strong> (<em>dict</em><em> | </em><em>list</em>) – If inst_processors is not None and type(config) == dict; load config[&lt;group_name&gt;] data using inst_processors[&lt;group_name&gt;]
If inst_processors is a list, then it will be applied to all groups.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.QlibDataLoader.load_group_df">
<span class="sig-name descname"><span class="pre">load_group_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exprs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gp_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.loader.QlibDataLoader.load_group_df" title="Permalink to this definition"></a></dt>
<dd><p>load the dataframe for specific group</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> – the instruments.</p></li>
<li><p><strong>exprs</strong> (<em>list</em>) – the expressions to describe the content of the data.</p></li>
<li><p><strong>names</strong> (<em>list</em>) – the name of the data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the queried dataframe.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.StaticDataLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.loader.</span></span><span class="sig-name descname"><span class="pre">StaticDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">join</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'outer'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.loader.StaticDataLoader" title="Permalink to this definition"></a></dt>
<dd><p>DataLoader that supports loading data from file or as provided.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.StaticDataLoader.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">join</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'outer'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.loader.StaticDataLoader.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> (<em>dict</em>) – {fields_group: &lt;path or object&gt;}</p></li>
<li><p><strong>join</strong> (<em>str</em>) – How to align different dataframes</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.StaticDataLoader.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.loader.StaticDataLoader.load" title="Permalink to this definition"></a></dt>
<dd><p>load the data as pd.DataFrame.</p>
<p>Example of the data (The multi-index of the columns is optional.):</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                        feature                                                             label
                        $close     $volume     Ref($close, 1)  Mean($close, 3)  $high-$low  LABEL0
datetime    instrument
2010-01-04  SH600000    81.807068  17145150.0       83.737389        83.016739    2.741058  0.0032
            SH600004    13.313329  11800983.0       13.313329        13.317701    0.183632  0.0042
            SH600005    37.796539  12231662.0       38.258602        37.919757    0.970325  0.0289
</pre></div>
</div>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>str</em><em> or </em><em>dict</em>) – it can either be the market name or the config file of instruments generated by InstrumentProvider.
If the value of instruments is None, it means that no filtering is done.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>data load from the under layer source</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>KeyError:</strong> – if the instruments filter is not supported, raise KeyError</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.NestedDataLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.loader.</span></span><span class="sig-name descname"><span class="pre">NestedDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataloader_l</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">join</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'left'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.loader.NestedDataLoader" title="Permalink to this definition"></a></dt>
<dd><p>We have multiple DataLoader, we can use this class to combine them.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.NestedDataLoader.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataloader_l</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">join</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'left'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.data.dataset.loader.NestedDataLoader.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataloader_l</strong> (<em>list</em><em>[</em><em>dict</em><em>]</em>) – <p>A list of dataloader, for exmaple</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nd</span> <span class="o">=</span> <span class="n">NestedDataLoader</span><span class="p">(</span>
    <span class="n">dataloader_l</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"qlib.contrib.data.loader.Alpha158DL"</span><span class="p">,</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"qlib.contrib.data.loader.Alpha360DL"</span><span class="p">,</span>
            <span class="s2">"kwargs"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"config"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"label"</span><span class="p">:</span> <span class="p">(</span> <span class="p">[</span><span class="s2">"Ref($close, -2)/Ref($close, -1) - 1"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"LABEL0"</span><span class="p">])</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</p></li>
<li><p><strong>join</strong> – it will pass to pd.concat when merging it.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.NestedDataLoader.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.loader.NestedDataLoader.load" title="Permalink to this definition"></a></dt>
<dd><p>load the data as pd.DataFrame.</p>
<p>Example of the data (The multi-index of the columns is optional.):</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                        feature                                                             label
                        $close     $volume     Ref($close, 1)  Mean($close, 3)  $high-$low  LABEL0
datetime    instrument
2010-01-04  SH600000    81.807068  17145150.0       83.737389        83.016739    2.741058  0.0032
            SH600004    13.313329  11800983.0       13.313329        13.317701    0.183632  0.0042
            SH600005    37.796539  12231662.0       38.258602        37.919757    0.970325  0.0289
</pre></div>
</div>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>str</em><em> or </em><em>dict</em>) – it can either be the market name or the config file of instruments generated by InstrumentProvider.
If the value of instruments is None, it means that no filtering is done.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>data load from the under layer source</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>KeyError:</strong> – if the instruments filter is not supported, raise KeyError</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.DataLoaderDH">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.loader.</span></span><span class="sig-name descname"><span class="pre">DataLoaderDH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler_config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fetch_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.loader.DataLoaderDH" title="Permalink to this definition"></a></dt>
<dd><p>DataLoader based on (D)ata (H)andler
It is designed to load multiple data from data handler
- If you just want to load data from single datahandler, you can write them in single data handler</p>
<p>TODO: What make this module not that easy to use.</p>
<ul>
<li><p>For online scenario</p>
<blockquote>
<div><ul class="simple">
<li><p>The underlayer data handler should be configured. But data loader doesn’t provide such interface &amp; hook.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.DataLoaderDH.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler_config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fetch_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.loader.DataLoaderDH.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>handler_config</strong> (<em>dict</em>) – <p>handler_config will be used to describe the handlers</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">handler_config</span><span class="o">&gt;</span> <span class="o">:=</span> <span class="p">{</span>
    <span class="s2">"group_name1"</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">handler</span><span class="o">&gt;</span>
    <span class="s2">"group_name2"</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">handler</span><span class="o">&gt;</span>
<span class="p">}</span>
<span class="ow">or</span>
<span class="o">&lt;</span><span class="n">handler_config</span><span class="o">&gt;</span> <span class="o">:=</span> <span class="o">&lt;</span><span class="n">handler</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">handler</span><span class="o">&gt;</span> <span class="o">:=</span> <span class="n">DataHandler</span> <span class="n">Instance</span> <span class="o">|</span> <span class="n">DataHandler</span> <span class="n">Config</span>
</pre></div>
</div>
</p></li>
<li><p><strong>fetch_kwargs</strong> (<em>dict</em>) – fetch_kwargs will be used to describe the different arguments of fetch method, such as col_set, squeeze, data_key, etc.</p></li>
<li><p><strong>is_group</strong> (<em>bool</em>) – is_group will be used to describe whether the key of handler_config is group</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.loader.DataLoaderDH.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.loader.DataLoaderDH.load" title="Permalink to this definition"></a></dt>
<dd><p>load the data as pd.DataFrame.</p>
<p>Example of the data (The multi-index of the columns is optional.):</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                        feature                                                             label
                        $close     $volume     Ref($close, 1)  Mean($close, 3)  $high-$low  LABEL0
datetime    instrument
2010-01-04  SH600000    81.807068  17145150.0       83.737389        83.016739    2.741058  0.0032
            SH600004    13.313329  11800983.0       13.313329        13.317701    0.183632  0.0042
            SH600005    37.796539  12231662.0       38.258602        37.919757    0.970325  0.0289
</pre></div>
</div>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>str</em><em> or </em><em>dict</em>) – it can either be the market name or the config file of instruments generated by InstrumentProvider.
If the value of instruments is None, it means that no filtering is done.</p></li>
<li><p><strong>start_time</strong> (<em>str</em>) – start of the time range.</p></li>
<li><p><strong>end_time</strong> (<em>str</em>) – end of the time range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>data load from the under layer source</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>KeyError:</strong> – if the instruments filter is not supported, raise KeyError</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.data.dataset.handler">
<span id="data-handler"></span><h4>Data Handler<a class="headerlink" href="#module-qlib.data.dataset.handler" title="Permalink to this heading"></a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.handler.</span></span><span class="sig-name descname"><span class="pre">DataHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_loader</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.data.dataset.loader.DataLoader" title="qlib.data.dataset.loader.DataLoader"><span class="pre">DataLoader</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fetch_orig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandler" title="Permalink to this definition"></a></dt>
<dd><p>The steps to using a handler
1. initialized data handler  (call by <cite>init</cite>).
2. use the data.</p>
<p>The data handler try to maintain a handler with 2 level.
<cite>datetime</cite> &amp; <cite>instruments</cite>.</p>
<p>Any order of the index level can be supported (The order will be implied in the data).
The order  &lt;<cite>datetime</cite>, <cite>instruments</cite>&gt; will be used when the dataframe index name is missed.</p>
<p>Example of the data:
The multi-index of the columns is optional.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                        feature                                                            label
                        $close     $volume  Ref($close, 1)  Mean($close, 3)  $high-$low  LABEL0
datetime   instrument
2010-01-04 SH600000    81.807068  17145150.0       83.737389        83.016739    2.741058  0.0032
           SH600004    13.313329  11800983.0       13.313329        13.317701    0.183632  0.0042
           SH600005    37.796539  12231662.0       38.258602        37.919757    0.970325  0.0289
</pre></div>
</div>
<p>Tips for improving the performance of datahandler
- Fetching data with <cite>col_set=CS_RAW</cite> will return the raw data and may avoid pandas from copying the data when calling <cite>loc</cite></p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandler.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_loader</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.data.dataset.loader.DataLoader" title="qlib.data.dataset.loader.DataLoader"><span class="pre">DataLoader</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fetch_orig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandler.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> – The stock list to retrieve.</p></li>
<li><p><strong>start_time</strong> – start_time of the original data.</p></li>
<li><p><strong>end_time</strong> – end_time of the original data.</p></li>
<li><p><strong>data_loader</strong> (<em>Union</em><em>[</em><em>dict</em><em>, </em><em>str</em><em>, </em><a class="reference internal" href="#qlib.data.dataset.loader.DataLoader" title="qlib.data.dataset.loader.DataLoader"><em>DataLoader</em></a><em>]</em>) – data loader to load the data.</p></li>
<li><p><strong>init_data</strong> – initialize the original data in the constructor.</p></li>
<li><p><strong>fetch_orig</strong> (<em>bool</em>) – Return the original data instead of copy if possible.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandler.config">
<span class="sig-name descname"><span class="pre">config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandler.config" title="Permalink to this definition"></a></dt>
<dd><p>configuration of data.
# what data to be loaded from data source</p>
<p>This method will be used when loading pickled handler from dataset.
The data will be initialized with different time range.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandler.setup_data">
<span class="sig-name descname"><span class="pre">setup_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enable_cache</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandler.setup_data" title="Permalink to this definition"></a></dt>
<dd><p>Set Up the data in case of running initialization for multiple time</p>
<p>It is responsible for maintaining following variable
1) self._data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>enable_cache</strong> (<em>bool</em>) – <p>default value is false:</p>
<ul>
<li><p>if <cite>enable_cache</cite> == True:</p>
<blockquote>
<div><p>the processed data will be saved on disk, and handler will load the cached data from the disk directly
when we call <cite>init</cite> next time</p>
</div></blockquote>
</li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandler.fetch">
<span class="sig-name descname"><span class="pre">fetch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selector</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">slice</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Index</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">slice(None,</span> <span class="pre">None,</span> <span class="pre">None)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'datetime'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_set</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'__all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">squeeze</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proc_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandler.fetch" title="Permalink to this definition"></a></dt>
<dd><p>fetch data from underlying data source</p>
<p>Design motivation:
- providing a unified interface for underlying data.
- Potential to make the interface more friendly.
- User can improve performance when fetching data in this extra layer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>selector</strong> (<em>Union</em><em>[</em><em>pd.Timestamp</em><em>, </em><em>slice</em><em>, </em><em>str</em><em>]</em>) – <p>describe how to select data by index
It can be categories as following</p>
<ul>
<li><p>fetch single index</p></li>
<li><p>fetch a range of index</p>
<blockquote>
<div><ul class="simple">
<li><p>a slice range</p></li>
<li><p>pd.Index for specific indexes</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Following conflicts may occur</p>
<ul>
<li><p>Does [“20200101”, “20210101”] mean selecting this slice or these two days?</p>
<blockquote>
<div><ul class="simple">
<li><p>slice have higher priorities</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</p></li>
<li><p><strong>level</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em>) – which index level to select the data</p></li>
<li><p><strong>col_set</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>List</em><em>[</em><em>str</em><em>]</em><em>]</em>) – <ul>
<li><p>if isinstance(col_set, str):</p>
<blockquote>
<div><p>select a set of meaningful, pd.Index columns.(e.g. features, columns)</p>
<ul>
<li><p>if col_set == CS_RAW:</p>
<blockquote>
<div><p>the raw dataset will be returned.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>if isinstance(col_set, List[str]):</p>
<blockquote>
<div><p>select several sets of meaningful columns, the returned data has multiple levels</p>
</div></blockquote>
</li>
</ul>
</p></li>
<li><p><strong>proc_func</strong> (<em>Callable</em>) – <ul>
<li><p>Give a hook for processing data before fetching</p></li>
<li><p>An example to explain the necessity of the hook:</p>
<blockquote>
<div><ul class="simple">
<li><p>A Dataset learned some processors to process data which is related to data segmentation</p></li>
<li><p>It will apply them every time when preparing data.</p></li>
<li><p>The learned processor require the dataframe remains the same format when fitting and applying</p></li>
<li><p>However the data format will change according to the parameters.</p></li>
<li><p>So the processors should be applied to the underlayer data.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</p></li>
<li><p><strong>squeeze</strong> (<em>bool</em>) – whether squeeze columns and index</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.DataFrame.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandler.get_cols">
<span class="sig-name descname"><span class="pre">get_cols</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'__all'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandler.get_cols" title="Permalink to this definition"></a></dt>
<dd><p>get the column names</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>col_set</strong> (<em>str</em>) – select a set of meaningful columns.(e.g. features, columns)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of column names</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandler.get_range_selector">
<span class="sig-name descname"><span class="pre">get_range_selector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cur_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">slice</span></span></span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandler.get_range_selector" title="Permalink to this definition"></a></dt>
<dd><p>get range selector by number of periods</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cur_date</strong> (<em>pd.Timestamp</em><em> or </em><em>str</em>) – current date</p></li>
<li><p><strong>periods</strong> (<em>int</em>) – number of periods</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandler.get_range_iterator">
<span class="sig-name descname"><span class="pre">get_range_iterator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">periods</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_periods</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Timestamp</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">DataFrame</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandler.get_range_iterator" title="Permalink to this definition"></a></dt>
<dd><p>get an iterator of sliced data with given periods</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>periods</strong> (<em>int</em>) – number of periods.</p></li>
<li><p><strong>min_periods</strong> (<em>int</em>) – minimum periods for sliced dataframe.</p></li>
<li><p><strong>kwargs</strong> (<em>dict</em>) – will be passed to <cite>self.fetch</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.handler.</span></span><span class="sig-name descname"><span class="pre">DataHandlerLP</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_loader</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.data.dataset.loader.DataLoader" title="qlib.data.dataset.loader.DataLoader"><span class="pre">DataLoader</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">infer_processors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learn_processors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_processors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'append'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_raw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP" title="Permalink to this definition"></a></dt>
<dd><p>DataHandler with <strong>(L)earnable (P)rocessor</strong></p>
<p>This handler will produce three pieces of data in pd.DataFrame format.</p>
<ul class="simple">
<li><p>DK_R / self._data: the raw data loaded from the loader</p></li>
<li><p>DK_I / self._infer: the data processed for inference</p></li>
<li><p>DK_L / self._learn: the data processed for learning model.</p></li>
</ul>
<p>The motivation of using different processor workflows for learning and inference
Here are some examples.</p>
<ul>
<li><p>The instrument universe for learning and inference may be different.</p></li>
<li><p>The processing of some samples may rely on label (for example, some samples hit the limit may need extra processing or be dropped).</p>
<blockquote>
<div><ul class="simple">
<li><p>These processors only apply to the learning phase.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Tips for data handler</p>
<ul>
<li><p>To reduce the memory cost</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>drop_raw=True</cite>: this will modify the data inplace on raw data;</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Please note processed data like <cite>self._infer</cite> or <cite>self._learn</cite> are concepts different from <cite>segments</cite> in Qlib’s <cite>Dataset</cite> like “train” and “test”</p>
<blockquote>
<div><ul class="simple">
<li><p>Processed data like <cite>self._infer</cite> or <cite>self._learn</cite> are underlying data processed with different processors</p></li>
<li><p><cite>segments</cite> in Qlib’s <cite>Dataset</cite> like “train” and “test” are simply the time segmentations when querying data(“train” are often before “test” in time-series).</p></li>
<li><p>For example, you can query <cite>data._infer</cite> processed by <cite>infer_processors</cite> in the “train” time segmentation.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_loader</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.data.dataset.loader.DataLoader" title="qlib.data.dataset.loader.DataLoader"><span class="pre">DataLoader</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">infer_processors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learn_processors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_processors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'append'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_raw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>infer_processors</strong> (<em>list</em>) – <ul>
<li><p>list of &lt;description info&gt; of processors to generate data for inference</p></li>
<li><p>example of &lt;description info&gt;:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">)</span> <span class="n">classname</span> <span class="o">&amp;</span> <span class="n">kwargs</span><span class="p">:</span>
    <span class="p">{</span>
        <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"MinMaxNorm"</span><span class="p">,</span>
        <span class="s2">"kwargs"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"fit_start_time"</span><span class="p">:</span> <span class="s2">"20080101"</span><span class="p">,</span>
            <span class="s2">"fit_end_time"</span><span class="p">:</span> <span class="s2">"20121231"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="mi">2</span><span class="p">)</span> <span class="n">Only</span> <span class="n">classname</span><span class="p">:</span>
    <span class="s2">"DropnaFeature"</span>
<span class="mi">3</span><span class="p">)</span> <span class="nb">object</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">Processor</span>
</pre></div>
</div>
</p></li>
<li><p><strong>learn_processors</strong> (<em>list</em>) – similar to infer_processors, but for generating data for learning models</p></li>
<li><p><strong>process_type</strong> (<em>str</em>) – <p>PTYPE_I = ‘independent’</p>
<ul>
<li><p>self._infer will be processed by infer_processors</p></li>
<li><p>self._learn will be processed by learn_processors</p></li>
</ul>
<p>PTYPE_A = ‘append’</p>
<ul>
<li><p>self._infer will be processed by infer_processors</p></li>
<li><p>self._learn will be processed by infer_processors + learn_processors</p>
<ul>
<li><p>(e.g. self._infer processed by learn_processors )</p></li>
</ul>
</li>
</ul>
</p></li>
<li><p><strong>drop_raw</strong> (<em>bool</em>) – Whether to drop the raw data</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.fit" title="Permalink to this definition"></a></dt>
<dd><p>fit data without processing the data</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.fit_process_data">
<span class="sig-name descname"><span class="pre">fit_process_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.fit_process_data" title="Permalink to this definition"></a></dt>
<dd><p>fit and process data</p>
<p>The input of the <cite>fit</cite> will be the output of the previous processor</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.process_data">
<span class="sig-name descname"><span class="pre">process_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">with_fit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.process_data" title="Permalink to this definition"></a></dt>
<dd><p>process_data data. Fun <cite>processor.fit</cite> if necessary</p>
<p>Notation: (data)  [processor]</p>
<p># data processing flow of self.process_type == DataHandlerLP.PTYPE_I</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(self._data)-[shared_processors]-(_shared_df)-[learn_processors]-(_learn_df)
                                       \
                                        -[infer_processors]-(_infer_df)
</pre></div>
</div>
<p># data processing flow of self.process_type == DataHandlerLP.PTYPE_A</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(self._data)-[shared_processors]-(_shared_df)-[infer_processors]-(_infer_df)-[learn_processors]-(_learn_df)
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>with_fit</strong> (<em>bool</em>) – The input of the <cite>fit</cite> will be the output of the previous processor</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.config">
<span class="sig-name descname"><span class="pre">config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">processor_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.config" title="Permalink to this definition"></a></dt>
<dd><p>configuration of data.
# what data to be loaded from data source</p>
<p>This method will be used when loading pickled handler from dataset.
The data will be initialized with different time range.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.setup_data">
<span class="sig-name descname"><span class="pre">setup_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">init_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'fit_seq'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.setup_data" title="Permalink to this definition"></a></dt>
<dd><p>Set up the data in case of running initialization for multiple time</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>init_type</strong> (<em>str</em>) – The type <cite>IT_*</cite> listed above.</p></li>
<li><p><strong>enable_cache</strong> (<em>bool</em>) – <p>default value is false:</p>
<ul>
<li><p>if <cite>enable_cache</cite> == True:</p>
<blockquote>
<div><p>the processed data will be saved on disk, and handler will load the cached data from the disk directly
when we call <cite>init</cite> next time</p>
</div></blockquote>
</li>
</ul>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.fetch">
<span class="sig-name descname"><span class="pre">fetch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selector</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">slice</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">slice(None,</span> <span class="pre">None,</span> <span class="pre">None)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'datetime'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'__all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'raw'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'infer'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'learn'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'infer'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">squeeze</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proc_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.fetch" title="Permalink to this definition"></a></dt>
<dd><p>fetch data from underlying data source</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>selector</strong> (<em>Union</em><em>[</em><em>pd.Timestamp</em><em>, </em><em>slice</em><em>, </em><em>str</em><em>]</em>) – describe how to select data by index.</p></li>
<li><p><strong>level</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em>) – which index level to select the data.</p></li>
<li><p><strong>col_set</strong> (<em>str</em>) – select a set of meaningful columns.(e.g. features, columns).</p></li>
<li><p><strong>data_key</strong> (<em>str</em>) – the data to fetch:  DK_*.</p></li>
<li><p><strong>proc_func</strong> (<em>Callable</em>) – please refer to the doc of DataHandler.fetch</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.get_cols">
<span class="sig-name descname"><span class="pre">get_cols</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'__all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'raw'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'infer'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'learn'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'infer'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.get_cols" title="Permalink to this definition"></a></dt>
<dd><p>get the column names</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>col_set</strong> (<em>str</em>) – select a set of meaningful columns.(e.g. features, columns).</p></li>
<li><p><strong>data_key</strong> (<em>DATA_KEY_TYPE</em>) – the data to fetch:  DK_*.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of column names</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.cast">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.data.dataset.handler.DataHandlerLP" title="qlib.data.dataset.handler.DataHandlerLP"><span class="pre">DataHandlerLP</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><a class="reference internal" href="#qlib.data.dataset.handler.DataHandlerLP" title="qlib.data.dataset.handler.DataHandlerLP"><span class="pre">DataHandlerLP</span></a></span></span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.cast" title="Permalink to this definition"></a></dt>
<dd><p>Motivation</p>
<ul class="simple">
<li><p>A user creates a datahandler in his customized package. Then he wants to share the processed handler to
other users without introduce the package dependency and complicated data processing logic.</p></li>
<li><p>This class make it possible by casting the class to DataHandlerLP and only keep the processed data</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>handler</strong> (<a class="reference internal" href="#qlib.data.dataset.handler.DataHandlerLP" title="qlib.data.dataset.handler.DataHandlerLP"><em>DataHandlerLP</em></a>) – A subclass of DataHandlerLP</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the converted processed data</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.dataset.handler.DataHandlerLP" title="qlib.data.dataset.handler.DataHandlerLP">DataHandlerLP</a></p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.handler.DataHandlerLP.from_df">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><a class="reference internal" href="#qlib.data.dataset.handler.DataHandlerLP" title="qlib.data.dataset.handler.DataHandlerLP"><span class="pre">DataHandlerLP</span></a></span></span><a class="headerlink" href="#qlib.data.dataset.handler.DataHandlerLP.from_df" title="Permalink to this definition"></a></dt>
<dd><p>Motivation:
- When user want to get a quick data handler.</p>
<p>The created data handler will have only one shared Dataframe without processors.
After creating the handler, user may often want to dump the handler for reuse
Here is a typical use case</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">qlib.data.dataset</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataHandlerLP</span>
<span class="n">dh</span> <span class="o">=</span> <span class="n">DataHandlerLP</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">dh</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dump_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>TODO:
- The StaticDataLoader is quite slow. It don’t have to copy the data again…</p>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.data.dataset.processor">
<span id="processor"></span><h4>Processor<a class="headerlink" href="#module-qlib.data.dataset.processor" title="Permalink to this heading"></a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.get_group_columns">
<span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">get_group_columns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.get_group_columns" title="Permalink to this definition"></a></dt>
<dd><p>get a group of columns from multi-index columns DataFrame</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – with multi of columns.</p></li>
<li><p><strong>group</strong> (<em>str</em>) – the name of the feature group, i.e. the first level value of the group index.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.Processor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">Processor</span></span><a class="headerlink" href="#qlib.data.dataset.processor.Processor" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.Processor.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.Processor.fit" title="Permalink to this definition"></a></dt>
<dd><p>learn data processing parameters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df</strong> (<em>pd.DataFrame</em>) – When we fit and process data with processor one by one. The fit function reiles on the output of previous
processor, i.e. <cite>df</cite>.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.Processor.is_for_infer">
<span class="sig-name descname"><span class="pre">is_for_infer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#qlib.data.dataset.processor.Processor.is_for_infer" title="Permalink to this definition"></a></dt>
<dd><p>Is this processor usable for inference
Some processors are not usable for inference.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>if it is usable for infenrece.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.Processor.readonly">
<span class="sig-name descname"><span class="pre">readonly</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#qlib.data.dataset.processor.Processor.readonly" title="Permalink to this definition"></a></dt>
<dd><p>Does the processor treat the input data readonly (i.e. does not write the input data) when processing</p>
<p>Knowning the readonly information is helpful to the Handler to avoid uncessary copy</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.Processor.config">
<span class="sig-name descname"><span class="pre">config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.Processor.config" title="Permalink to this definition"></a></dt>
<dd><p>configure the serializable object</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>keys</strong> (<em>kwargs may include following</em>) – <dl class="simple">
<dt>dump_all<span class="classifier">bool</span></dt><dd><p>will the object dump all object</p>
</dd>
<dt>exclude<span class="classifier">list</span></dt><dd><p>What attribute will not be dumped</p>
</dd>
<dt>include<span class="classifier">list</span></dt><dd><p>What attribute will be dumped</p>
</dd>
</dl>
</p></li>
<li><p><strong>recursive</strong> (<em>bool</em>) – will the configuration be recursive</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.DropnaProcessor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">DropnaProcessor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.DropnaProcessor" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.DropnaProcessor.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.DropnaProcessor.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.DropnaProcessor.readonly">
<span class="sig-name descname"><span class="pre">readonly</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.DropnaProcessor.readonly" title="Permalink to this definition"></a></dt>
<dd><p>Does the processor treat the input data readonly (i.e. does not write the input data) when processing</p>
<p>Knowning the readonly information is helpful to the Handler to avoid uncessary copy</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.DropnaLabel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">DropnaLabel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'label'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.DropnaLabel" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.DropnaLabel.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'label'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.DropnaLabel.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.DropnaLabel.is_for_infer">
<span class="sig-name descname"><span class="pre">is_for_infer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#qlib.data.dataset.processor.DropnaLabel.is_for_infer" title="Permalink to this definition"></a></dt>
<dd><p>The samples are dropped according to label. So it is not usable for inference</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.DropCol">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">DropCol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.DropCol" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.DropCol.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.DropCol.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.DropCol.readonly">
<span class="sig-name descname"><span class="pre">readonly</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.DropCol.readonly" title="Permalink to this definition"></a></dt>
<dd><p>Does the processor treat the input data readonly (i.e. does not write the input data) when processing</p>
<p>Knowning the readonly information is helpful to the Handler to avoid uncessary copy</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.FilterCol">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">FilterCol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'feature'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.FilterCol" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.FilterCol.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'feature'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.FilterCol.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.FilterCol.readonly">
<span class="sig-name descname"><span class="pre">readonly</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.FilterCol.readonly" title="Permalink to this definition"></a></dt>
<dd><p>Does the processor treat the input data readonly (i.e. does not write the input data) when processing</p>
<p>Knowning the readonly information is helpful to the Handler to avoid uncessary copy</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.TanhProcess">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">TanhProcess</span></span><a class="headerlink" href="#qlib.data.dataset.processor.TanhProcess" title="Permalink to this definition"></a></dt>
<dd><p>Use tanh to process noise data</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.ProcessInf">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">ProcessInf</span></span><a class="headerlink" href="#qlib.data.dataset.processor.ProcessInf" title="Permalink to this definition"></a></dt>
<dd><p>Process infinity</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.Fillna">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">Fillna</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.Fillna" title="Permalink to this definition"></a></dt>
<dd><p>Process NaN</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.Fillna.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.Fillna.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.MinMaxNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">MinMaxNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.MinMaxNorm" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.MinMaxNorm.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.MinMaxNorm.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.MinMaxNorm.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.MinMaxNorm.fit" title="Permalink to this definition"></a></dt>
<dd><p>learn data processing parameters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df</strong> (<em>pd.DataFrame</em>) – When we fit and process data with processor one by one. The fit function reiles on the output of previous
processor, i.e. <cite>df</cite>.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.ZScoreNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">ZScoreNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.ZScoreNorm" title="Permalink to this definition"></a></dt>
<dd><p>ZScore Normalization</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.ZScoreNorm.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.ZScoreNorm.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.ZScoreNorm.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.ZScoreNorm.fit" title="Permalink to this definition"></a></dt>
<dd><p>learn data processing parameters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df</strong> (<em>pd.DataFrame</em>) – When we fit and process data with processor one by one. The fit function reiles on the output of previous
processor, i.e. <cite>df</cite>.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.RobustZScoreNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">RobustZScoreNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip_outlier</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.RobustZScoreNorm" title="Permalink to this definition"></a></dt>
<dd><p>Robust ZScore Normalization</p>
<dl class="simple">
<dt>Use robust statistics for Z-Score normalization:</dt><dd><p>mean(x) = median(x)
std(x) = MAD(x) * 1.4826</p>
</dd>
<dt>Reference:</dt><dd><p><a class="reference external" href="https://en.wikipedia.org/wiki/Median_absolute_deviation">https://en.wikipedia.org/wiki/Median_absolute_deviation</a>.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.RobustZScoreNorm.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip_outlier</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.RobustZScoreNorm.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.RobustZScoreNorm.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.RobustZScoreNorm.fit" title="Permalink to this definition"></a></dt>
<dd><p>learn data processing parameters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df</strong> (<em>pd.DataFrame</em>) – When we fit and process data with processor one by one. The fit function reiles on the output of previous
processor, i.e. <cite>df</cite>.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.CSZScoreNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">CSZScoreNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'zscore'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.CSZScoreNorm" title="Permalink to this definition"></a></dt>
<dd><p>Cross Sectional ZScore Normalization</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.CSZScoreNorm.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'zscore'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.CSZScoreNorm.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.CSRankNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">CSRankNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.CSRankNorm" title="Permalink to this definition"></a></dt>
<dd><p>Cross Sectional Rank Normalization.
“Cross Sectional” is often used to describe data operations.
The operations across different stocks are often called Cross Sectional Operation.</p>
<p>For example, CSRankNorm is an operation that grouping the data by each day and rank <cite>across</cite> all the stocks in each day.</p>
<p>Explanation about 3.46 &amp; 0.5</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># for any variable</span>
<span class="n">x_rank</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">pct</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># if it is converted to rank, it will be a uniform distributed</span>
<span class="n">x_rank_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_rank</span> <span class="o">-</span> <span class="n">x_rank</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">x_rank</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>  <span class="c1"># Normally, we will normalize it to make it like normal distribution</span>

<span class="n">x_rank</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>   <span class="c1"># accounts for 0.5</span>
<span class="mi">1</span> <span class="o">/</span> <span class="n">x_rank</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>  <span class="c1"># accounts for 3.46</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.CSRankNorm.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.CSRankNorm.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.CSZFillna">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">CSZFillna</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.CSZFillna" title="Permalink to this definition"></a></dt>
<dd><p>Cross Sectional Fill Nan</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.CSZFillna.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fields_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.CSZFillna.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.HashStockFormat">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">HashStockFormat</span></span><a class="headerlink" href="#qlib.data.dataset.processor.HashStockFormat" title="Permalink to this definition"></a></dt>
<dd><p>Process the storage of from df into hasing stock format</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.TimeRangeFlt">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.data.dataset.processor.</span></span><span class="sig-name descname"><span class="pre">TimeRangeFlt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.TimeRangeFlt" title="Permalink to this definition"></a></dt>
<dd><p>This is a filter to filter stock.
Only keep the data that exist from start_time to end_time (the existence in the middle is not checked.)
WARNING:  It may induce leakage!!!</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.data.dataset.processor.TimeRangeFlt.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.data.dataset.processor.TimeRangeFlt.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_time</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>pd.Timestamp</em><em>, </em><em>str</em><em>]</em><em>]</em>) – The data must start earlier (or equal) than <cite>start_time</cite>
None indicates data will not be filtered based on <cite>start_time</cite></p></li>
<li><p><strong>end_time</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>pd.Timestamp</em><em>, </em><em>str</em><em>]</em><em>]</em>) – similar to start_time</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – The frequency of the calendar</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
</section>
</section>
<section id="contrib">
<h2>Contrib<a class="headerlink" href="#contrib" title="Permalink to this heading"></a></h2>
<section id="module-qlib.model.base">
<span id="model"></span><h3>Model<a class="headerlink" href="#module-qlib.model.base" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.base.BaseModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.base.</span></span><span class="sig-name descname"><span class="pre">BaseModel</span></span><a class="headerlink" href="#qlib.model.base.BaseModel" title="Permalink to this definition"></a></dt>
<dd><p>Modeling things</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.base.BaseModel.predict">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#qlib.model.base.BaseModel.predict" title="Permalink to this definition"></a></dt>
<dd><p>Make predictions after modeling things</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.base.Model">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.base.</span></span><span class="sig-name descname"><span class="pre">Model</span></span><a class="headerlink" href="#qlib.model.base.Model" title="Permalink to this definition"></a></dt>
<dd><p>Learnable Models</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.base.Model.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reweighter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Reweighter</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.base.Model.fit" title="Permalink to this definition"></a></dt>
<dd><p>Learn model from the base model</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The attribute names of learned model should <cite>not</cite> start with ‘_’. So that the model could be
dumped to disk.</p>
</div>
<p>The following code example shows how to retrieve <cite>x_train</cite>, <cite>y_train</cite> and <cite>w_train</cite> from the <cite>dataset</cite>:</p>
<blockquote>
<div><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get features and labels</span>
<span class="n">df_train</span><span class="p">,</span> <span class="n">df_valid</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">"train"</span><span class="p">,</span> <span class="s2">"valid"</span><span class="p">],</span> <span class="n">col_set</span><span class="o">=</span><span class="p">[</span><span class="s2">"feature"</span><span class="p">,</span> <span class="s2">"label"</span><span class="p">],</span> <span class="n">data_key</span><span class="o">=</span><span class="n">DataHandlerLP</span><span class="o">.</span><span class="n">DK_L</span>
<span class="p">)</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s2">"feature"</span><span class="p">],</span> <span class="n">df_train</span><span class="p">[</span><span class="s2">"label"</span><span class="p">]</span>
<span class="n">x_valid</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="n">df_valid</span><span class="p">[</span><span class="s2">"feature"</span><span class="p">],</span> <span class="n">df_valid</span><span class="p">[</span><span class="s2">"label"</span><span class="p">]</span>

<span class="c1"># get weights</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">wdf_train</span><span class="p">,</span> <span class="n">wdf_valid</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">prepare</span><span class="p">([</span><span class="s2">"train"</span><span class="p">,</span> <span class="s2">"valid"</span><span class="p">],</span> <span class="n">col_set</span><span class="o">=</span><span class="p">[</span><span class="s2">"weight"</span><span class="p">],</span>
                                           <span class="n">data_key</span><span class="o">=</span><span class="n">DataHandlerLP</span><span class="o">.</span><span class="n">DK_L</span><span class="p">)</span>
    <span class="n">w_train</span><span class="p">,</span> <span class="n">w_valid</span> <span class="o">=</span> <span class="n">wdf_train</span><span class="p">[</span><span class="s2">"weight"</span><span class="p">],</span> <span class="n">wdf_valid</span><span class="p">[</span><span class="s2">"weight"</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">w_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">y_train</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">w_valid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_valid</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">y_valid</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dataset</strong> (<a class="reference internal" href="#qlib.data.dataset.__init__.Dataset" title="qlib.data.dataset.__init__.Dataset"><em>Dataset</em></a>) – dataset will generate the processed data from model training.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.base.Model.predict">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">slice</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'test'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#qlib.model.base.Model.predict" title="Permalink to this definition"></a></dt>
<dd><p>give prediction given Dataset</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<a class="reference internal" href="#qlib.data.dataset.__init__.Dataset" title="qlib.data.dataset.__init__.Dataset"><em>Dataset</em></a>) – dataset will generate the processed dataset from model training.</p></li>
<li><p><strong>segment</strong> (<em>Text</em><em> or </em><em>slice</em>) – dataset will use this segment to prepare data. (default=test)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Prediction results with certain type such as <cite>pandas.Series</cite>.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.base.ModelFT">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.base.</span></span><span class="sig-name descname"><span class="pre">ModelFT</span></span><a class="headerlink" href="#qlib.model.base.ModelFT" title="Permalink to this definition"></a></dt>
<dd><p>Model (F)ine(t)unable</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.base.ModelFT.finetune">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">finetune</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.base.ModelFT.finetune" title="Permalink to this definition"></a></dt>
<dd><p>finetune model based given dataset</p>
<p>A typical use case of finetuning model with qlib.workflow.R</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># start exp to train init model</span>
<span class="k">with</span> <span class="n">R</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">experiment_name</span><span class="o">=</span><span class="s2">"init models"</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="n">R</span><span class="o">.</span><span class="n">save_objects</span><span class="p">(</span><span class="n">init_model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
    <span class="n">rid</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">get_recorder</span><span class="p">()</span><span class="o">.</span><span class="n">id</span>

<span class="c1"># Finetune model based on previous trained model</span>
<span class="k">with</span> <span class="n">R</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">experiment_name</span><span class="o">=</span><span class="s2">"finetune model"</span><span class="p">):</span>
    <span class="n">recorder</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">get_recorder</span><span class="p">(</span><span class="n">recorder_id</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="s2">"init models"</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">recorder</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="s2">"init_model"</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">finetune</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">num_boost_round</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dataset</strong> (<a class="reference internal" href="#qlib.data.dataset.__init__.Dataset" title="qlib.data.dataset.__init__.Dataset"><em>Dataset</em></a>) – dataset will generate the processed dataset from model training.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.contrib.strategy">
<span id="strategy"></span><h3>Strategy<a class="headerlink" href="#module-qlib.contrib.strategy" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.contrib.strategy.TopkDropoutStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.contrib.strategy.</span></span><span class="sig-name descname"><span class="pre">TopkDropoutStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_drop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method_sell</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'bottom'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method_buy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'top'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hold_thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">only_tradable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forbid_all_trade_at_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.TopkDropoutStrategy" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.TopkDropoutStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_drop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method_sell</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'bottom'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method_buy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'top'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hold_thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">only_tradable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forbid_all_trade_at_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.TopkDropoutStrategy.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topk</strong> (<em>int</em>) – the number of stocks in the portfolio.</p></li>
<li><p><strong>n_drop</strong> (<em>int</em>) – number of stocks to be replaced in each trading date.</p></li>
<li><p><strong>method_sell</strong> (<em>str</em>) – dropout method_sell, random/bottom.</p></li>
<li><p><strong>method_buy</strong> (<em>str</em>) – dropout method_buy, random/top.</p></li>
<li><p><strong>hold_thresh</strong> (<em>int</em>) – minimum holding days
before sell stock , will check current.get_stock_count(order.stock_id) &gt;= self.hold_thresh.</p></li>
<li><p><strong>only_tradable</strong> (<em>bool</em>) – <p>will the strategy only consider the tradable stock when buying and selling.</p>
<p>if only_tradable:</p>
<blockquote>
<div><p>strategy will make decision with the tradable state of the stock info and avoid buy and sell them.</p>
</div></blockquote>
<p>else:</p>
<blockquote>
<div><p>strategy will make buy sell decision without checking the tradable state of the stock.</p>
</div></blockquote>
</p></li>
<li><p><strong>forbid_all_trade_at_limit</strong> (<em>bool</em>) – <p>if forbid all trades when limit_up or limit_down reached.</p>
<p>if forbid_all_trade_at_limit:</p>
<blockquote>
<div><p>strategy will not do any trade when price reaches limit up/down, even not sell at limit up nor buy at
limit down, though allowed in reality.</p>
</div></blockquote>
<p>else:</p>
<blockquote>
<div><p>strategy will sell at limit up and buy ad limit down.</p>
</div></blockquote>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.TopkDropoutStrategy.generate_trade_decision">
<span class="sig-name descname"><span class="pre">generate_trade_decision</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">execute_result</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.TopkDropoutStrategy.generate_trade_decision" title="Permalink to this definition"></a></dt>
<dd><p>Generate trade decision in each trading bar</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>execute_result</strong> (<em>List</em><em>[</em><em>object</em><em>]</em><em>, </em><em>optional</em>) – <p>the executed result for trade decision, by default None</p>
<ul class="simple">
<li><p>When call the generate_trade_decision firstly, <cite>execute_result</cite> could be None</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.contrib.strategy.WeightStrategyBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.contrib.strategy.</span></span><span class="sig-name descname"><span class="pre">WeightStrategyBase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_generator_cls_or_obj=&lt;class</span> <span class="pre">'qlib.contrib.strategy.order_generator.OrderGenWOInteract'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.WeightStrategyBase" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.WeightStrategyBase.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_generator_cls_or_obj=&lt;class</span> <span class="pre">'qlib.contrib.strategy.order_generator.OrderGenWOInteract'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.WeightStrategyBase.__init__" title="Permalink to this definition"></a></dt>
<dd><dl>
<dt>signal :</dt><dd><p>the information to describe a signal. Please refer to the docs of <cite>qlib.backtest.signal.create_signal_from</cite>
the decision of the strategy will base on the given signal</p>
</dd>
<dt>trade_exchange<span class="classifier">Exchange</span></dt><dd><p>exchange that provides market info, used to deal order and generate report</p>
<ul>
<li><p>If <cite>trade_exchange</cite> is None, self.trade_exchange will be set with common_infra</p></li>
<li><p>It allowes different trade_exchanges is used in different executions.</p></li>
<li><p>For example:</p>
<blockquote>
<div><ul class="simple">
<li><p>In daily execution, both daily exchange and minutely are usable, but the daily exchange is recommended because it runs faster.</p></li>
<li><p>In minutely execution, the daily exchange is not usable, only the minutely exchange is recommended.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.WeightStrategyBase.generate_target_weight_position">
<span class="sig-name descname"><span class="pre">generate_target_weight_position</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">score</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_end_time</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.WeightStrategyBase.generate_target_weight_position" title="Permalink to this definition"></a></dt>
<dd><p>Generate target position from score for this date and the current position.The cash is not considered in the position</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>score</strong> (<em>pd.Series</em>) – pred score for this trade date, index is stock_id, contain ‘score’ column.</p></li>
<li><p><strong>current</strong> (<em>Position</em><em>(</em><em>)</em>) – current position.</p></li>
<li><p><strong>trade_start_time</strong> (<em>pd.Timestamp</em>) – </p></li>
<li><p><strong>trade_end_time</strong> (<em>pd.Timestamp</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.WeightStrategyBase.generate_trade_decision">
<span class="sig-name descname"><span class="pre">generate_trade_decision</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">execute_result</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.WeightStrategyBase.generate_trade_decision" title="Permalink to this definition"></a></dt>
<dd><p>Generate trade decision in each trading bar</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>execute_result</strong> (<em>List</em><em>[</em><em>object</em><em>]</em><em>, </em><em>optional</em>) – <p>the executed result for trade decision, by default None</p>
<ul class="simple">
<li><p>When call the generate_trade_decision firstly, <cite>execute_result</cite> could be None</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.contrib.strategy.EnhancedIndexingStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.contrib.strategy.</span></span><span class="sig-name descname"><span class="pre">EnhancedIndexingStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">riskmodel_root</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">market</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'csi500'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">turn_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.EnhancedIndexingStrategy" title="Permalink to this definition"></a></dt>
<dd><p>Enhanced Indexing Strategy</p>
<p>Enhanced indexing combines the arts of active management and passive management,
with the aim of outperforming a benchmark index (e.g., S&amp;P 500) in terms of
portfolio return while controlling the risk exposure (a.k.a. tracking error).</p>
<p>Users need to prepare their risk model data like below:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>├── /path/to/riskmodel
├──── 20210101
├────── factor_exp.{csv|pkl|h5}
├────── factor_cov.{csv|pkl|h5}
├────── specific_risk.{csv|pkl|h5}
├────── blacklist.{csv|pkl|h5}  # optional
</pre></div>
</div>
<p>The risk model data can be obtained from risk data provider. You can also use
<cite>qlib.model.riskmodel.structured.StructuredCovEstimator</cite> to prepare these data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>riskmodel_path</strong> (<em>str</em>) – risk model path</p></li>
<li><p><strong>name_mapping</strong> (<em>dict</em>) – alternative file names</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.EnhancedIndexingStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">riskmodel_root</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">market</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'csi500'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">turn_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.EnhancedIndexingStrategy.__init__" title="Permalink to this definition"></a></dt>
<dd><dl>
<dt>signal :</dt><dd><p>the information to describe a signal. Please refer to the docs of <cite>qlib.backtest.signal.create_signal_from</cite>
the decision of the strategy will base on the given signal</p>
</dd>
<dt>trade_exchange<span class="classifier">Exchange</span></dt><dd><p>exchange that provides market info, used to deal order and generate report</p>
<ul>
<li><p>If <cite>trade_exchange</cite> is None, self.trade_exchange will be set with common_infra</p></li>
<li><p>It allowes different trade_exchanges is used in different executions.</p></li>
<li><p>For example:</p>
<blockquote>
<div><ul class="simple">
<li><p>In daily execution, both daily exchange and minutely are usable, but the daily exchange is recommended because it runs faster.</p></li>
<li><p>In minutely execution, the daily exchange is not usable, only the minutely exchange is recommended.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.EnhancedIndexingStrategy.generate_target_weight_position">
<span class="sig-name descname"><span class="pre">generate_target_weight_position</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">score</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_end_time</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.EnhancedIndexingStrategy.generate_target_weight_position" title="Permalink to this definition"></a></dt>
<dd><p>Generate target position from score for this date and the current position.The cash is not considered in the position</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>score</strong> (<em>pd.Series</em>) – pred score for this trade date, index is stock_id, contain ‘score’ column.</p></li>
<li><p><strong>current</strong> (<em>Position</em><em>(</em><em>)</em>) – current position.</p></li>
<li><p><strong>trade_start_time</strong> (<em>pd.Timestamp</em>) – </p></li>
<li><p><strong>trade_end_time</strong> (<em>pd.Timestamp</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.contrib.strategy.TWAPStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.contrib.strategy.</span></span><span class="sig-name descname"><span class="pre">TWAPStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_exchange</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Exchange</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.TWAPStrategy" title="Permalink to this definition"></a></dt>
<dd><p>TWAP Strategy for trading</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>This TWAP strategy will celling round when trading. This will make the TWAP trading strategy produce the order
earlier when the total trade unit of amount is less than the trading step</p></li>
</ul>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.TWAPStrategy.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.TWAPStrategy.reset" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>outer_trade_decision</strong> (<em>BaseTradeDecision</em><em>, </em><em>optional</em>) – </p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.TWAPStrategy.generate_trade_decision">
<span class="sig-name descname"><span class="pre">generate_trade_decision</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">execute_result</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.TWAPStrategy.generate_trade_decision" title="Permalink to this definition"></a></dt>
<dd><p>Generate trade decision in each trading bar</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>execute_result</strong> (<em>List</em><em>[</em><em>object</em><em>]</em><em>, </em><em>optional</em>) – <p>the executed result for trade decision, by default None</p>
<ul class="simple">
<li><p>When call the generate_trade_decision firstly, <cite>execute_result</cite> could be None</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SBBStrategyBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.contrib.strategy.</span></span><span class="sig-name descname"><span class="pre">SBBStrategyBase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_exchange</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Exchange</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SBBStrategyBase" title="Permalink to this definition"></a></dt>
<dd><p>(S)elect the (B)etter one among every two adjacent trading (B)ars to sell or buy.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SBBStrategyBase.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SBBStrategyBase.reset" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>outer_trade_decision</strong> (<em>BaseTradeDecision</em><em>, </em><em>optional</em>) – </p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SBBStrategyBase.generate_trade_decision">
<span class="sig-name descname"><span class="pre">generate_trade_decision</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">execute_result</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SBBStrategyBase.generate_trade_decision" title="Permalink to this definition"></a></dt>
<dd><p>Generate trade decision in each trading bar</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>execute_result</strong> (<em>List</em><em>[</em><em>object</em><em>]</em><em>, </em><em>optional</em>) – <p>the executed result for trade decision, by default None</p>
<ul class="simple">
<li><p>When call the generate_trade_decision firstly, <cite>execute_result</cite> could be None</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SBBStrategyEMA">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.contrib.strategy.</span></span><span class="sig-name descname"><span class="pre">SBBStrategyEMA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'csi300'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_exchange</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Exchange</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SBBStrategyEMA" title="Permalink to this definition"></a></dt>
<dd><p>(S)elect the (B)etter one among every two adjacent trading (B)ars to sell or buy with (EMA) signal.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SBBStrategyEMA.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instruments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'csi300'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_exchange</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Exchange</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SBBStrategyEMA.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instruments</strong> (<em>Union</em><em>[</em><em>List</em><em>, </em><em>str</em><em>]</em><em>, </em><em>optional</em>) – instruments of EMA signal, by default “csi300”</p></li>
<li><p><strong>freq</strong> (<em>str</em><em>, </em><em>optional</em>) – freq of EMA signal, by default “day”
Note: <cite>freq</cite> may be different from <cite>time_per_step</cite></p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SBBStrategyEMA.reset_level_infra">
<span class="sig-name descname"><span class="pre">reset_level_infra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">level_infra</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SBBStrategyEMA.reset_level_infra" title="Permalink to this definition"></a></dt>
<dd><p>reset level-shared infra
- After reset the trade calendar, the signal will be changed</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SoftTopkStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.contrib.strategy.</span></span><span class="sig-name descname"><span class="pre">SoftTopkStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_generator_cls_or_obj=&lt;class</span> <span class="pre">'qlib.contrib.strategy.order_generator.OrderGenWInteract'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sold_weight=1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">risk_degree=0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buy_method='first_fill'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_exchange=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SoftTopkStrategy" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SoftTopkStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_generator_cls_or_obj=&lt;class</span> <span class="pre">'qlib.contrib.strategy.order_generator.OrderGenWInteract'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sold_weight=1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">risk_degree=0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buy_method='first_fill'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_exchange=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SoftTopkStrategy.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topk</strong> (<em>int</em>) – top-N stocks to buy</p></li>
<li><p><strong>risk_degree</strong> (<em>float</em>) – <p>position percentage of total value buy_method:</p>
<blockquote>
<div><p>rank_fill: assign the weight stocks that rank high first(1/topk max)
average_fill: assign the weight to the stocks rank high averagely.</p>
</div></blockquote>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SoftTopkStrategy.get_risk_degree">
<span class="sig-name descname"><span class="pre">get_risk_degree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trade_step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SoftTopkStrategy.get_risk_degree" title="Permalink to this definition"></a></dt>
<dd><p>Return the proportion of your total value you will used in investment.
Dynamically risk_degree will result in Market timing</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.contrib.strategy.SoftTopkStrategy.generate_target_weight_position">
<span class="sig-name descname"><span class="pre">generate_target_weight_position</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">score</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_end_time</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.strategy.SoftTopkStrategy.generate_target_weight_position" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>score</strong> – pred score for this trade date, pd.Series, index is stock_id, contain ‘score’ column</p></li>
<li><p><strong>current</strong> – current position, use Position() class</p></li>
<li><p><strong>trade_date</strong> – <p>trade date</p>
<p>generate target position from score for this date and the current position</p>
<p>The cache is not considered in the position</p>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.contrib.evaluate">
<span id="evaluate"></span><h3>Evaluate<a class="headerlink" href="#module-qlib.contrib.evaluate" title="Permalink to this heading"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.contrib.evaluate.risk_analysis">
<span class="sig-prename descclassname"><span class="pre">qlib.contrib.evaluate.</span></span><span class="sig-name descname"><span class="pre">risk_analysis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.evaluate.risk_analysis" title="Permalink to this definition"></a></dt>
<dd><p>Risk Analysis
NOTE:
The calculation of annulaized return is different from the definition of annualized return.
It is implemented by design.
Qlib tries to cumulated returns by summation instead of production to avoid the cumulated curve being skewed exponentially.
All the calculation of annualized returns follows this principle in Qlib.</p>
<p>TODO: add a parameter to enable calculating metrics with production accumulation of return.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r</strong> (<em>pandas.Series</em>) – daily return series.</p></li>
<li><p><strong>N</strong> (<em>int</em>) – scaler for annualizing information_ratio (day: 252, week: 50, month: 12), at least one of <cite>N</cite> and <cite>freq</cite> should exist</p></li>
<li><p><strong>freq</strong> (<em>str</em>) – analysis frequency used for calculating the scaler, at least one of <cite>N</cite> and <cite>freq</cite> should exist</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.contrib.evaluate.indicator_analysis">
<span class="sig-prename descclassname"><span class="pre">qlib.contrib.evaluate.</span></span><span class="sig-name descname"><span class="pre">indicator_analysis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.evaluate.indicator_analysis" title="Permalink to this definition"></a></dt>
<dd><p>analyze statistical time-series indicators of trading</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pandas.DataFrame</em>) – <dl class="simple">
<dt>columns: like [‘pa’, ‘pos’, ‘ffr’, ‘deal_amount’, ‘value’].</dt><dd><dl class="simple">
<dt>Necessary fields:</dt><dd><ul>
<li><p>’pa’ is the price advantage in trade indicators</p></li>
<li><p>’pos’ is the positive rate in trade indicators</p></li>
<li><p>’ffr’ is the fulfill rate in trade indicators</p></li>
</ul>
</dd>
<dt>Optional fields:</dt><dd><ul>
<li><p>’deal_amount’ is the total deal deal_amount, only necessary when method is ‘amount_weighted’</p></li>
<li><p>’value’ is the total trade value, only necessary when method is ‘value_weighted’</p></li>
</ul>
</dd>
</dl>
</dd>
</dl>
<p>index: Index(datetime)</p>
</p></li>
<li><p><strong>method</strong> (<em>str</em><em>, </em><em>optional</em>) – <p>statistics method of pa/ffr, by default “mean”</p>
<ul>
<li><p>if method is ‘mean’, count the mean statistical value of each trade indicator</p></li>
<li><p>if method is ‘amount_weighted’, count the deal_amount weighted mean statistical value of each trade indicator</p></li>
<li><p>if method is ‘value_weighted’, count the value weighted mean statistical value of each trade indicator</p></li>
</ul>
<p>Note: statistics method of pos is always “mean”</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>statistical value of each trade indicators</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.contrib.evaluate.backtest_daily">
<span class="sig-prename descclassname"><span class="pre">qlib.contrib.evaluate.</span></span><span class="sig-name descname"><span class="pre">backtest_daily</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">BaseStrategy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">executor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">BaseExecutor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Position</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchmark</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'SH000300'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exchange_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pos_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Position'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.evaluate.backtest_daily" title="Permalink to this definition"></a></dt>
<dd><p>initialize the strategy and executor, then executor the backtest of daily frequency</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_time</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>pd.Timestamp</em><em>]</em>) – closed start time for backtest
<strong>NOTE</strong>: This will be applied to the outmost executor’s calendar.</p></li>
<li><p><strong>end_time</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>pd.Timestamp</em><em>]</em>) – closed end time for backtest
<strong>NOTE</strong>: This will be applied to the outmost executor’s calendar.
E.g. Executor[day](Executor[1min]),   setting <cite>end_time == 20XX0301</cite> will include all the minutes on 20XX0301</p></li>
<li><p><strong>strategy</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>dict</em><em>, </em><em>BaseStrategy</em><em>]</em>) – <p>for initializing outermost portfolio strategy. Please refer to the docs of init_instance_by_config for more information.</p>
<p>E.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># dict</span>
<span class="n">strategy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"TopkDropoutStrategy"</span><span class="p">,</span>
    <span class="s2">"module_path"</span><span class="p">:</span> <span class="s2">"qlib.contrib.strategy.signal_strategy"</span><span class="p">,</span>
    <span class="s2">"kwargs"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"signal"</span><span class="p">:</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataset</span><span class="p">),</span>
        <span class="s2">"topk"</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s2">"n_drop"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
<span class="c1"># BaseStrategy</span>
<span class="n">pred_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">"score.pkl"</span><span class="p">)[</span><span class="s2">"score"</span><span class="p">]</span>
<span class="n">STRATEGY_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"topk"</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">"n_drop"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">"signal"</span><span class="p">:</span> <span class="n">pred_score</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">strategy</span> <span class="o">=</span> <span class="n">TopkDropoutStrategy</span><span class="p">(</span><span class="o">**</span><span class="n">STRATEGY_CONFIG</span><span class="p">)</span>
<span class="c1"># str example.</span>
<span class="c1"># 1) specify a pickle object</span>
<span class="c1">#     - path like 'file:///&lt;path to pickle file&gt;/obj.pkl'</span>
<span class="c1"># 2) specify a class name</span>
<span class="c1">#     - "ClassName":  getattr(module, "ClassName")() will be used.</span>
<span class="c1"># 3) specify module path with class name</span>
<span class="c1">#     - "a.b.c.ClassName" getattr(&lt;a.b.c.module&gt;, "ClassName")() will be used.</span>
</pre></div>
</div>
</p></li>
<li><p><strong>executor</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>dict</em><em>, </em><em>BaseExecutor</em><em>]</em>) – for initializing the outermost executor.</p></li>
<li><p><strong>benchmark</strong> (<em>str</em>) – the benchmark for reporting.</p></li>
<li><p><strong>account</strong> (<em>Union</em><em>[</em><em>float</em><em>, </em><em>int</em><em>, </em><em>Position</em><em>]</em>) – <p>information for describing how to creating the account</p>
<p>For <cite>float</cite> or <cite>int</cite>:</p>
<blockquote>
<div><p>Using Account with only initial cash</p>
</div></blockquote>
<p>For <cite>Position</cite>:</p>
<blockquote>
<div><p>Using Account with a Position</p>
</div></blockquote>
</p></li>
<li><p><strong>exchange_kwargs</strong> (<em>dict</em>) – <p>the kwargs for initializing Exchange
E.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">exchange_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"freq"</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span>
    <span class="s2">"limit_threshold"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># limit_threshold is None, using C.limit_threshold</span>
    <span class="s2">"deal_price"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># deal_price is None, using C.deal_price</span>
    <span class="s2">"open_cost"</span><span class="p">:</span> <span class="mf">0.0005</span><span class="p">,</span>
    <span class="s2">"close_cost"</span><span class="p">:</span> <span class="mf">0.0015</span><span class="p">,</span>
    <span class="s2">"min_cost"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</p></li>
<li><p><strong>pos_type</strong> (<em>str</em>) – the type of Position.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>report_normal</strong> (<em>pd.DataFrame</em>) – backtest report</p></li>
<li><p><strong>positions_normal</strong> (<em>pd.DataFrame</em>) – backtest positions</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.contrib.evaluate.long_short_backtest">
<span class="sig-prename descclassname"><span class="pre">qlib.contrib.evaluate.</span></span><span class="sig-name descname"><span class="pre">long_short_backtest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deal_price</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">open_cost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">close_cost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_unit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_cost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subscribe_fields</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extract_codes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.contrib.evaluate.long_short_backtest" title="Permalink to this definition"></a></dt>
<dd><p>A backtest for long-short strategy</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pred</strong> – The trading signal produced on day <cite>T</cite>.</p></li>
<li><p><strong>topk</strong> – The short topk securities and long topk securities.</p></li>
<li><p><strong>deal_price</strong> – The price to deal the trading.</p></li>
<li><p><strong>shift</strong> – Whether to shift prediction by one day.  The trading day will be T+1 if shift==1.</p></li>
<li><p><strong>open_cost</strong> – open transaction cost.</p></li>
<li><p><strong>close_cost</strong> – close transaction cost.</p></li>
<li><p><strong>trade_unit</strong> – 100 for China A.</p></li>
<li><p><strong>limit_threshold</strong> – limit move 0.1 (10%) for example, long and short with same limit.</p></li>
<li><p><strong>min_cost</strong> – min transaction cost.</p></li>
<li><p><strong>subscribe_fields</strong> – subscribe fields.</p></li>
<li><p><strong>extract_codes</strong> – bool.
will we pass the codes extracted from the pred to the exchange.
NOTE: This will be faster with offline qlib.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The result of backtest, it is represented by a dict.
{ “long”: long_returns(excess),
“short”: short_returns(excess),
“long_short”: long_short_returns}</p>
</dd>
</dl>
</dd></dl>
</section>
<section id="report">
<h3>Report<a class="headerlink" href="#report" title="Permalink to this heading"></a></h3>
</section>
</section>
<section id="workflow">
<h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this heading"></a></h2>
<section id="experiment-manager">
<h3>Experiment Manager<a class="headerlink" href="#experiment-manager" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.expm.</span></span><span class="sig-name descname"><span class="pre">ExpManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_exp_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.expm.ExpManager" title="Permalink to this definition"></a></dt>
<dd><p>This is the <cite>ExpManager</cite> class for managing experiments. The API is designed similar to mlflow.
(The link: <a class="reference external" href="https://mlflow.org/docs/latest/python_api/mlflow.html">https://mlflow.org/docs/latest/python_api/mlflow.html</a>)</p>
<p>The <cite>ExpManager</cite> is expected to be a singleton (btw, we can have multiple <cite>Experiment`s with different uri. user can get different experiments from different uri, and then compare records of them). Global Config (i.e. `C</cite>)  is also a singleton.</p>
<p>So we try to align them together.  They share the same variable, which is called <strong>default uri</strong>. Please refer to <cite>ExpManager.default_uri</cite> for details of variable sharing.</p>
<p>When the user starts an experiment, the user may want to set the uri to a specific uri (it will override <strong>default uri</strong> during this period), and then unset the <strong>specific uri</strong> and fallback to the <strong>default uri</strong>.    <cite>ExpManager._active_exp_uri</cite> is that <strong>specific uri</strong>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_exp_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.start_exp">
<span class="sig-name descname"><span class="pre">start_exp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uri</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resume</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><a class="reference internal" href="#qlib.workflow.exp.Experiment" title="qlib.workflow.exp.Experiment"><span class="pre">Experiment</span></a></span></span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.start_exp" title="Permalink to this definition"></a></dt>
<dd><p>Start an experiment. This method includes first get_or_create an experiment, and then
set it to be active.</p>
<p>Maintaining <cite>_active_exp_uri</cite> is included in start_exp, remaining implementation should be included in _end_exp in subclass</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_id</strong> (<em>str</em>) – id of the active experiment.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – name of the active experiment.</p></li>
<li><p><strong>recorder_id</strong> (<em>str</em>) – id of the recorder to be started.</p></li>
<li><p><strong>recorder_name</strong> (<em>str</em>) – name of the recorder to be started.</p></li>
<li><p><strong>uri</strong> (<em>str</em>) – the current tracking URI.</p></li>
<li><p><strong>resume</strong> (<em>boolean</em>) – whether to resume the experiment and recorder.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>An active experiment.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.end_exp">
<span class="sig-name descname"><span class="pre">end_exp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder_status</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'SCHEDULED'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.end_exp" title="Permalink to this definition"></a></dt>
<dd><p>End an active experiment.</p>
<p>Maintaining <cite>_active_exp_uri</cite> is included in end_exp, remaining implementation should be included in _end_exp in subclass</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_name</strong> (<em>str</em>) – name of the active experiment.</p></li>
<li><p><strong>recorder_status</strong> (<em>str</em>) – the status of the active recorder of the experiment.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.create_exp">
<span class="sig-name descname"><span class="pre">create_exp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.create_exp" title="Permalink to this definition"></a></dt>
<dd><p>Create an experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>experiment_name</strong> (<em>str</em>) – the experiment name, which must be unique.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>An experiment object.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ExpAlreadyExistError</strong> – </p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.search_records">
<span class="sig-name descname"><span class="pre">search_records</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.search_records" title="Permalink to this definition"></a></dt>
<dd><p>Get a pandas DataFrame of records that fit the search criteria of the experiment.
Inputs are the search criteria user want to apply.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>A pandas.DataFrame of records, where each metric, parameter, and tag</em></p></li>
<li><p><em>are expanded into their own columns named metrics.</em>, params.*, and tags.**</p></li>
<li><p><em>respectively. For records that don’t have a particular metric, parameter, or tag, their</em></p></li>
<li><p><em>value will be (NumPy) Nan, None, or None respectively.</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.get_exp">
<span class="sig-name descname"><span class="pre">get_exp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">create</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.get_exp" title="Permalink to this definition"></a></dt>
<dd><p>Retrieve an experiment. This method includes getting an active experiment, and get_or_create a specific experiment.</p>
<p>When user specify experiment id and name, the method will try to return the specific experiment.
When user does not provide recorder id or name, the method will try to return the current active experiment.
The <cite>create</cite> argument determines whether the method will automatically create a new experiment according
to user’s specification if the experiment hasn’t been created before.</p>
<ul>
<li><p>If <cite>create</cite> is True:</p>
<blockquote>
<div><ul>
<li><p>If <cite>active experiment</cite> exists:</p>
<blockquote>
<div><ul class="simple">
<li><p>no id or name specified, return the active experiment.</p></li>
<li><p>if id or name is specified, return the specified experiment. If no such exp found, create a new experiment with given id or name. If <cite>start</cite> is set to be True, the experiment is set to be active.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If <cite>active experiment</cite> not exists:</p>
<blockquote>
<div><ul class="simple">
<li><p>no id or name specified, create a default experiment.</p></li>
<li><p>if id or name is specified, return the specified experiment. If no such exp found, create a new experiment with given id or name. If <cite>start</cite> is set to be True, the experiment is set to be active.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Else If <cite>create</cite> is False:</p>
<blockquote>
<div><ul>
<li><p>If <cite>active experiment</cite> exists:</p>
<blockquote>
<div><ul class="simple">
<li><p>no id or name specified, return the active experiment.</p></li>
<li><p>if id or name is specified, return the specified experiment. If no such exp found, raise Error.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If <cite>active experiment</cite> not exists:</p>
<blockquote>
<div><ul class="simple">
<li><p>no id or name specified. If the default experiment exists, return it, otherwise, raise Error.</p></li>
<li><p>if id or name is specified, return the specified experiment. If no such exp found, raise Error.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_id</strong> (<em>str</em>) – id of the experiment to return.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – name of the experiment to return.</p></li>
<li><p><strong>create</strong> (<em>boolean</em>) – create the experiment it if hasn’t been created before.</p></li>
<li><p><strong>start</strong> (<em>boolean</em>) – start the new experiment if one is created.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>An experiment object.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.delete_exp">
<span class="sig-name descname"><span class="pre">delete_exp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.delete_exp" title="Permalink to this definition"></a></dt>
<dd><p>Delete an experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_id</strong> (<em>str</em>) – the experiment id.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the experiment name.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.default_uri">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">default_uri</span></span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.default_uri" title="Permalink to this definition"></a></dt>
<dd><p>Get the default tracking URI from qlib.config.C</p>
</dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.uri">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">uri</span></span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.uri" title="Permalink to this definition"></a></dt>
<dd><p>Get the default tracking URI or current URI.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>The tracking URI string.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.expm.ExpManager.list_experiments">
<span class="sig-name descname"><span class="pre">list_experiments</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.expm.ExpManager.list_experiments" title="Permalink to this definition"></a></dt>
<dd><p>List all the existing experiments.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A dictionary (name -&gt; experiment) of experiments information that being stored.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="experiment">
<h3>Experiment<a class="headerlink" href="#experiment" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.exp.Experiment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.exp.</span></span><span class="sig-name descname"><span class="pre">Experiment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.exp.Experiment" title="Permalink to this definition"></a></dt>
<dd><p>This is the <cite>Experiment</cite> class for each experiment being run. The API is designed similar to mlflow.
(The link: <a class="reference external" href="https://mlflow.org/docs/latest/python_api/mlflow.html">https://mlflow.org/docs/latest/python_api/mlflow.html</a>)</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.exp.Experiment.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.exp.Experiment.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.exp.Experiment.start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resume</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.exp.Experiment.start" title="Permalink to this definition"></a></dt>
<dd><p>Start the experiment and set it to be active. This method will also start a new recorder.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>recorder_id</strong> (<em>str</em>) – the id of the recorder to be created.</p></li>
<li><p><strong>recorder_name</strong> (<em>str</em>) – the name of the recorder to be created.</p></li>
<li><p><strong>resume</strong> (<em>bool</em>) – whether to resume the first recorder</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>An active recorder.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.exp.Experiment.end">
<span class="sig-name descname"><span class="pre">end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder_status</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SCHEDULED'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.exp.Experiment.end" title="Permalink to this definition"></a></dt>
<dd><p>End the experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>recorder_status</strong> (<em>str</em>) – the status the recorder to be set with when ending (SCHEDULED, RUNNING, FINISHED, FAILED).</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.exp.Experiment.create_recorder">
<span class="sig-name descname"><span class="pre">create_recorder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.exp.Experiment.create_recorder" title="Permalink to this definition"></a></dt>
<dd><p>Create a recorder for each experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>recorder_name</strong> (<em>str</em>) – the name of the recorder to be created.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>A recorder object.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.exp.Experiment.search_records">
<span class="sig-name descname"><span class="pre">search_records</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.exp.Experiment.search_records" title="Permalink to this definition"></a></dt>
<dd><p>Get a pandas DataFrame of records that fit the search criteria of the experiment.
Inputs are the search criteria user want to apply.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>A pandas.DataFrame of records, where each metric, parameter, and tag</em></p></li>
<li><p><em>are expanded into their own columns named metrics.</em>, params.*, and tags.**</p></li>
<li><p><em>respectively. For records that don’t have a particular metric, parameter, or tag, their</em></p></li>
<li><p><em>value will be (NumPy) Nan, None, or None respectively.</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.exp.Experiment.delete_recorder">
<span class="sig-name descname"><span class="pre">delete_recorder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.exp.Experiment.delete_recorder" title="Permalink to this definition"></a></dt>
<dd><p>Create a recorder for each experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>recorder_id</strong> (<em>str</em>) – the id of the recorder to be deleted.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.exp.Experiment.get_recorder">
<span class="sig-name descname"><span class="pre">get_recorder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">create</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></span><a class="headerlink" href="#qlib.workflow.exp.Experiment.get_recorder" title="Permalink to this definition"></a></dt>
<dd><p>Retrieve a Recorder for user. When user specify recorder id and name, the method will try to return the
specific recorder. When user does not provide recorder id or name, the method will try to return the current
active recorder. The <cite>create</cite> argument determines whether the method will automatically create a new recorder
according to user’s specification if the recorder hasn’t been created before.</p>
<ul>
<li><p>If <cite>create</cite> is True:</p>
<blockquote>
<div><ul>
<li><p>If <cite>active recorder</cite> exists:</p>
<blockquote>
<div><ul class="simple">
<li><p>no id or name specified, return the active recorder.</p></li>
<li><p>if id or name is specified, return the specified recorder. If no such exp found, create a new recorder with given id or name. If <cite>start</cite> is set to be True, the recorder is set to be active.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If <cite>active recorder</cite> not exists:</p>
<blockquote>
<div><ul class="simple">
<li><p>no id or name specified, create a new recorder.</p></li>
<li><p>if id or name is specified, return the specified experiment. If no such exp found, create a new recorder with given id or name. If <cite>start</cite> is set to be True, the recorder is set to be active.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Else If <cite>create</cite> is False:</p>
<blockquote>
<div><ul>
<li><p>If <cite>active recorder</cite> exists:</p>
<blockquote>
<div><ul class="simple">
<li><p>no id or name specified, return the active recorder.</p></li>
<li><p>if id or name is specified, return the specified recorder. If no such exp found, raise Error.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If <cite>active recorder</cite> not exists:</p>
<blockquote>
<div><ul class="simple">
<li><p>no id or name specified, raise Error.</p></li>
<li><p>if id or name is specified, return the specified recorder. If no such exp found, raise Error.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>recorder_id</strong> (<em>str</em>) – the id of the recorder to be deleted.</p></li>
<li><p><strong>recorder_name</strong> (<em>str</em>) – the name of the recorder to be deleted.</p></li>
<li><p><strong>create</strong> (<em>boolean</em>) – create the recorder if it hasn’t been created before.</p></li>
<li><p><strong>start</strong> (<em>boolean</em>) – start the new recorder if one is <strong>created</strong>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>A recorder object.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.exp.Experiment.list_recorders">
<span class="sig-name descname"><span class="pre">list_recorders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'dict'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'list'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'dict'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">flt_kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.exp.Experiment.list_recorders" title="Permalink to this definition"></a></dt>
<dd><p>List all the existing recorders of this experiment. Please first get the experiment instance before calling this method.
If user want to use the method <cite>R.list_recorders()</cite>, please refer to the related API document in <cite>QlibRecorder</cite>.</p>
<dl class="simple">
<dt>flt_kwargs<span class="classifier">dict</span></dt><dd><p>filter recorders by conditions
e.g.  list_recorders(status=Recorder.STATUS_FI)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>if <cite>rtype</cite> == “dict”:</dt><dd><p>A dictionary (id -&gt; recorder) of recorder information that being stored.</p>
</dd>
<dt>elif <cite>rtype</cite> == “list”:</dt><dd><p>A list of Recorder.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>The return type depends on <cite>rtype</cite></p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="recorder">
<h3>Recorder<a class="headerlink" href="#recorder" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.recorder.</span></span><span class="sig-name descname"><span class="pre">Recorder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder" title="Permalink to this definition"></a></dt>
<dd><p>This is the <cite>Recorder</cite> class for logging the experiments. The API is designed similar to mlflow.
(The link: <a class="reference external" href="https://mlflow.org/docs/latest/python_api/mlflow.html">https://mlflow.org/docs/latest/python_api/mlflow.html</a>)</p>
<p>The status of the recorder can be SCHEDULED, RUNNING, FINISHED, FAILED.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.save_objects">
<span class="sig-name descname"><span class="pre">save_objects</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">artifact_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.save_objects" title="Permalink to this definition"></a></dt>
<dd><p>Save objects such as prediction file or model checkpoints to the artifact URI. User
can save object through keywords arguments (name:value).</p>
<p>Please refer to the docs of qlib.workflow:R.save_objects</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>local_path</strong> (<em>str</em>) – if provided, them save the file or directory to the artifact URI.</p></li>
<li><p><strong>artifact_path=None</strong> (<em>str</em>) – the relative path for the artifact to be stored in the URI.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.load_object">
<span class="sig-name descname"><span class="pre">load_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.load_object" title="Permalink to this definition"></a></dt>
<dd><p>Load objects such as prediction file or model checkpoints.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em>) – name of the file to be loaded.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>The saved object.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.start_run">
<span class="sig-name descname"><span class="pre">start_run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.start_run" title="Permalink to this definition"></a></dt>
<dd><p>Start running or resuming the Recorder. The return value can be used as a context manager within a <cite>with</cite> block;
otherwise, you must call end_run() to terminate the current run. (See <cite>ActiveRun</cite> class in mlflow)</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>An active running object (e.g. mlflow.ActiveRun object).</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.end_run">
<span class="sig-name descname"><span class="pre">end_run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.end_run" title="Permalink to this definition"></a></dt>
<dd><p>End an active Recorder.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.log_params">
<span class="sig-name descname"><span class="pre">log_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.log_params" title="Permalink to this definition"></a></dt>
<dd><p>Log a batch of params for the current run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>arguments</strong> (<em>keyword</em>) – key, value pair to be logged as parameters.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.log_metrics">
<span class="sig-name descname"><span class="pre">log_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.log_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Log multiple metrics for the current run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>arguments</strong> (<em>keyword</em>) – key, value pair to be logged as metrics.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.log_artifact">
<span class="sig-name descname"><span class="pre">log_artifact</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">artifact_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.log_artifact" title="Permalink to this definition"></a></dt>
<dd><p>Log a local file or directory as an artifact of the currently active run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>local_path</strong> (<em>str</em>) – Path to the file to write.</p></li>
<li><p><strong>artifact_path</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – If provided, the directory in <code class="docutils literal notranslate"><span class="pre">artifact_uri</span></code> to write to.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.set_tags">
<span class="sig-name descname"><span class="pre">set_tags</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.set_tags" title="Permalink to this definition"></a></dt>
<dd><p>Log a batch of tags for the current run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>arguments</strong> (<em>keyword</em>) – key, value pair to be logged as tags.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.delete_tags">
<span class="sig-name descname"><span class="pre">delete_tags</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.delete_tags" title="Permalink to this definition"></a></dt>
<dd><p>Delete some tags from a run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>keys</strong> (<em>series</em><em> of </em><em>strs</em><em> of </em><em>the keys</em>) – all the name of the tag to be deleted.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.list_artifacts">
<span class="sig-name descname"><span class="pre">list_artifacts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">artifact_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.list_artifacts" title="Permalink to this definition"></a></dt>
<dd><p>List all the artifacts of a recorder.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>artifact_path</strong> (<em>str</em>) – the relative path for the artifact to be stored in the URI.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of artifacts information (name, path, etc.) that being stored.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.download_artifact">
<span class="sig-name descname"><span class="pre">download_artifact</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.download_artifact" title="Permalink to this definition"></a></dt>
<dd><p>Download an artifact file or directory from a run to a local directory if applicable,
and return a local path for it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – Relative source path to the desired artifact.</p></li>
<li><p><strong>dst_path</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – Absolute path of the local filesystem destination directory to which to
download the specified artifacts. This directory must already exist.
If unspecified, the artifacts will either be downloaded to a new
uniquely-named directory on the local filesystem.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Local path of desired artifact.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.list_metrics">
<span class="sig-name descname"><span class="pre">list_metrics</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.list_metrics" title="Permalink to this definition"></a></dt>
<dd><p>List all the metrics of a recorder.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A dictionary of metrics that being stored.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.list_params">
<span class="sig-name descname"><span class="pre">list_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.list_params" title="Permalink to this definition"></a></dt>
<dd><p>List all the params of a recorder.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A dictionary of params that being stored.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.recorder.Recorder.list_tags">
<span class="sig-name descname"><span class="pre">list_tags</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.recorder.Recorder.list_tags" title="Permalink to this definition"></a></dt>
<dd><p>List all the tags of a recorder.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A dictionary of tags that being stored.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.workflow.record_temp">
<span id="record-template"></span><h3>Record Template<a class="headerlink" href="#module-qlib.workflow.record_temp" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.RecordTemp">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.record_temp.</span></span><span class="sig-name descname"><span class="pre">RecordTemp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.RecordTemp" title="Permalink to this definition"></a></dt>
<dd><p>This is the Records Template class that enables user to generate experiment results such as IC and
backtest in a certain format.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.RecordTemp.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.RecordTemp.save" title="Permalink to this definition"></a></dt>
<dd><p>It behaves the same as self.recorder.save_objects.
But it is an easier interface because users don’t have to care about <cite>get_path</cite> and <cite>artifact_path</cite></p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.RecordTemp.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.RecordTemp.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.RecordTemp.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.RecordTemp.generate" title="Permalink to this definition"></a></dt>
<dd><p>Generate certain records such as IC, backtest etc., and save them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>kwargs</strong> – </p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.RecordTemp.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.RecordTemp.load" title="Permalink to this definition"></a></dt>
<dd><p>It behaves the same as self.recorder.load_object.
But it is an easier interface because users don’t have to care about <cite>get_path</cite> and <cite>artifact_path</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – the name for the file to be load.</p></li>
<li><p><strong>parents</strong> (<em>bool</em>) – Each recorder has different <cite>artifact_path</cite>.
So parents recursively find the path in parents
Sub classes has higher priority</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>The stored records.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.RecordTemp.list">
<span class="sig-name descname"><span class="pre">list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.RecordTemp.list" title="Permalink to this definition"></a></dt>
<dd><p>List the supported artifacts.
Users don’t have to consider self.get_path</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of all the supported artifacts.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.RecordTemp.check">
<span class="sig-name descname"><span class="pre">check</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">include_self</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.RecordTemp.check" title="Permalink to this definition"></a></dt>
<dd><p>Check if the records is properly generated and saved.
It is useful in following examples</p>
<ul class="simple">
<li><p>checking if the dependant files complete before generating new things.</p></li>
<li><p>checking if the final files is completed</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>include_self</strong> (<em>bool</em>) – is the file generated by self included</p></li>
<li><p><strong>parents</strong> (<em>bool</em>) – will we check parents</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>FileNotFoundError</strong> – whether the records are stored properly.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.SignalRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.record_temp.</span></span><span class="sig-name descname"><span class="pre">SignalRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.SignalRecord" title="Permalink to this definition"></a></dt>
<dd><p>This is the Signal Record class that generates the signal prediction. This class inherits the <code class="docutils literal notranslate"><span class="pre">RecordTemp</span></code> class.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.SignalRecord.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.SignalRecord.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.SignalRecord.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.SignalRecord.generate" title="Permalink to this definition"></a></dt>
<dd><p>Generate certain records such as IC, backtest etc., and save them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>kwargs</strong> – </p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.SignalRecord.list">
<span class="sig-name descname"><span class="pre">list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.SignalRecord.list" title="Permalink to this definition"></a></dt>
<dd><p>List the supported artifacts.
Users don’t have to consider self.get_path</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of all the supported artifacts.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.ACRecordTemp">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.record_temp.</span></span><span class="sig-name descname"><span class="pre">ACRecordTemp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.ACRecordTemp" title="Permalink to this definition"></a></dt>
<dd><p>Automatically checking record template</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.ACRecordTemp.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.ACRecordTemp.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.ACRecordTemp.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.ACRecordTemp.generate" title="Permalink to this definition"></a></dt>
<dd><p>automatically checking the files and then run the concrete generating task</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.HFSignalRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.record_temp.</span></span><span class="sig-name descname"><span class="pre">HFSignalRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.HFSignalRecord" title="Permalink to this definition"></a></dt>
<dd><p>This is the Signal Analysis Record class that generates the analysis results such as IC and IR. This class inherits the <code class="docutils literal notranslate"><span class="pre">RecordTemp</span></code> class.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.HFSignalRecord.depend_cls">
<span class="sig-name descname"><span class="pre">depend_cls</span></span><a class="headerlink" href="#qlib.workflow.record_temp.HFSignalRecord.depend_cls" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.workflow.record_temp.SignalRecord" title="qlib.workflow.record_temp.SignalRecord"><code class="xref py py-class docutils literal notranslate"><span class="pre">SignalRecord</span></code></a></p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.HFSignalRecord.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.HFSignalRecord.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.HFSignalRecord.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.HFSignalRecord.generate" title="Permalink to this definition"></a></dt>
<dd><p>Generate certain records such as IC, backtest etc., and save them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>kwargs</strong> – </p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.HFSignalRecord.list">
<span class="sig-name descname"><span class="pre">list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.HFSignalRecord.list" title="Permalink to this definition"></a></dt>
<dd><p>List the supported artifacts.
Users don’t have to consider self.get_path</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of all the supported artifacts.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.SigAnaRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.record_temp.</span></span><span class="sig-name descname"><span class="pre">SigAnaRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ana_long_short</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ann_scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">252</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_col</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.SigAnaRecord" title="Permalink to this definition"></a></dt>
<dd><p>This is the Signal Analysis Record class that generates the analysis results such as IC and IR.
This class inherits the <code class="docutils literal notranslate"><span class="pre">RecordTemp</span></code> class.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.SigAnaRecord.depend_cls">
<span class="sig-name descname"><span class="pre">depend_cls</span></span><a class="headerlink" href="#qlib.workflow.record_temp.SigAnaRecord.depend_cls" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.workflow.record_temp.SignalRecord" title="qlib.workflow.record_temp.SignalRecord"><code class="xref py py-class docutils literal notranslate"><span class="pre">SignalRecord</span></code></a></p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.SigAnaRecord.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ana_long_short</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ann_scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">252</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_col</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.SigAnaRecord.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.SigAnaRecord.list">
<span class="sig-name descname"><span class="pre">list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.SigAnaRecord.list" title="Permalink to this definition"></a></dt>
<dd><p>List the supported artifacts.
Users don’t have to consider self.get_path</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of all the supported artifacts.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.PortAnaRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.record_temp.</span></span><span class="sig-name descname"><span class="pre">PortAnaRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">risk_analysis_freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_analysis_freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_analysis_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.PortAnaRecord" title="Permalink to this definition"></a></dt>
<dd><p>This is the Portfolio Analysis Record class that generates the analysis results such as those of backtest. This class inherits the <code class="docutils literal notranslate"><span class="pre">RecordTemp</span></code> class.</p>
<p>The following files will be stored in recorder</p>
<ul>
<li><p>report_normal.pkl &amp; positions_normal.pkl:</p>
<blockquote>
<div><ul class="simple">
<li><p>The return report and detailed positions of the backtest, returned by <cite>qlib/contrib/evaluate.py:backtest</cite></p></li>
</ul>
</div></blockquote>
</li>
<li><p>port_analysis.pkl : The risk analysis of your portfolio, returned by <cite>qlib/contrib/evaluate.py:risk_analysis</cite></p></li>
</ul>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.PortAnaRecord.depend_cls">
<span class="sig-name descname"><span class="pre">depend_cls</span></span><a class="headerlink" href="#qlib.workflow.record_temp.PortAnaRecord.depend_cls" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.workflow.record_temp.SignalRecord" title="qlib.workflow.record_temp.SignalRecord"><code class="xref py py-class docutils literal notranslate"><span class="pre">SignalRecord</span></code></a></p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.PortAnaRecord.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">risk_analysis_freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_analysis_freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_analysis_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.PortAnaRecord.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="simple">
<dt>config[“strategy”]<span class="classifier">dict</span></dt><dd><p>define the strategy class as well as the kwargs.</p>
</dd>
<dt>config[“executor”]<span class="classifier">dict</span></dt><dd><p>define the executor class as well as the kwargs.</p>
</dd>
<dt>config[“backtest”]<span class="classifier">dict</span></dt><dd><p>define the backtest kwargs.</p>
</dd>
<dt>risk_analysis_freq<span class="classifier">str|List[str]</span></dt><dd><p>risk analysis freq of report</p>
</dd>
<dt>indicator_analysis_freq<span class="classifier">str|List[str]</span></dt><dd><p>indicator analysis freq of report</p>
</dd>
<dt>indicator_analysis_method<span class="classifier">str, optional, default by None</span></dt><dd><p>the candidate values include ‘mean’, ‘amount_weighted’, ‘value_weighted’</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.PortAnaRecord.list">
<span class="sig-name descname"><span class="pre">list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.PortAnaRecord.list" title="Permalink to this definition"></a></dt>
<dd><p>List the supported artifacts.
Users don’t have to consider self.get_path</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of all the supported artifacts.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.MultiPassPortAnaRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.record_temp.</span></span><span class="sig-name descname"><span class="pre">MultiPassPortAnaRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pass_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle_init_score</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.MultiPassPortAnaRecord" title="Permalink to this definition"></a></dt>
<dd><p>This is the Multiple Pass Portfolio Analysis Record class that run backtest multiple times and generates the analysis results such as those of backtest. This class inherits the <code class="docutils literal notranslate"><span class="pre">PortAnaRecord</span></code> class.</p>
<p>If shuffle_init_score enabled, the prediction score of the first backtest date will be shuffled, so that initial position will be random.
The shuffle_init_score will only works when the signal is used as &lt;PRED&gt; placeholder. The placeholder will be replaced by pred.pkl saved in recorder.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>recorder</strong> (<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><em>Recorder</em></a>) – The recorder used to save the backtest results.</p></li>
<li><p><strong>pass_num</strong> (<em>int</em>) – The number of backtest passes.</p></li>
<li><p><strong>shuffle_init_score</strong> (<em>bool</em>) – Whether to shuffle the prediction score of the first backtest date.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.MultiPassPortAnaRecord.depend_cls">
<span class="sig-name descname"><span class="pre">depend_cls</span></span><a class="headerlink" href="#qlib.workflow.record_temp.MultiPassPortAnaRecord.depend_cls" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#qlib.workflow.record_temp.SignalRecord" title="qlib.workflow.record_temp.SignalRecord"><code class="xref py py-class docutils literal notranslate"><span class="pre">SignalRecord</span></code></a></p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.MultiPassPortAnaRecord.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pass_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle_init_score</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.MultiPassPortAnaRecord.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>recorder</strong> (<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><em>Recorder</em></a>) – The recorder used to save the backtest results.</p></li>
<li><p><strong>pass_num</strong> (<em>int</em>) – The number of backtest passes.</p></li>
<li><p><strong>shuffle_init_score</strong> (<em>bool</em>) – Whether to shuffle the prediction score of the first backtest date.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.record_temp.MultiPassPortAnaRecord.list">
<span class="sig-name descname"><span class="pre">list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.record_temp.MultiPassPortAnaRecord.list" title="Permalink to this definition"></a></dt>
<dd><p>List the supported artifacts.
Users don’t have to consider self.get_path</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of all the supported artifacts.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
</section>
<section id="task-management">
<h2>Task Management<a class="headerlink" href="#task-management" title="Permalink to this heading"></a></h2>
<section id="module-qlib.workflow.task.gen">
<span id="taskgen"></span><h3>TaskGen<a class="headerlink" href="#module-qlib.workflow.task.gen" title="Permalink to this heading"></a></h3>
<p>TaskGenerator module can generate many tasks based on TaskGen and some task templates.</p>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.task_generator">
<span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.gen.</span></span><span class="sig-name descname"><span class="pre">task_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tasks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">generators</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#qlib.workflow.task.gen.task_generator" title="Permalink to this definition"></a></dt>
<dd><p>Use a list of TaskGen and a list of task templates to generate different tasks.</p>
<p>For examples:</p>
<blockquote>
<div><p>There are 3 task templates a,b,c and 2 TaskGen A,B. A will generates 2 tasks from a template and B will generates 3 tasks from a template.
task_generator([a, b, c], [A, B]) will finally generate 3*2*3 = 18 tasks.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tasks</strong> (<em>List</em><em>[</em><em>dict</em><em>] or </em><em>dict</em>) – a list of task templates or a single task</p></li>
<li><p><strong>generators</strong> (<em>List</em><em>[</em><a class="reference internal" href="#qlib.workflow.task.gen.TaskGen" title="qlib.workflow.task.gen.TaskGen"><em>TaskGen</em></a><em>] or </em><a class="reference internal" href="#qlib.workflow.task.gen.TaskGen" title="qlib.workflow.task.gen.TaskGen"><em>TaskGen</em></a>) – a list of TaskGen or a single TaskGen</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of tasks</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.TaskGen">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.gen.</span></span><span class="sig-name descname"><span class="pre">TaskGen</span></span><a class="headerlink" href="#qlib.workflow.task.gen.TaskGen" title="Permalink to this definition"></a></dt>
<dd><p>The base class for generating different tasks</p>
<p>Example 1:</p>
<blockquote>
<div><p>input: a specific task template and rolling steps</p>
<p>output: rolling version of the tasks</p>
</div></blockquote>
<p>Example 2:</p>
<blockquote>
<div><p>input: a specific task template and losses list</p>
<p>output: a set of tasks with different losses</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.TaskGen.generate">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.task.gen.TaskGen.generate" title="Permalink to this definition"></a></dt>
<dd><p>Generate different tasks based on a task template</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>task</strong> (<em>dict</em>) – a task template</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of tasks</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>List</em>[dict]</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.handler_mod">
<span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.gen.</span></span><span class="sig-name descname"><span class="pre">handler_mod</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling_gen</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.gen.handler_mod" title="Permalink to this definition"></a></dt>
<dd><p>Help to modify the handler end time when using RollingGen
It try to handle the following case</p>
<ul>
<li><p>Hander’s data end_time is earlier than  dataset’s test_data’s segments.</p>
<blockquote>
<div><ul class="simple">
<li><p>To handle this, handler’s data’s end_time is extended.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>If the handler’s end_time is None, then it is not necessary to change it’s end time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task</strong> (<em>dict</em>) – a task template</p></li>
<li><p><strong>rg</strong> (<a class="reference internal" href="#qlib.workflow.task.gen.RollingGen" title="qlib.workflow.task.gen.RollingGen"><em>RollingGen</em></a>) – an instance of RollingGen</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.trunc_segments">
<span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.gen.</span></span><span class="sig-name descname"><span class="pre">trunc_segments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.task.utils.TimeAdjuster" title="qlib.workflow.task.utils.TimeAdjuster"><span class="pre">TimeAdjuster</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">segments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Timestamp</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">days</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'test'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.gen.trunc_segments" title="Permalink to this definition"></a></dt>
<dd><p>To avoid the leakage of future information, the segments should be truncated according to the test start_time</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function will change segments <strong>inplace</strong></p>
</div>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.RollingGen">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.gen.</span></span><span class="sig-name descname"><span class="pre">RollingGen</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rtype:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'expanding'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds_extra_mod_func:</span> <span class="pre">None</span> <span class="pre">|</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">handler_mod&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_key='test'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_key='train'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trunc_days:</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_copy_func:</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">deepcopy&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.gen.RollingGen" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.RollingGen.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rtype:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'expanding'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds_extra_mod_func:</span> <span class="pre">None</span> <span class="pre">|</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">handler_mod&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_key='test'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_key='train'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trunc_days:</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_copy_func:</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">deepcopy&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.gen.RollingGen.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Generate tasks for rolling</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>step</strong> (<em>int</em>) – step to rolling</p></li>
<li><p><strong>rtype</strong> (<em>str</em>) – rolling type (expanding, sliding)</p></li>
<li><p><strong>ds_extra_mod_func</strong> (<em>Callable</em>) – A method like: handler_mod(task: dict, rg: RollingGen)
Do some extra action after generating a task. For example, use <code class="docutils literal notranslate"><span class="pre">handler_mod</span></code> to modify the end time of the handler of a dataset.</p></li>
<li><p><strong>trunc_days</strong> (<em>int</em>) – trunc some data to avoid future information leakage</p></li>
<li><p><strong>task_copy_func</strong> (<em>Callable</em>) – the function to copy entire task. This is very useful when user want to share something between tasks</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.RollingGen.gen_following_tasks">
<span class="sig-name descname"><span class="pre">gen_following_tasks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.task.gen.RollingGen.gen_following_tasks" title="Permalink to this definition"></a></dt>
<dd><p>generating following rolling tasks for <cite>task</cite> until test_end</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task</strong> (<em>dict</em>) – Qlib task format</p></li>
<li><p><strong>test_end</strong> (<em>pd.Timestamp</em>) – the latest rolling task includes <cite>test_end</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the following tasks of <cite>task`(`task</cite> itself is excluded)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[dict]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.RollingGen.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.task.gen.RollingGen.generate" title="Permalink to this definition"></a></dt>
<dd><p>Converting the task into a rolling task.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>task</strong> (<em>dict</em>) – <p>A dict describing a task. For example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DEFAULT_TASK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"model"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"LGBModel"</span><span class="p">,</span>
        <span class="s2">"module_path"</span><span class="p">:</span> <span class="s2">"qlib.contrib.model.gbdt"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"DatasetH"</span><span class="p">,</span>
        <span class="s2">"module_path"</span><span class="p">:</span> <span class="s2">"qlib.data.dataset"</span><span class="p">,</span>
        <span class="s2">"kwargs"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"handler"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"Alpha158"</span><span class="p">,</span>
                <span class="s2">"module_path"</span><span class="p">:</span> <span class="s2">"qlib.contrib.data.handler"</span><span class="p">,</span>
                <span class="s2">"kwargs"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"start_time"</span><span class="p">:</span> <span class="s2">"2008-01-01"</span><span class="p">,</span>
                    <span class="s2">"end_time"</span><span class="p">:</span> <span class="s2">"2020-08-01"</span><span class="p">,</span>
                    <span class="s2">"fit_start_time"</span><span class="p">:</span> <span class="s2">"2008-01-01"</span><span class="p">,</span>
                    <span class="s2">"fit_end_time"</span><span class="p">:</span> <span class="s2">"2014-12-31"</span><span class="p">,</span>
                    <span class="s2">"instruments"</span><span class="p">:</span> <span class="s2">"csi100"</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">"segments"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"train"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"2008-01-01"</span><span class="p">,</span> <span class="s2">"2014-12-31"</span><span class="p">),</span>
                <span class="s2">"valid"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"2015-01-01"</span><span class="p">,</span> <span class="s2">"2016-12-20"</span><span class="p">),</span>  <span class="c1"># Please avoid leaking the future test data into validation</span>
                <span class="s2">"test"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"2017-01-01"</span><span class="p">,</span> <span class="s2">"2020-08-01"</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">"record"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"SignalRecord"</span><span class="p">,</span>
            <span class="s2">"module_path"</span><span class="p">:</span> <span class="s2">"qlib.workflow.record_temp"</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>List[dict]</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of tasks</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.MultiHorizonGenBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.gen.</span></span><span class="sig-name descname"><span class="pre">MultiHorizonGenBase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">horizon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[5]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_leak_n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.gen.MultiHorizonGenBase" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.MultiHorizonGenBase.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">horizon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[5]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_leak_n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.gen.MultiHorizonGenBase.__init__" title="Permalink to this definition"></a></dt>
<dd><p>This task generator tries to generate tasks for different horizons based on an existing task</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>horizon</strong> (<em>List</em><em>[</em><em>int</em><em>]</em>) – the possible horizons of the tasks</p></li>
<li><p><strong>label_leak_n</strong> (<em>int</em>) – How many future days it will take to get complete label after the day making prediction
For example:
- User make prediction on day <cite>T`(after getting the close price on `T</cite>)
- The label is the return of buying stock on <cite>T + 1</cite> and selling it on <cite>T + 2</cite>
- the <cite>label_leak_n</cite> will be 2 (e.g. two days of information is leaked to leverage this sample)</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.MultiHorizonGenBase.set_horizon">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">set_horizon</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.gen.MultiHorizonGenBase.set_horizon" title="Permalink to this definition"></a></dt>
<dd><p>This method is designed to change the task <strong>in place</strong></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task</strong> (<em>dict</em>) – Qlib’s task</p></li>
<li><p><strong>hr</strong> (<em>int</em>) – the horizon of task</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.gen.MultiHorizonGenBase.generate">
<span class="sig-name descname"><span class="pre">generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.gen.MultiHorizonGenBase.generate" title="Permalink to this definition"></a></dt>
<dd><p>Generate different tasks based on a task template</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>task</strong> (<em>dict</em>) – a task template</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of tasks</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>List</em>[dict]</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.workflow.task.manage">
<span id="taskmanager"></span><h3>TaskManager<a class="headerlink" href="#module-qlib.workflow.task.manage" title="Permalink to this heading"></a></h3>
<p>TaskManager can fetch unused tasks automatically and manage the lifecycle of a set of tasks with error handling.
These features can run tasks concurrently and ensure every task will be used only once.
Task Manager will store all tasks in <a class="reference external" href="https://www.mongodb.com/">MongoDB</a>.
Users <strong>MUST</strong> finished the configuration of <a class="reference external" href="https://www.mongodb.com/">MongoDB</a> when using this module.</p>
<p>A task in TaskManager consists of 3 parts
- tasks description: the desc will define the task
- tasks status: the status of the task
- tasks result: A user can get the task with the task description and task result.</p>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.manage.</span></span><span class="sig-name descname"><span class="pre">TaskManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_pool</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager" title="Permalink to this definition"></a></dt>
<dd><p>Here is what will a task looks like when it created by TaskManager</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">'def'</span><span class="p">:</span> <span class="n">pickle</span> <span class="n">serialized</span> <span class="n">task</span> <span class="n">definition</span><span class="o">.</span>  <span class="n">using</span> <span class="n">pickle</span> <span class="n">will</span> <span class="n">make</span> <span class="n">it</span> <span class="n">easier</span>
    <span class="s1">'filter'</span><span class="p">:</span> <span class="n">json</span><span class="o">-</span><span class="n">like</span> <span class="n">data</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">filtering</span> <span class="n">the</span> <span class="n">tasks</span><span class="o">.</span>
    <span class="s1">'status'</span><span class="p">:</span> <span class="s1">'waiting'</span> <span class="o">|</span> <span class="s1">'running'</span> <span class="o">|</span> <span class="s1">'done'</span>
    <span class="s1">'res'</span><span class="p">:</span> <span class="n">pickle</span> <span class="n">serialized</span> <span class="n">task</span> <span class="n">result</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The tasks manager assumes that you will only update the tasks you fetched.
The mongo fetch one and update will make it date updating secure.</p>
<p>This class can be used as a tool from commandline. Here are several examples.
You can view the help of manage module with the following commands:
python -m qlib.workflow.task.manage -h # show manual of manage module CLI
python -m qlib.workflow.task.manage wait -h # show manual of the wait command of manage</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>qlib.workflow.task.manage<span class="w"> </span>-t<span class="w"> </span>&lt;pool_name&gt;<span class="w"> </span><span class="nb">wait</span>
python<span class="w"> </span>-m<span class="w"> </span>qlib.workflow.task.manage<span class="w"> </span>-t<span class="w"> </span>&lt;pool_name&gt;<span class="w"> </span>task_stat
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Assumption: the data in MongoDB was encoded and the data out of MongoDB was decoded</p>
</div>
<p>Here are four status which are:</p>
<blockquote>
<div><p>STATUS_WAITING: waiting for training</p>
<p>STATUS_RUNNING: training</p>
<p>STATUS_PART_DONE: finished some step and waiting for next step</p>
<p>STATUS_DONE: all work done</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_pool</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init Task Manager, remember to make the statement of MongoDB url and database name firstly.
A TaskManager instance serves a specific task pool.
The static method of this module serves the whole MongoDB.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>task_pool</strong> (<em>str</em>) – the name of Collection in MongoDB</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.list">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.list" title="Permalink to this definition"></a></dt>
<dd><p>List the all collection(task_pool) of the db.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.replace_task">
<span class="sig-name descname"><span class="pre">replace_task</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_task</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.replace_task" title="Permalink to this definition"></a></dt>
<dd><p>Use a new task to replace a old one</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task</strong> – old task</p></li>
<li><p><strong>new_task</strong> – new task</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.insert_task">
<span class="sig-name descname"><span class="pre">insert_task</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.insert_task" title="Permalink to this definition"></a></dt>
<dd><p>Insert a task.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>task</strong> – the task waiting for insert</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>pymongo.results.InsertOneResult</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.insert_task_def">
<span class="sig-name descname"><span class="pre">insert_task_def</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_def</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.insert_task_def" title="Permalink to this definition"></a></dt>
<dd><p>Insert a task to task_pool</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>task_def</strong> (<em>dict</em>) – the task definition</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>pymongo.results.InsertOneResult</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.create_task">
<span class="sig-name descname"><span class="pre">create_task</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_def_l</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_run</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">print_nt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.create_task" title="Permalink to this definition"></a></dt>
<dd><p>If the tasks in task_def_l are new, then insert new tasks into the task_pool, and record inserted_id.
If a task is not new, then just query its _id.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task_def_l</strong> (<em>list</em>) – a list of task</p></li>
<li><p><strong>dry_run</strong> (<em>bool</em>) – if insert those new tasks to task pool</p></li>
<li><p><strong>print_nt</strong> (<em>bool</em>) – if print new task</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of the _id of task_def_l</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[str]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.fetch_task">
<span class="sig-name descname"><span class="pre">fetch_task</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'waiting'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.fetch_task" title="Permalink to this definition"></a></dt>
<dd><p>Use query to fetch tasks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>dict</em><em>, </em><em>optional</em>) – query dict. Defaults to {}.</p></li>
<li><p><strong>status</strong> (<em>str</em><em>, </em><em>optional</em>) – [description]. Defaults to STATUS_WAITING.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a task(document in collection) after decoding</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.safe_fetch_task">
<span class="sig-name descname"><span class="pre">safe_fetch_task</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'waiting'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.safe_fetch_task" title="Permalink to this definition"></a></dt>
<dd><p>Fetch task from task_pool using query with contextmanager</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>query</strong> (<em>dict</em>) – the dict of query</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dict</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>a task(document in collection) after decoding</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.query">
<span class="sig-name descname"><span class="pre">query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.query" title="Permalink to this definition"></a></dt>
<dd><p>Query task in collection.
This function may raise exception <cite>pymongo.errors.CursorNotFound: cursor id not found</cite> if it takes too long to iterate the generator</p>
<p>python -m qlib.workflow.task.manage -t &lt;your task pool&gt; query ‘{“_id”: “615498be837d0053acbc5d58”}’</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>dict</em>) – the dict of query</p></li>
<li><p><strong>decode</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dict</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>a task(document in collection) after decoding</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.re_query">
<span class="sig-name descname"><span class="pre">re_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_id</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.re_query" title="Permalink to this definition"></a></dt>
<dd><p>Use _id to query task.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>_id</strong> (<em>str</em>) – _id of a document</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a task(document in collection) after decoding</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.commit_task_res">
<span class="sig-name descname"><span class="pre">commit_task_res</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">res</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'done'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.commit_task_res" title="Permalink to this definition"></a></dt>
<dd><p>Commit the result to task[‘res’].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task</strong> (<em>[</em><em>type</em><em>]</em>) – [description]</p></li>
<li><p><strong>res</strong> (<em>object</em>) – the result you want to save</p></li>
<li><p><strong>status</strong> (<em>str</em><em>, </em><em>optional</em>) – STATUS_WAITING, STATUS_RUNNING, STATUS_DONE, STATUS_PART_DONE. Defaults to STATUS_DONE.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.return_task">
<span class="sig-name descname"><span class="pre">return_task</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'waiting'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.return_task" title="Permalink to this definition"></a></dt>
<dd><p>Return a task to status. Always using in error handling.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task</strong> (<em>[</em><em>type</em><em>]</em>) – [description]</p></li>
<li><p><strong>status</strong> (<em>str</em><em>, </em><em>optional</em>) – STATUS_WAITING, STATUS_RUNNING, STATUS_DONE, STATUS_PART_DONE. Defaults to STATUS_WAITING.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.remove">
<span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.remove" title="Permalink to this definition"></a></dt>
<dd><p>Remove the task using query</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>query</strong> (<em>dict</em>) – the dict of query</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.task_stat">
<span class="sig-name descname"><span class="pre">task_stat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.task_stat" title="Permalink to this definition"></a></dt>
<dd><p>Count the tasks in every status.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>query</strong> (<em>dict</em><em>, </em><em>optional</em>) – the query dict. Defaults to {}.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.reset_waiting">
<span class="sig-name descname"><span class="pre">reset_waiting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.reset_waiting" title="Permalink to this definition"></a></dt>
<dd><p>Reset all running task into waiting status. Can be used when some running task exit unexpected.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>query</strong> (<em>dict</em><em>, </em><em>optional</em>) – the query dict. Defaults to {}.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.prioritize">
<span class="sig-name descname"><span class="pre">prioritize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priority</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.prioritize" title="Permalink to this definition"></a></dt>
<dd><p>Set priority for task</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task</strong> (<em>dict</em>) – The task query from the database</p></li>
<li><p><strong>priority</strong> (<em>int</em>) – the target priority</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.TaskManager.wait">
<span class="sig-name descname"><span class="pre">wait</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.TaskManager.wait" title="Permalink to this definition"></a></dt>
<dd><p>When multiprocessing, the main progress may fetch nothing from TaskManager because there are still some running tasks.
So main progress should wait until all tasks are trained well by other progress or machines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>query</strong> (<em>dict</em><em>, </em><em>optional</em>) – the query dict. Defaults to {}.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.workflow.task.manage.run_task">
<span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.manage.</span></span><span class="sig-name descname"><span class="pre">run_task</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_pool</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_release</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">before_status</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'waiting'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">after_status</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'done'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.manage.run_task" title="Permalink to this definition"></a></dt>
<dd><p>While the task pool is not empty (has WAITING tasks), use task_func to fetch and run tasks in task_pool</p>
<p>After running this method, here are 4 situations (before_status -&gt; after_status):</p>
<blockquote>
<div><p>STATUS_WAITING -&gt; STATUS_DONE: use task[“def”] as <cite>task_func</cite> param, it means that the task has not been started</p>
<p>STATUS_WAITING -&gt; STATUS_PART_DONE: use task[“def”] as <cite>task_func</cite> param</p>
<p>STATUS_PART_DONE -&gt; STATUS_PART_DONE: use task[“res”] as <cite>task_func</cite> param, it means that the task has been started but not completed</p>
<p>STATUS_PART_DONE -&gt; STATUS_DONE: use task[“res”] as <cite>task_func</cite> param</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task_func</strong> (<em>Callable</em>) – <p>def (task_def, **kwargs) -&gt; &lt;res which will be committed&gt;</p>
<p>the function to run the task</p>
</p></li>
<li><p><strong>task_pool</strong> (<em>str</em>) – the name of the task pool (Collection in MongoDB)</p></li>
<li><p><strong>query</strong> (<em>dict</em>) – will use this dict to query task_pool when fetching task</p></li>
<li><p><strong>force_release</strong> (<em>bool</em>) – will the program force to release the resource</p></li>
<li><p><strong>before_status</strong> (<em>str:</em>) – the tasks in before_status will be fetched and trained. Can be STATUS_WAITING, STATUS_PART_DONE.</p></li>
<li><p><strong>after_status</strong> (<em>str:</em>) – the tasks after trained will become after_status. Can be STATUS_WAITING, STATUS_PART_DONE.</p></li>
<li><p><strong>kwargs</strong> – the params for <cite>task_func</cite></p></li>
</ul>
</dd>
</dl>
</dd></dl>
</section>
<section id="module-qlib.model.trainer">
<span id="trainer"></span><h3>Trainer<a class="headerlink" href="#module-qlib.model.trainer" title="Permalink to this heading"></a></h3>
<p>The Trainer will train a list of tasks and return a list of model recorders.
There are two steps in each Trainer including <code class="docutils literal notranslate"><span class="pre">train</span></code> (make model recorder) and <code class="docutils literal notranslate"><span class="pre">end_train</span></code> (modify model recorder).</p>
<p>This is a concept called <code class="docutils literal notranslate"><span class="pre">DelayTrainer</span></code>, which can be used in online simulating for parallel training.
In <code class="docutils literal notranslate"><span class="pre">DelayTrainer</span></code>, the first step is only to save some necessary info to model recorders, and the second step which will be finished in the end can do some concurrent and time-consuming operations such as model fitting.</p>
<p><code class="docutils literal notranslate"><span class="pre">Qlib</span></code> offer two kinds of Trainer, <code class="docutils literal notranslate"><span class="pre">TrainerR</span></code> is the simplest way and <code class="docutils literal notranslate"><span class="pre">TrainerRM</span></code> is based on TaskManager to help manager tasks lifecycle automatically.</p>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.model.trainer.begin_task_train">
<span class="sig-prename descclassname"><span class="pre">qlib.model.trainer.</span></span><span class="sig-name descname"><span class="pre">begin_task_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></span><a class="headerlink" href="#qlib.model.trainer.begin_task_train" title="Permalink to this definition"></a></dt>
<dd><p>Begin task training to start a recorder and save the task config.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task_config</strong> (<em>dict</em>) – the config of a task</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the name of experiment</p></li>
<li><p><strong>recorder_name</strong> (<em>str</em>) – the given name will be the recorder name. None for using rid.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the model recorder</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder">Recorder</a></p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.model.trainer.end_task_train">
<span class="sig-prename descclassname"><span class="pre">qlib.model.trainer.</span></span><span class="sig-name descname"><span class="pre">end_task_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rec</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></span><a class="headerlink" href="#qlib.model.trainer.end_task_train" title="Permalink to this definition"></a></dt>
<dd><p>Finish task training with real model fitting and saving.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rec</strong> (<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><em>Recorder</em></a>) – the recorder will be resumed</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the name of experiment</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the model recorder</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder">Recorder</a></p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.model.trainer.task_train">
<span class="sig-prename descclassname"><span class="pre">qlib.model.trainer.</span></span><span class="sig-name descname"><span class="pre">task_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></span><a class="headerlink" href="#qlib.model.trainer.task_train" title="Permalink to this definition"></a></dt>
<dd><p>Task based training, will be divided into two steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task_config</strong> (<em>dict</em>) – The config of a task.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – The name of experiment</p></li>
<li><p><strong>recorder_name</strong> (<em>str</em>) – The name of recorder</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Recorder</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>The instance of the recorder</p>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.trainer.Trainer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.trainer.</span></span><span class="sig-name descname"><span class="pre">Trainer</span></span><a class="headerlink" href="#qlib.model.trainer.Trainer" title="Permalink to this definition"></a></dt>
<dd><p>The trainer can train a list of models.
There are Trainer and DelayTrainer, which can be distinguished by when it will finish real training.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.Trainer.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.Trainer.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.Trainer.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tasks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#qlib.model.trainer.Trainer.train" title="Permalink to this definition"></a></dt>
<dd><p>Given a list of task definitions, begin training, and return the models.</p>
<p>For Trainer, it finishes real training in this method.
For DelayTrainer, it only does some preparation in this method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tasks</strong> – a list of tasks</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of models</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.Trainer.end_train">
<span class="sig-name descname"><span class="pre">end_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">models</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#qlib.model.trainer.Trainer.end_train" title="Permalink to this definition"></a></dt>
<dd><p>Given a list of models, finished something at the end of training if you need.
The models may be Recorder, txt file, database, and so on.</p>
<p>For Trainer, it does some finishing touches in this method.
For DelayTrainer, it finishes real training in this method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>models</strong> – a list of models</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of models</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.Trainer.is_delay">
<span class="sig-name descname"><span class="pre">is_delay</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#qlib.model.trainer.Trainer.is_delay" title="Permalink to this definition"></a></dt>
<dd><p>If Trainer will delay finishing <cite>end_train</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>if DelayTrainer</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.Trainer.has_worker">
<span class="sig-name descname"><span class="pre">has_worker</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#qlib.model.trainer.Trainer.has_worker" title="Permalink to this definition"></a></dt>
<dd><p>Some trainer has backend worker to support parallel training
This method can tell if the worker is enabled.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>if the worker is enabled</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.Trainer.worker">
<span class="sig-name descname"><span class="pre">worker</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.Trainer.worker" title="Permalink to this definition"></a></dt>
<dd><p>start the worker</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>NotImplementedError:</strong> – If the worker is not supported</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.trainer.</span></span><span class="sig-name descname"><span class="pre">TrainerR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func:</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">call_in_subproc:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_rec_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.TrainerR" title="Permalink to this definition"></a></dt>
<dd><p>Trainer based on (R)ecorder.
It will train a list of tasks and return a list of model recorders in a linear way.</p>
<p>Assumption: models were defined by <cite>task</cite> and the results will be saved to <cite>Recorder</cite>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerR.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func:</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">call_in_subproc:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_rec_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.TrainerR.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init TrainerR.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_name</strong> (<em>str</em><em>, </em><em>optional</em>) – the default name of experiment.</p></li>
<li><p><strong>train_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – default training method. Defaults to <cite>task_train</cite>.</p></li>
<li><p><strong>call_in_subproc</strong> (<em>bool</em>) – call the process in subprocess to force memory release</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerR.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tasks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.model.trainer.TrainerR.train" title="Permalink to this definition"></a></dt>
<dd><p>Given a list of <cite>tasks</cite> and return a list of trained Recorder. The order can be guaranteed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tasks</strong> (<em>list</em>) – a list of definitions based on <cite>task</cite> dict</p></li>
<li><p><strong>train_func</strong> (<em>Callable</em>) – the training method which needs at least <cite>tasks</cite> and <cite>experiment_name</cite>. None for the default training method.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the experiment name, None for use default name.</p></li>
<li><p><strong>kwargs</strong> – the params for train_func.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of Recorders</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder">Recorder</a>]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerR.end_train">
<span class="sig-name descname"><span class="pre">end_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">models</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.model.trainer.TrainerR.end_train" title="Permalink to this definition"></a></dt>
<dd><p>Set STATUS_END tag to the recorders.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>models</strong> (<em>list</em>) – a list of trained recorders.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the same list as the param.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder">Recorder</a>]</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.trainer.DelayTrainerR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.trainer.</span></span><span class="sig-name descname"><span class="pre">DelayTrainerR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func=&lt;function</span> <span class="pre">begin_task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_train_func=&lt;function</span> <span class="pre">end_task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.DelayTrainerR" title="Permalink to this definition"></a></dt>
<dd><p>A delayed implementation based on TrainerR, which means <cite>train</cite> method may only do some preparation and <cite>end_train</cite> method can do the real model fitting.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.DelayTrainerR.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func=&lt;function</span> <span class="pre">begin_task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_train_func=&lt;function</span> <span class="pre">end_task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.DelayTrainerR.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init TrainerRM.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_name</strong> (<em>str</em>) – the default name of experiment.</p></li>
<li><p><strong>train_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – default train method. Defaults to <cite>begin_task_train</cite>.</p></li>
<li><p><strong>end_train_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – default end_train method. Defaults to <cite>end_task_train</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.DelayTrainerR.end_train">
<span class="sig-name descname"><span class="pre">end_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">models</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_train_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.model.trainer.DelayTrainerR.end_train" title="Permalink to this definition"></a></dt>
<dd><p>Given a list of Recorder and return a list of trained Recorder.
This class will finish real data loading and model fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>models</strong> (<em>list</em>) – a list of Recorder, the tasks have been saved to them</p></li>
<li><p><strong>end_train_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – the end_train method which needs at least <cite>recorders</cite> and <cite>experiment_name</cite>. Defaults to None for using self.end_train_func.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the experiment name, None for use default name.</p></li>
<li><p><strong>kwargs</strong> – the params for end_train_func.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of Recorders</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder">Recorder</a>]</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerRM">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.trainer.</span></span><span class="sig-name descname"><span class="pre">TrainerRM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_pool:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func=&lt;function</span> <span class="pre">task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_run_task:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_rec_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.TrainerRM" title="Permalink to this definition"></a></dt>
<dd><p>Trainer based on (R)ecorder and Task(M)anager.
It can train a list of tasks and return a list of model recorders in a multiprocessing way.</p>
<p>Assumption: <cite>task</cite> will be saved to TaskManager and <cite>task</cite> will be fetched and trained from TaskManager</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerRM.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_pool:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func=&lt;function</span> <span class="pre">task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_run_task:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_rec_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.TrainerRM.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init TrainerR.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_name</strong> (<em>str</em>) – the default name of experiment.</p></li>
<li><p><strong>task_pool</strong> (<em>str</em>) – task pool name in TaskManager. None for use same name as experiment_name.</p></li>
<li><p><strong>train_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – default training method. Defaults to <cite>task_train</cite>.</p></li>
<li><p><strong>skip_run_task</strong> (<em>bool</em>) – If skip_run_task == True:
Only run_task in the worker. Otherwise skip run_task.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerRM.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tasks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">before_status</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'waiting'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">after_status</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'done'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_rec_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.model.trainer.TrainerRM.train" title="Permalink to this definition"></a></dt>
<dd><p>Given a list of <cite>tasks</cite> and return a list of trained Recorder. The order can be guaranteed.</p>
<p>This method defaults to a single process, but TaskManager offered a great way to parallel training.
Users can customize their train_func to realize multiple processes or even multiple machines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tasks</strong> (<em>list</em>) – a list of definitions based on <cite>task</cite> dict</p></li>
<li><p><strong>train_func</strong> (<em>Callable</em>) – the training method which needs at least <cite>tasks</cite> and <cite>experiment_name</cite>. None for the default training method.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the experiment name, None for use default name.</p></li>
<li><p><strong>before_status</strong> (<em>str</em>) – the tasks in before_status will be fetched and trained. Can be STATUS_WAITING, STATUS_PART_DONE.</p></li>
<li><p><strong>after_status</strong> (<em>str</em>) – the tasks after trained will become after_status. Can be STATUS_WAITING, STATUS_PART_DONE.</p></li>
<li><p><strong>kwargs</strong> – the params for train_func.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of Recorders</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder">Recorder</a>]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerRM.end_train">
<span class="sig-name descname"><span class="pre">end_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.model.trainer.TrainerRM.end_train" title="Permalink to this definition"></a></dt>
<dd><p>Set STATUS_END tag to the recorders.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>recs</strong> (<em>list</em>) – a list of trained recorders.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the same list as the param.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder">Recorder</a>]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerRM.worker">
<span class="sig-name descname"><span class="pre">worker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.TrainerRM.worker" title="Permalink to this definition"></a></dt>
<dd><p>The multiprocessing method for <cite>train</cite>. It can share a same task_pool with <cite>train</cite> and can run in other progress or other machines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_func</strong> (<em>Callable</em>) – the training method which needs at least <cite>tasks</cite> and <cite>experiment_name</cite>. None for the default training method.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the experiment name, None for use default name.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.TrainerRM.has_worker">
<span class="sig-name descname"><span class="pre">has_worker</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#qlib.model.trainer.TrainerRM.has_worker" title="Permalink to this definition"></a></dt>
<dd><p>Some trainer has backend worker to support parallel training
This method can tell if the worker is enabled.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>if the worker is enabled</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.trainer.DelayTrainerRM">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.trainer.</span></span><span class="sig-name descname"><span class="pre">DelayTrainerRM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_pool:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func=&lt;function</span> <span class="pre">begin_task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_train_func=&lt;function</span> <span class="pre">end_task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_run_task:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.DelayTrainerRM" title="Permalink to this definition"></a></dt>
<dd><p>A delayed implementation based on TrainerRM, which means <cite>train</cite> method may only do some preparation and <cite>end_train</cite> method can do the real model fitting.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.DelayTrainerRM.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_pool:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func=&lt;function</span> <span class="pre">begin_task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_train_func=&lt;function</span> <span class="pre">end_task_train&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_run_task:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.DelayTrainerRM.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init DelayTrainerRM.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_name</strong> (<em>str</em>) – the default name of experiment.</p></li>
<li><p><strong>task_pool</strong> (<em>str</em>) – task pool name in TaskManager. None for use same name as experiment_name.</p></li>
<li><p><strong>train_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – default train method. Defaults to <cite>begin_task_train</cite>.</p></li>
<li><p><strong>end_train_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – default end_train method. Defaults to <cite>end_task_train</cite>.</p></li>
<li><p><strong>skip_run_task</strong> (<em>bool</em>) – If skip_run_task == True:
Only run_task in the worker. Otherwise skip run_task.
E.g. Starting trainer on a CPU VM and then waiting tasks to be finished on GPU VMs.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.DelayTrainerRM.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tasks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.model.trainer.DelayTrainerRM.train" title="Permalink to this definition"></a></dt>
<dd><p>Same as <cite>train</cite> of TrainerRM, after_status will be STATUS_PART_DONE.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tasks</strong> (<em>list</em>) – a list of definition based on <cite>task</cite> dict</p></li>
<li><p><strong>train_func</strong> (<em>Callable</em>) – the train method which need at least <cite>tasks</cite> and <cite>experiment_name</cite>. Defaults to None for using self.train_func.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the experiment name, None for use default name.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of Recorders</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder">Recorder</a>]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.DelayTrainerRM.end_train">
<span class="sig-name descname"><span class="pre">end_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_train_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.model.trainer.DelayTrainerRM.end_train" title="Permalink to this definition"></a></dt>
<dd><p>Given a list of Recorder and return a list of trained Recorder.
This class will finish real data loading and model fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>recs</strong> (<em>list</em>) – a list of Recorder, the tasks have been saved to them.</p></li>
<li><p><strong>end_train_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – the end_train method which need at least <cite>recorders</cite> and <cite>experiment_name</cite>. Defaults to None for using self.end_train_func.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the experiment name, None for use default name.</p></li>
<li><p><strong>kwargs</strong> – the params for end_train_func.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of Recorders</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder">Recorder</a>]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.DelayTrainerRM.worker">
<span class="sig-name descname"><span class="pre">worker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">end_train_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.trainer.DelayTrainerRM.worker" title="Permalink to this definition"></a></dt>
<dd><p>The multiprocessing method for <cite>end_train</cite>. It can share a same task_pool with <cite>end_train</cite> and can run in other progress or other machines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>end_train_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – the end_train method which need at least <cite>recorders</cite> and <cite>experiment_name</cite>. Defaults to None for using self.end_train_func.</p></li>
<li><p><strong>experiment_name</strong> (<em>str</em>) – the experiment name, None for use default name.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.trainer.DelayTrainerRM.has_worker">
<span class="sig-name descname"><span class="pre">has_worker</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#qlib.model.trainer.DelayTrainerRM.has_worker" title="Permalink to this definition"></a></dt>
<dd><p>Some trainer has backend worker to support parallel training
This method can tell if the worker is enabled.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>if the worker is enabled</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.workflow.task.collect">
<span id="collector"></span><h3>Collector<a class="headerlink" href="#module-qlib.workflow.task.collect" title="Permalink to this heading"></a></h3>
<p>Collector module can collect objects from everywhere and process them such as merging, grouping, averaging and so on.</p>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.Collector">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.collect.</span></span><span class="sig-name descname"><span class="pre">Collector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">process_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.collect.Collector" title="Permalink to this definition"></a></dt>
<dd><p>The collector to collect different results</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.Collector.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">process_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.collect.Collector.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init Collector.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>process_list</strong> (<em>list</em><em> or </em><em>Callable</em>) – the list of processors or the instance of a processor to process dict.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.Collector.collect">
<span class="sig-name descname"><span class="pre">collect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.workflow.task.collect.Collector.collect" title="Permalink to this definition"></a></dt>
<dd><p>Collect the results and return a dict like {key: things}</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>the dict after collecting.</p>
<p>For example:</p>
<p>{“prediction”: pd.Series}</p>
<p>{“IC”: {“Xgboost”: pd.Series, “LSTM”: pd.Series}}</p>
<p>…</p>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.Collector.process_collect">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">process_collect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">collected_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.workflow.task.collect.Collector.process_collect" title="Permalink to this definition"></a></dt>
<dd><p>Do a series of processing to the dict returned by collect and return a dict like {key: things}
For example, you can group and ensemble.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>collected_dict</strong> (<em>dict</em>) – the dict return by <cite>collect</cite></p></li>
<li><p><strong>process_list</strong> (<em>list</em><em> or </em><em>Callable</em>) – the list of processors or the instance of a processor to process dict.
The processor order is the same as the list order.
For example: [Group1(…, Ensemble1()), Group2(…, Ensemble2())]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the dict after processing.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.MergeCollector">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.collect.</span></span><span class="sig-name descname"><span class="pre">MergeCollector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">collector_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.workflow.task.collect.Collector" title="qlib.workflow.task.collect.Collector"><span class="pre">Collector</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.collect.MergeCollector" title="Permalink to this definition"></a></dt>
<dd><p>A collector to collect the results of other Collectors</p>
<p>For example:</p>
<blockquote>
<div><p>We have 2 collector, which named A and B.
A can collect {“prediction”: pd.Series} and B can collect {“IC”: {“Xgboost”: pd.Series, “LSTM”: pd.Series}}.
Then after this class’s collect, we can collect {“A_prediction”: pd.Series, “B_IC”: {“Xgboost”: pd.Series, “LSTM”: pd.Series}}</p>
<p>…</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.MergeCollector.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">collector_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.workflow.task.collect.Collector" title="qlib.workflow.task.collect.Collector"><span class="pre">Collector</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.collect.MergeCollector.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init MergeCollector.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>collector_dict</strong> (<em>Dict</em><em>[</em><em>str</em><em>,</em><a class="reference internal" href="#qlib.workflow.task.collect.Collector" title="qlib.workflow.task.collect.Collector"><em>Collector</em></a><em>]</em>) – the dict like {collector_key, Collector}</p></li>
<li><p><strong>process_list</strong> (<em>List</em><em>[</em><em>Callable</em><em>]</em>) – the list of processors or the instance of processor to process dict.</p></li>
<li><p><strong>merge_func</strong> (<em>Callable</em>) – a method to generate outermost key. The given params are <code class="docutils literal notranslate"><span class="pre">collector_key</span></code> from collector_dict and <code class="docutils literal notranslate"><span class="pre">key</span></code> from every collector after collecting.
None for using tuple to connect them, such as “ABC”+(“a”,”b”) -&gt; (“ABC”, (“a”,”b”)).</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.MergeCollector.collect">
<span class="sig-name descname"><span class="pre">collect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.workflow.task.collect.MergeCollector.collect" title="Permalink to this definition"></a></dt>
<dd><p>Collect all results of collector_dict and change the outermost key to a recombination key.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the dict after collecting.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.RecorderCollector">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.collect.</span></span><span class="sig-name descname"><span class="pre">RecorderCollector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rec_key_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rec_filter_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">artifacts_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'pred':</span> <span class="pre">'pred.pkl'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">artifacts_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">list_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{'FINISHED'}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.collect.RecorderCollector" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.RecorderCollector.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">process_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rec_key_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rec_filter_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">artifacts_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'pred':</span> <span class="pre">'pred.pkl'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">artifacts_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">list_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{'FINISHED'}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.collect.RecorderCollector.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init RecorderCollector.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment</strong> – (Experiment or str): an instance of an Experiment or the name of an Experiment
(Callable): an callable function, which returns a list of experiments</p></li>
<li><p><strong>process_list</strong> (<em>list</em><em> or </em><em>Callable</em>) – the list of processors or the instance of a processor to process dict.</p></li>
<li><p><strong>rec_key_func</strong> (<em>Callable</em>) – a function to get the key of a recorder. If None, use recorder id.</p></li>
<li><p><strong>rec_filter_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – filter the recorder by return True or False. Defaults to None.</p></li>
<li><p><strong>artifacts_path</strong> (<em>dict</em><em>, </em><em>optional</em>) – The artifacts name and its path in Recorder. Defaults to {“pred”: “pred.pkl”, “IC”: “sig_analysis/ic.pkl”}.</p></li>
<li><p><strong>artifacts_key</strong> (<em>str</em><em> or </em><em>List</em><em>, </em><em>optional</em>) – the artifacts key you want to get. If None, get all artifacts.</p></li>
<li><p><strong>list_kwargs</strong> (<em>str</em>) – arguments for list_recorders function.</p></li>
<li><p><strong>status</strong> (<em>Iterable</em>) – only collect recorders with specific status. None indicating collecting all the recorders</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.RecorderCollector.collect">
<span class="sig-name descname"><span class="pre">collect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">artifacts_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rec_filter_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">only_exist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.workflow.task.collect.RecorderCollector.collect" title="Permalink to this definition"></a></dt>
<dd><p>Collect different artifacts based on recorder after filtering.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>artifacts_key</strong> (<em>str</em><em> or </em><em>List</em><em>, </em><em>optional</em>) – the artifacts key you want to get. If None, use the default.</p></li>
<li><p><strong>rec_filter_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – filter the recorder by return True or False. If None, use the default.</p></li>
<li><p><strong>only_exist</strong> (<em>bool</em><em>, </em><em>optional</em>) – if only collect the artifacts when a recorder really has.
If True, the recorder with exception when loading will not be collected. But if False, it will raise the exception.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the dict after collected like {artifact: {rec_key: object}}</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.collect.RecorderCollector.get_exp_name">
<span class="sig-name descname"><span class="pre">get_exp_name</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#qlib.workflow.task.collect.RecorderCollector.get_exp_name" title="Permalink to this definition"></a></dt>
<dd><p>Get experiment name</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>experiment name</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.model.ens.group">
<span id="group"></span><h3>Group<a class="headerlink" href="#module-qlib.model.ens.group" title="Permalink to this heading"></a></h3>
<p>Group can group a set of objects based on <cite>group_func</cite> and change them to a dict.
After group, we provide a method to reduce them.</p>
<p>For example:</p>
<p>group: {(A,B,C1): object, (A,B,C2): object} -&gt; {(A,B): {C1: object, C2: object}}
reduce: {(A,B): {C1: object, C2: object}} -&gt; {(A,B): object}</p>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.ens.group.Group">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.ens.group.</span></span><span class="sig-name descname"><span class="pre">Group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">group_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.model.ens.ensemble.Ensemble" title="qlib.model.ens.ensemble.Ensemble"><span class="pre">Ensemble</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.ens.group.Group" title="Permalink to this definition"></a></dt>
<dd><p>Group the objects based on dict</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.ens.group.Group.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">group_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.model.ens.ensemble.Ensemble" title="qlib.model.ens.ensemble.Ensemble"><span class="pre">Ensemble</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.ens.group.Group.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init Group.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>group_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – <p>Given a dict and return the group key and one of the group elements.</p>
<p>For example: {(A,B,C1): object, (A,B,C2): object} -&gt; {(A,B): {C1: object, C2: object}}</p>
</p></li>
<li><p><strong>None.</strong> (<em>Defaults to</em>) – </p></li>
<li><p><strong>ens</strong> (<a class="reference internal" href="#qlib.model.ens.ensemble.Ensemble" title="qlib.model.ens.ensemble.Ensemble"><em>Ensemble</em></a><em>, </em><em>optional</em>) – If not None, do ensemble for grouped value after grouping.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.ens.group.Group.group">
<span class="sig-name descname"><span class="pre">group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.model.ens.group.Group.group" title="Permalink to this definition"></a></dt>
<dd><p>Group a set of objects and change them to a dict.</p>
<p>For example: {(A,B,C1): object, (A,B,C2): object} -&gt; {(A,B): {C1: object, C2: object}}</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>grouped dict</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.ens.group.Group.reduce">
<span class="sig-name descname"><span class="pre">reduce</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.model.ens.group.Group.reduce" title="Permalink to this definition"></a></dt>
<dd><p>Reduce grouped dict.</p>
<p>For example: {(A,B): {C1: object, C2: object}} -&gt; {(A,B): object}</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>reduced dict</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.ens.group.RollingGroup">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.ens.group.</span></span><span class="sig-name descname"><span class="pre">RollingGroup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ens=&lt;qlib.model.ens.ensemble.RollingEnsemble</span> <span class="pre">object&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.ens.group.RollingGroup" title="Permalink to this definition"></a></dt>
<dd><p>Group the rolling dict</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.ens.group.RollingGroup.group">
<span class="sig-name descname"><span class="pre">group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rolling_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.model.ens.group.RollingGroup.group" title="Permalink to this definition"></a></dt>
<dd><p>Given an rolling dict likes {(A,B,R): things}, return the grouped dict likes {(A,B): {R:things}}</p>
<p>NOTE: There is an assumption which is the rolling key is at the end of the key tuple, because the rolling results always need to be ensemble firstly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rolling_dict</strong> (<em>dict</em>) – an rolling dict. If the key is not a tuple, then do nothing.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>grouped dict</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.model.ens.group.RollingGroup.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ens=&lt;qlib.model.ens.ensemble.RollingEnsemble</span> <span class="pre">object&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.model.ens.group.RollingGroup.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init Group.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>group_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – <p>Given a dict and return the group key and one of the group elements.</p>
<p>For example: {(A,B,C1): object, (A,B,C2): object} -&gt; {(A,B): {C1: object, C2: object}}</p>
</p></li>
<li><p><strong>None.</strong> (<em>Defaults to</em>) – </p></li>
<li><p><strong>ens</strong> (<a class="reference internal" href="#qlib.model.ens.ensemble.Ensemble" title="qlib.model.ens.ensemble.Ensemble"><em>Ensemble</em></a><em>, </em><em>optional</em>) – If not None, do ensemble for grouped value after grouping.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.model.ens.ensemble">
<span id="ensemble"></span><h3>Ensemble<a class="headerlink" href="#module-qlib.model.ens.ensemble" title="Permalink to this heading"></a></h3>
<p>Ensemble module can merge the objects in an Ensemble. For example, if there are many submodels predictions, we may need to merge them into an ensemble prediction.</p>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.ens.ensemble.Ensemble">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.ens.ensemble.</span></span><span class="sig-name descname"><span class="pre">Ensemble</span></span><a class="headerlink" href="#qlib.model.ens.ensemble.Ensemble" title="Permalink to this definition"></a></dt>
<dd><p>Merge the ensemble_dict into an ensemble object.</p>
<p>For example: {Rollinga_b: object, Rollingb_c: object} -&gt; object</p>
<p>When calling this class:</p>
<blockquote>
<div><dl class="simple">
<dt>Args:</dt><dd><p>ensemble_dict (dict): the ensemble dict like {name: things} waiting for merging</p>
</dd>
<dt>Returns:</dt><dd><p>object: the ensemble object</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.ens.ensemble.SingleKeyEnsemble">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.ens.ensemble.</span></span><span class="sig-name descname"><span class="pre">SingleKeyEnsemble</span></span><a class="headerlink" href="#qlib.model.ens.ensemble.SingleKeyEnsemble" title="Permalink to this definition"></a></dt>
<dd><p>Extract the object if there is only one key and value in the dict. Make the result more readable.
{Only key: Only value} -&gt; Only value</p>
<p>If there is more than 1 key or less than 1 key, then do nothing.
Even you can run this recursively to make dict more readable.</p>
<p>NOTE: Default runs recursively.</p>
<p>When calling this class:</p>
<blockquote>
<div><dl class="simple">
<dt>Args:</dt><dd><p>ensemble_dict (dict): the dict. The key of the dict will be ignored.</p>
</dd>
<dt>Returns:</dt><dd><p>dict: the readable dict.</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.ens.ensemble.RollingEnsemble">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.ens.ensemble.</span></span><span class="sig-name descname"><span class="pre">RollingEnsemble</span></span><a class="headerlink" href="#qlib.model.ens.ensemble.RollingEnsemble" title="Permalink to this definition"></a></dt>
<dd><p>Merge a dict of rolling dataframe like <cite>prediction</cite> or <cite>IC</cite> into an ensemble.</p>
<p>NOTE: The values of dict must be pd.DataFrame, and have the index “datetime”.</p>
<p>When calling this class:</p>
<blockquote>
<div><dl class="simple">
<dt>Args:</dt><dd><p>ensemble_dict (dict): a dict like {“A”: pd.DataFrame, “B”: pd.DataFrame}.
The key of the dict will be ignored.</p>
</dd>
<dt>Returns:</dt><dd><p>pd.DataFrame: the complete result of rolling.</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.model.ens.ensemble.AverageEnsemble">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.model.ens.ensemble.</span></span><span class="sig-name descname"><span class="pre">AverageEnsemble</span></span><a class="headerlink" href="#qlib.model.ens.ensemble.AverageEnsemble" title="Permalink to this definition"></a></dt>
<dd><p>Average and standardize a dict of same shape dataframe like <cite>prediction</cite> or <cite>IC</cite> into an ensemble.</p>
<p>NOTE: The values of dict must be pd.DataFrame, and have the index “datetime”. If it is a nested dict, then flat it.</p>
<p>When calling this class:</p>
<blockquote>
<div><dl class="simple">
<dt>Args:</dt><dd><p>ensemble_dict (dict): a dict like {“A”: pd.DataFrame, “B”: pd.DataFrame}.
The key of the dict will be ignored.</p>
</dd>
<dt>Returns:</dt><dd><p>pd.DataFrame: the complete result of averaging and standardizing.</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>
</section>
<section id="module-qlib.workflow.task.utils">
<span id="utils"></span><h3>Utils<a class="headerlink" href="#module-qlib.workflow.task.utils" title="Permalink to this heading"></a></h3>
<p>Some tools for task management.</p>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.get_mongodb">
<span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.utils.</span></span><span class="sig-name descname"><span class="pre">get_mongodb</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Database</span></span></span><a class="headerlink" href="#qlib.workflow.task.utils.get_mongodb" title="Permalink to this definition"></a></dt>
<dd><p>Get database in MongoDB, which means you need to declare the address and the name of a database at first.</p>
<p>For example:</p>
<blockquote>
<div><p>Using qlib.init():</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mongo_conf</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"task_url"</span><span class="p">:</span> <span class="n">task_url</span><span class="p">,</span>  <span class="c1"># your MongoDB url</span>
    <span class="s2">"task_db_name"</span><span class="p">:</span> <span class="n">task_db_name</span><span class="p">,</span>  <span class="c1"># database name</span>
<span class="p">}</span>
<span class="n">qlib</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">mongo</span><span class="o">=</span><span class="n">mongo_conf</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>After qlib.init():</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">[</span><span class="s2">"mongo"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"task_url"</span> <span class="p">:</span> <span class="s2">"mongodb://localhost:27017/"</span><span class="p">,</span>
    <span class="s2">"task_db_name"</span> <span class="p">:</span> <span class="s2">"rolling_db"</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the Database instance</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Database</p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.list_recorders">
<span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.utils.</span></span><span class="sig-name descname"><span class="pre">list_recorders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rec_filter_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.utils.list_recorders" title="Permalink to this definition"></a></dt>
<dd><p>List all recorders which can pass the filter in an experiment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment</strong> (<em>str</em><em> or </em><a class="reference internal" href="#qlib.workflow.exp.Experiment" title="qlib.workflow.exp.Experiment"><em>Experiment</em></a>) – the name of an Experiment or an instance</p></li>
<li><p><strong>rec_filter_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – return True to retain the given recorder. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a dict {rid: recorder} after filtering.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.utils.</span></span><span class="sig-name descname"><span class="pre">TimeAdjuster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">future</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster" title="Permalink to this definition"></a></dt>
<dd><p>Find appropriate date and adjust date.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">future</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.set_end_time">
<span class="sig-name descname"><span class="pre">set_end_time</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.set_end_time" title="Permalink to this definition"></a></dt>
<dd><p>Set end time. None for use calendar’s end time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>end_time</strong> – </p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.get" title="Permalink to this definition"></a></dt>
<dd><p>Get datetime by index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>idx</strong> (<em>int</em>) – index of the calendar</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.max">
<span class="sig-name descname"><span class="pre">max</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Timestamp</span></span></span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.max" title="Permalink to this definition"></a></dt>
<dd><p>Return the max calendar datetime</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.align_idx">
<span class="sig-name descname"><span class="pre">align_idx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time_point</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'start'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.align_idx" title="Permalink to this definition"></a></dt>
<dd><p>Align the index of time_point in the calendar.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time_point</strong> – </p></li>
<li><p><strong>tp_type</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>index</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.cal_interval">
<span class="sig-name descname"><span class="pre">cal_interval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time_point_A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_point_B</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.cal_interval" title="Permalink to this definition"></a></dt>
<dd><p>Calculate the trading day interval (time_point_A - time_point_B)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time_point_A</strong> – time_point_A</p></li>
<li><p><strong>time_point_B</strong> – time_point_B (is the past of time_point_A)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the interval between A and B</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.align_time">
<span class="sig-name descname"><span class="pre">align_time</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time_point</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'start'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Timestamp</span></span></span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.align_time" title="Permalink to this definition"></a></dt>
<dd><p>Align time_point to trade date of calendar</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time_point</strong> – Time point</p></li>
<li><p><strong>tp_type</strong> – str
time point type (<cite>“start”</cite>, <cite>“end”</cite>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.Timestamp</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.align_seg">
<span class="sig-name descname"><span class="pre">align_seg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">segment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span></span></span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.align_seg" title="Permalink to this definition"></a></dt>
<dd><p>Align the given date to the trade date</p>
<p>for example:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span><span class="p">:</span> <span class="p">{</span><span class="s1">'train'</span><span class="p">:</span> <span class="p">(</span><span class="s1">'2008-01-01'</span><span class="p">,</span> <span class="s1">'2014-12-31'</span><span class="p">),</span> <span class="s1">'valid'</span><span class="p">:</span> <span class="p">(</span><span class="s1">'2015-01-01'</span><span class="p">,</span> <span class="s1">'2016-12-31'</span><span class="p">),</span> <span class="s1">'test'</span><span class="p">:</span> <span class="p">(</span><span class="s1">'2017-01-01'</span><span class="p">,</span> <span class="s1">'2020-08-01'</span><span class="p">)}</span>

<span class="n">output</span><span class="p">:</span> <span class="p">{</span><span class="s1">'train'</span><span class="p">:</span> <span class="p">(</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">'2008-01-02 00:00:00'</span><span class="p">),</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">'2014-12-31 00:00:00'</span><span class="p">)),</span>
        <span class="s1">'valid'</span><span class="p">:</span> <span class="p">(</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">'2015-01-05 00:00:00'</span><span class="p">),</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">'2016-12-30 00:00:00'</span><span class="p">)),</span>
        <span class="s1">'test'</span><span class="p">:</span> <span class="p">(</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">'2017-01-03 00:00:00'</span><span class="p">),</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">'2020-07-31 00:00:00'</span><span class="p">))}</span>
</pre></div>
</div>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>segment</strong> – </p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Union[dict, tuple]</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>the start and end trade date (pd.Timestamp) between the given start and end date.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.truncate">
<span class="sig-name descname"><span class="pre">truncate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">segment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.truncate" title="Permalink to this definition"></a></dt>
<dd><p>Truncate the segment based on the test_start date</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>segment</strong> (<em>tuple</em>) – time segment</p></li>
<li><p><strong>test_start</strong> – </p></li>
<li><p><strong>days</strong> (<em>int</em>) – The trading days to be truncated
the data in this segment may need ‘days’ data
<cite>days</cite> are based on the <cite>test_start</cite>.
For example, if the label contains the information of 2 days in the near future, the prediction horizon 1 day.
(e.g. the prediction target is <cite>Ref($close, -2)/Ref($close, -1) - 1</cite>)
the days should be 2 + 1 == 3 days.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>tuple</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>new segment</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.TimeAdjuster.shift">
<span class="sig-name descname"><span class="pre">shift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sliding'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="headerlink" href="#qlib.workflow.task.utils.TimeAdjuster.shift" title="Permalink to this definition"></a></dt>
<dd><p>Shift the datetime of segment</p>
<p>If there are None (which indicates unbounded index) in the segment, this method will return None.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>seg</strong> – datetime segment</p></li>
<li><p><strong>step</strong> (<em>int</em>) – rolling step</p></li>
<li><p><strong>rtype</strong> (<em>str</em>) – rolling type (“sliding” or “expanding”)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>tuple</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>new segment</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>KeyError:</strong> – shift will raise error if the index(both start and end) is out of self.cal</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.workflow.task.utils.replace_task_handler_with_cache">
<span class="sig-prename descclassname"><span class="pre">qlib.workflow.task.utils.</span></span><span class="sig-name descname"><span class="pre">replace_task_handler_with_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'.'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.workflow.task.utils.replace_task_handler_with_cache" title="Permalink to this definition"></a></dt>
<dd><p>Replace the handler in task with a cache handler.
It will automatically cache the file and save it in cache_dir.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">qlib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qlib</span><span class="o">.</span><span class="n">auto_init</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># it is simplified task</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"kwargs"</span><span class="p">:{</span><span class="s1">'handler'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'Alpha158'</span><span class="p">,</span> <span class="s1">'module_path'</span><span class="p">:</span> <span class="s1">'qlib.contrib.data.handler'</span><span class="p">,</span> <span class="s1">'kwargs'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'start_time'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">'end_time'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">'fit_start_time'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">'fit_end_time'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="s1">'instruments'</span><span class="p">:</span> <span class="s1">'CSI300'</span><span class="p">}}}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_task</span> <span class="o">=</span> <span class="n">replace_task_handler_with_cache</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">new_task</span><span class="p">)</span>
<span class="go">{'dataset': {'kwargs': {'handler': 'file...Alpha158.3584f5f8b4.pkl'}}}</span>
</pre></div>
</div>
</dd></dl>
</section>
</section>
<section id="online-serving">
<h2>Online Serving<a class="headerlink" href="#online-serving" title="Permalink to this heading"></a></h2>
<section id="module-qlib.workflow.online.manager">
<span id="online-manager"></span><h3>Online Manager<a class="headerlink" href="#module-qlib.workflow.online.manager" title="Permalink to this heading"></a></h3>
<p>OnlineManager can manage a set of <a class="reference external" href="#OnlineStrategy">Online Strategy</a> and run them dynamically.</p>
<p>With the change of time, the decisive models will be also changed. In this module, we call those contributing models <cite>online</cite> models.
In every routine(such as every day or every minute), the <cite>online</cite> models may be changed and the prediction of them needs to be updated.
So this module provides a series of methods to control this process.</p>
<p>This module also provides a method to simulate <a class="reference external" href="#OnlineStrategy">Online Strategy</a> in history.
Which means you can verify your strategy or find a better one.</p>
<p>There are 4 total situations for using different trainers in different situations:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Situations</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Online + Trainer</p></td>
<td><p>When you want to do a REAL routine, the Trainer will help you train the models. It
will train models task by task and strategy by strategy.</p></td>
</tr>
<tr class="row-odd"><td><p>Online + DelayTrainer</p></td>
<td><p>DelayTrainer will skip concrete training until all tasks have been prepared by
different strategies. It makes users can parallelly train all tasks at the end of
<cite>routine</cite> or <cite>first_train</cite>. Otherwise, these functions will get stuck when each
strategy prepare tasks.</p></td>
</tr>
<tr class="row-even"><td><p>Simulation + Trainer</p></td>
<td><p>It will behave in the same way as <cite>Online + Trainer</cite>. The only difference is that it
is for simulation/backtesting instead of online trading</p></td>
</tr>
<tr class="row-odd"><td><p>Simulation + DelayTrainer</p></td>
<td><p>When your models don’t have any temporal dependence, you can use DelayTrainer
for the ability to multitasking. It means all tasks in all routines
can be REAL trained at the end of simulating. The signals will be prepared well at
different time segments (based on whether or not any new model is online).</p></td>
</tr>
</tbody>
</table>
<p>Here is some pseudo code that demonstrate the workflow of each situation</p>
<dl class="simple">
<dt>For simplicity</dt><dd><ul class="simple">
<li><p>Only one strategy is used in the strategy</p></li>
<li><p><cite>update_online_pred</cite> is only called in the online mode and is ignored</p></li>
</ul>
</dd>
</dl>
<ol class="arabic simple">
<li><p><cite>Online + Trainer</cite></p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tasks</span> <span class="o">=</span> <span class="n">first_train</span><span class="p">()</span>
<span class="n">models</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">end_train</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">online_trading_days</span><span class="p">:</span>
    <span class="c1"># OnlineManager.routine</span>
    <span class="n">models</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">prepare_tasks</span><span class="p">())</span>  <span class="c1"># for each strategy</span>
    <span class="n">strategy</span><span class="o">.</span><span class="n">prepare_online_models</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>  <span class="c1"># for each strategy</span>

    <span class="n">trainer</span><span class="o">.</span><span class="n">end_train</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
    <span class="n">prepare_signals</span><span class="p">()</span>  <span class="c1"># prepare trading signals daily</span>
</pre></div>
</div>
<p><cite>Online + DelayTrainer</cite>: the workflow is the same as <cite>Online + Trainer</cite>.</p>
<ol class="arabic simple" start="2">
<li><p><cite>Simulation + DelayTrainer</cite></p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulate</span>
<span class="n">tasks</span> <span class="o">=</span> <span class="n">first_train</span><span class="p">()</span>
<span class="n">models</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">historical_calendars</span><span class="p">:</span>
    <span class="c1"># OnlineManager.routine</span>
    <span class="n">models</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">prepare_tasks</span><span class="p">())</span>  <span class="c1"># for each strategy</span>
    <span class="n">strategy</span><span class="o">.</span><span class="n">prepare_online_models</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>  <span class="c1"># for each strategy</span>
<span class="c1"># delay_prepare()</span>
<span class="c1"># FIXME: Currently the delay_prepare is not implemented in a proper way.</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">end_train</span><span class="p">(</span><span class="o">&lt;</span><span class="k">for</span> <span class="nb">all</span> <span class="n">previous</span> <span class="n">models</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">prepare_signals</span><span class="p">()</span>
</pre></div>
</div>
<p># Can we simplify current workflow?</p>
<ul>
<li><p>Can reduce the number of state of tasks?</p>
<blockquote>
<div><ul class="simple">
<li><p>For each task, we have three phases (i.e. task, partly trained task, final trained task)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.manager.</span></span><span class="sig-name descname"><span class="pre">OnlineManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategies</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><span class="pre">OnlineStrategy</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><span class="pre">OnlineStrategy</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.model.trainer.Trainer" title="qlib.model.trainer.Trainer"><span class="pre">Trainer</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">begin_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager" title="Permalink to this definition"></a></dt>
<dd><p>OnlineManager can manage online models with <a class="reference external" href="#OnlineStrategy">Online Strategy</a>.
It also provides a history recording of which models are online at what time.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategies</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><span class="pre">OnlineStrategy</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><span class="pre">OnlineStrategy</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.model.trainer.Trainer" title="qlib.model.trainer.Trainer"><span class="pre">Trainer</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">begin_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init OnlineManager.
One OnlineManager must have at least one OnlineStrategy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>strategies</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><em>OnlineStrategy</em></a><em>, </em><em>List</em><em>[</em><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><em>OnlineStrategy</em></a><em>]</em><em>]</em>) – an instance of OnlineStrategy or a list of OnlineStrategy</p></li>
<li><p><strong>begin_time</strong> (<em>Union</em><em>[</em><em>str</em><em>,</em><em>pd.Timestamp</em><em>]</em><em>, </em><em>optional</em>) – the OnlineManager will begin at this time. Defaults to None for using the latest date.</p></li>
<li><p><strong>trainer</strong> (<a class="reference internal" href="#qlib.model.trainer.Trainer" title="qlib.model.trainer.Trainer"><em>qlib.model.trainer.Trainer</em></a>) – the trainer to train task. None for using TrainerR.</p></li>
<li><p><strong>freq</strong> (<em>str</em><em>, </em><em>optional</em>) – data frequency. Defaults to “day”.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager.first_train">
<span class="sig-name descname"><span class="pre">first_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategies</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><span class="pre">OnlineStrategy</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager.first_train" title="Permalink to this definition"></a></dt>
<dd><p>Get tasks from every strategy’s first_tasks method and train them.
If using DelayTrainer, it can finish training all together after every strategy’s first_tasks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>strategies</strong> (<em>List</em><em>[</em><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><em>OnlineStrategy</em></a><em>]</em>) – the strategies list (need this param when adding strategies). None for use default strategies.</p></li>
<li><p><strong>model_kwargs</strong> (<em>dict</em>) – the params for <cite>prepare_online_models</cite></p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager.routine">
<span class="sig-name descname"><span class="pre">routine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cur_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager.routine" title="Permalink to this definition"></a></dt>
<dd><p>Typical update process for every strategy and record the online history.</p>
<p>The typical update process after a routine, such as day by day or month by month.
The process is: Update predictions -&gt; Prepare tasks -&gt; Prepare online models -&gt; Prepare signals.</p>
<p>If using DelayTrainer, it can finish training all together after every strategy’s prepare_tasks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cur_time</strong> (<em>Union</em><em>[</em><em>str</em><em>,</em><em>pd.Timestamp</em><em>]</em><em>, </em><em>optional</em>) – run routine method in this time. Defaults to None.</p></li>
<li><p><strong>task_kwargs</strong> (<em>dict</em>) – the params for <cite>prepare_tasks</cite></p></li>
<li><p><strong>model_kwargs</strong> (<em>dict</em>) – the params for <cite>prepare_online_models</cite></p></li>
<li><p><strong>signal_kwargs</strong> (<em>dict</em>) – the params for <cite>prepare_signals</cite></p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager.get_collector">
<span class="sig-name descname"><span class="pre">get_collector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><a class="reference internal" href="#qlib.workflow.task.collect.MergeCollector" title="qlib.workflow.task.collect.MergeCollector"><span class="pre">MergeCollector</span></a></span></span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager.get_collector" title="Permalink to this definition"></a></dt>
<dd><p>Get the instance of <a class="reference external" href="../advanced/task_management.html#TaskCollecting">Collector</a> to collect results from every strategy.
This collector can be a basis as the signals preparation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>**kwargs</strong> – the params for get_collector.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the collector to merge other collectors.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.workflow.task.collect.MergeCollector" title="qlib.workflow.task.collect.MergeCollector">MergeCollector</a></p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager.add_strategy">
<span class="sig-name descname"><span class="pre">add_strategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategies</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><span class="pre">OnlineStrategy</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><span class="pre">OnlineStrategy</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager.add_strategy" title="Permalink to this definition"></a></dt>
<dd><p>Add some new strategies to OnlineManager.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>strategy</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><em>OnlineStrategy</em></a><em>, </em><em>List</em><em>[</em><a class="reference internal" href="#qlib.workflow.online.strategy.OnlineStrategy" title="qlib.workflow.online.strategy.OnlineStrategy"><em>OnlineStrategy</em></a><em>]</em><em>]</em>) – a list of OnlineStrategy</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager.prepare_signals">
<span class="sig-name descname"><span class="pre">prepare_signals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prepare_func:</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;qlib.model.ens.ensemble.AverageEnsemble</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">over_write=False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager.prepare_signals" title="Permalink to this definition"></a></dt>
<dd><p>After preparing the data of the last routine (a box in box-plot) which means the end of the routine, we can prepare trading signals for the next routine.</p>
<p>NOTE: Given a set prediction, all signals before these prediction end times will be prepared well.</p>
<p>Even if the latest signal already exists, the latest calculation result will be overwritten.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Given a prediction of a certain time, all signals before this time will be prepared well.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prepare_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – Get signals from a dict after collecting. Defaults to AverageEnsemble(), the results collected by MergeCollector must be {xxx:pred}.</p></li>
<li><p><strong>over_write</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the new signals will overwrite. If False, the new signals will append to the end of signals. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the signals.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager.get_signals">
<span class="sig-name descname"><span class="pre">get_signals</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Series</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager.get_signals" title="Permalink to this definition"></a></dt>
<dd><p>Get prepared online signals.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series for only one signals every datetime.
pd.DataFrame for multiple signals, for example, buy and sell operations use different trading signals.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Union[pd.Series, pd.DataFrame]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager.simulate">
<span class="sig-name descname"><span class="pre">simulate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">end_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frequency</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Series</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager.simulate" title="Permalink to this definition"></a></dt>
<dd><p>Starting from the current time, this method will simulate every routine in OnlineManager until the end time.</p>
<p>Considering the parallel training, the models and signals can be prepared after all routine simulating.</p>
<p>The delay training way can be <code class="docutils literal notranslate"><span class="pre">DelayTrainer</span></code> and the delay preparing signals way can be <code class="docutils literal notranslate"><span class="pre">delay_prepare</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>end_time</strong> – the time the simulation will end</p></li>
<li><p><strong>frequency</strong> – the calendar frequency</p></li>
<li><p><strong>task_kwargs</strong> (<em>dict</em>) – the params for <cite>prepare_tasks</cite></p></li>
<li><p><strong>model_kwargs</strong> (<em>dict</em>) – the params for <cite>prepare_online_models</cite></p></li>
<li><p><strong>signal_kwargs</strong> (<em>dict</em>) – the params for <cite>prepare_signals</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.Series for only one signals every datetime.
pd.DataFrame for multiple signals, for example, buy and sell operations use different trading signals.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[pd.Series, pd.DataFrame]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.manager.OnlineManager.delay_prepare">
<span class="sig-name descname"><span class="pre">delay_prepare</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.manager.OnlineManager.delay_prepare" title="Permalink to this definition"></a></dt>
<dd><p>Prepare all models and signals if something is waiting for preparation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_kwargs</strong> – the params for <cite>end_train</cite></p></li>
<li><p><strong>signal_kwargs</strong> – the params for <cite>prepare_signals</cite></p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="id5">
<h3>Online Strategy<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h3>
<span class="target" id="module-qlib.workflow.online.strategy"></span><p>OnlineStrategy module is an element of online serving.</p>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.OnlineStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.strategy.</span></span><span class="sig-name descname"><span class="pre">OnlineStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.strategy.OnlineStrategy" title="Permalink to this definition"></a></dt>
<dd><p>OnlineStrategy is working with <a class="reference external" href="#OnlineManager">Online Manager</a>, responding to how the tasks are generated, the models are updated and signals are prepared.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.OnlineStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.strategy.OnlineStrategy.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init OnlineStrategy.
This module <strong>MUST</strong> use <a class="reference external" href="../reference/api.html#qlib.model.trainer.Trainer">Trainer</a> to finishing model training.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name_id</strong> (<em>str</em>) – a unique name or id.</p></li>
<li><p><strong>trainer</strong> (<a class="reference internal" href="#qlib.model.trainer.Trainer" title="qlib.model.trainer.Trainer"><em>qlib.model.trainer.Trainer</em></a><em>, </em><em>optional</em>) – a instance of Trainer. Defaults to None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.OnlineStrategy.prepare_tasks">
<span class="sig-name descname"><span class="pre">prepare_tasks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cur_time</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.online.strategy.OnlineStrategy.prepare_tasks" title="Permalink to this definition"></a></dt>
<dd><p>After the end of a routine, check whether we need to prepare and train some new tasks based on cur_time (None for latest)..
Return the new tasks waiting for training.</p>
<p>You can find the last online models by OnlineTool.online_models.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.OnlineStrategy.prepare_online_models">
<span class="sig-name descname"><span class="pre">prepare_online_models</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trained_models</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">object</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.online.strategy.OnlineStrategy.prepare_online_models" title="Permalink to this definition"></a></dt>
<dd><p>Select some models from trained models and set them to online models.
This is a typical implementation to online all trained models, you can override it to implement the complex method.
You can find the last online models by OnlineTool.online_models if you still need them.</p>
<p>NOTE: Reset all online models to trained models. If there are no trained models, then do nothing.</p>
<dl class="simple">
<dt><strong>NOTE</strong>:</dt><dd><p>Current implementation is very naive. Here is a more complex situation which is more closer to the
practical scenarios.
1. Train new models at the day before <cite>test_start</cite> (at time stamp <cite>T</cite>)
2. Switch models at the <cite>test_start</cite> (at time timestamp <cite>T + 1</cite> typically)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>models</strong> (<em>list</em>) – a list of models.</p></li>
<li><p><strong>cur_time</strong> (<em>pd.Dataframe</em>) – current time from OnlineManger. None for the latest.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of online models.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[object]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.OnlineStrategy.first_tasks">
<span class="sig-name descname"><span class="pre">first_tasks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.online.strategy.OnlineStrategy.first_tasks" title="Permalink to this definition"></a></dt>
<dd><p>Generate a series of tasks firstly and return them.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.OnlineStrategy.get_collector">
<span class="sig-name descname"><span class="pre">get_collector</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><a class="reference internal" href="#qlib.workflow.task.collect.Collector" title="qlib.workflow.task.collect.Collector"><span class="pre">Collector</span></a></span></span><a class="headerlink" href="#qlib.workflow.online.strategy.OnlineStrategy.get_collector" title="Permalink to this definition"></a></dt>
<dd><p>Get the instance of <a class="reference external" href="../advanced/task_management.html#TaskCollecting">Collector</a> to collect different results of this strategy.</p>
<dl class="simple">
<dt>For example:</dt><dd><ol class="arabic simple">
<li><p>collect predictions in Recorder</p></li>
<li><p>collect signals in a txt file</p></li>
</ol>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Collector</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.RollingStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.strategy.</span></span><span class="sig-name descname"><span class="pre">RollingStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_template</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling_gen</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.task.gen.RollingGen" title="qlib.workflow.task.gen.RollingGen"><span class="pre">RollingGen</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.strategy.RollingStrategy" title="Permalink to this definition"></a></dt>
<dd><p>This example strategy always uses the latest rolling model sas online models.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.RollingStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_template</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling_gen</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.task.gen.RollingGen" title="qlib.workflow.task.gen.RollingGen"><span class="pre">RollingGen</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.strategy.RollingStrategy.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init RollingStrategy.</p>
<p>Assumption: the str of name_id, the experiment name, and the trainer’s experiment name are the same.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name_id</strong> (<em>str</em>) – a unique name or id. Will be also the name of the Experiment.</p></li>
<li><p><strong>task_template</strong> (<em>Union</em><em>[</em><em>dict</em><em>, </em><em>List</em><em>[</em><em>dict</em><em>]</em><em>]</em>) – a list of task_template or a single template, which will be used to generate many tasks using rolling_gen.</p></li>
<li><p><strong>rolling_gen</strong> (<a class="reference internal" href="#qlib.workflow.task.gen.RollingGen" title="qlib.workflow.task.gen.RollingGen"><em>RollingGen</em></a>) – an instance of RollingGen</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.RollingStrategy.get_collector">
<span class="sig-name descname"><span class="pre">get_collector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">process_list=[&lt;qlib.model.ens.group.RollingGroup</span> <span class="pre">object&gt;],</span> <span class="pre">rec_key_func=None,</span> <span class="pre">rec_filter_func=None,</span> <span class="pre">artifacts_key=None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.strategy.RollingStrategy.get_collector" title="Permalink to this definition"></a></dt>
<dd><p>Get the instance of <a class="reference external" href="../advanced/task_management.html#TaskCollecting">Collector</a> to collect results. The returned collector must distinguish results in different models.</p>
<p>Assumption: the models can be distinguished based on the model name and rolling test segments.
If you do not want this assumption, please implement your method or use another rec_key_func.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rec_key_func</strong> (<em>Callable</em>) – a function to get the key of a recorder. If None, use recorder id.</p></li>
<li><p><strong>rec_filter_func</strong> (<em>Callable</em><em>, </em><em>optional</em>) – filter the recorder by return True or False. Defaults to None.</p></li>
<li><p><strong>artifacts_key</strong> (<em>List</em><em>[</em><em>str</em><em>]</em><em>, </em><em>optional</em>) – the artifacts key you want to get. If None, get all artifacts.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.RollingStrategy.first_tasks">
<span class="sig-name descname"><span class="pre">first_tasks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.online.strategy.RollingStrategy.first_tasks" title="Permalink to this definition"></a></dt>
<dd><p>Use rolling_gen to generate different tasks based on task_template.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of tasks</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>List[dict]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.strategy.RollingStrategy.prepare_tasks">
<span class="sig-name descname"><span class="pre">prepare_tasks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cur_time</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.workflow.online.strategy.RollingStrategy.prepare_tasks" title="Permalink to this definition"></a></dt>
<dd><p>Prepare new tasks based on cur_time (None for the latest).</p>
<p>You can find the last online models by OnlineToolR.online_models.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of new tasks.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>List[dict]</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.workflow.online.utils">
<span id="online-tool"></span><h3>Online Tool<a class="headerlink" href="#module-qlib.workflow.online.utils" title="Permalink to this heading"></a></h3>
<p>OnlineTool is a module to set and unset a series of <cite>online</cite> models.
The <cite>online</cite> models are some decisive models in some time points, which can be changed with the change of time.
This allows us to use efficient submodels as the market-style changing.</p>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineTool">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.utils.</span></span><span class="sig-name descname"><span class="pre">OnlineTool</span></span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineTool" title="Permalink to this definition"></a></dt>
<dd><p>OnlineTool will manage <cite>online</cite> models in an experiment that includes the model recorders.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineTool.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineTool.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init OnlineTool.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineTool.set_online_tag">
<span class="sig-name descname"><span class="pre">set_online_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">object</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineTool.set_online_tag" title="Permalink to this definition"></a></dt>
<dd><p>Set <cite>tag</cite> to the model to sign whether online.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tag</strong> (<em>str</em>) – the tags in <cite>ONLINE_TAG</cite>, <cite>OFFLINE_TAG</cite></p></li>
<li><p><strong>recorder</strong> (<em>Union</em><em>[</em><em>list</em><em>,</em><em>object</em><em>]</em>) – the model’s recorder</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineTool.get_online_tag">
<span class="sig-name descname"><span class="pre">get_online_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineTool.get_online_tag" title="Permalink to this definition"></a></dt>
<dd><p>Given a model recorder and return its online tag.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>recorder</strong> (<em>Object</em>) – the model’s recorder</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the online tag</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineTool.reset_online_tag">
<span class="sig-name descname"><span class="pre">reset_online_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">object</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineTool.reset_online_tag" title="Permalink to this definition"></a></dt>
<dd><p>Offline all models and set the recorders to ‘online’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>recorder</strong> (<em>Union</em><em>[</em><em>list</em><em>,</em><em>object</em><em>]</em>) – the recorder you want to reset to ‘online’.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineTool.online_models">
<span class="sig-name descname"><span class="pre">online_models</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineTool.online_models" title="Permalink to this definition"></a></dt>
<dd><p>Get current <cite>online</cite> models</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of <cite>online</cite> models.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineTool.update_online_pred">
<span class="sig-name descname"><span class="pre">update_online_pred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">to_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineTool.update_online_pred" title="Permalink to this definition"></a></dt>
<dd><p>Update the predictions of <cite>online</cite> models to to_date.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>to_date</strong> (<em>pd.Timestamp</em>) – the pred before this date will be updated. None for updating to the latest.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineToolR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.utils.</span></span><span class="sig-name descname"><span class="pre">OnlineToolR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">default_exp_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineToolR" title="Permalink to this definition"></a></dt>
<dd><p>The implementation of OnlineTool based on (R)ecorder.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineToolR.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">default_exp_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineToolR.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init OnlineToolR.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>default_exp_name</strong> (<em>str</em>) – the default experiment name.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineToolR.set_online_tag">
<span class="sig-name descname"><span class="pre">set_online_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recorder</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineToolR.set_online_tag" title="Permalink to this definition"></a></dt>
<dd><p>Set <cite>tag</cite> to the model’s recorder to sign whether online.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tag</strong> (<em>str</em>) – the tags in <cite>ONLINE_TAG</cite>, <cite>NEXT_ONLINE_TAG</cite>, <cite>OFFLINE_TAG</cite></p></li>
<li><p><strong>recorder</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><em>Recorder</em></a><em>, </em><em>List</em><em>]</em>) – a list of Recorder or an instance of Recorder</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineToolR.get_online_tag">
<span class="sig-name descname"><span class="pre">get_online_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineToolR.get_online_tag" title="Permalink to this definition"></a></dt>
<dd><p>Given a model recorder and return its online tag.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>recorder</strong> (<a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><em>Recorder</em></a>) – an instance of recorder</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the online tag</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineToolR.reset_online_tag">
<span class="sig-name descname"><span class="pre">reset_online_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recorder</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineToolR.reset_online_tag" title="Permalink to this definition"></a></dt>
<dd><p>Offline all models and set the recorders to ‘online’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>recorder</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><em>Recorder</em></a><em>, </em><em>List</em><em>]</em>) – the recorder you want to reset to ‘online’.</p></li>
<li><p><strong>exp_name</strong> (<em>str</em>) – the experiment name. If None, then use default_exp_name.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineToolR.online_models">
<span class="sig-name descname"><span class="pre">online_models</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exp_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineToolR.online_models" title="Permalink to this definition"></a></dt>
<dd><p>Get current <cite>online</cite> models</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>exp_name</strong> (<em>str</em>) – the experiment name. If None, then use default_exp_name.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of <cite>online</cite> models.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.utils.OnlineToolR.update_online_pred">
<span class="sig-name descname"><span class="pre">update_online_pred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">to_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">from_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.utils.OnlineToolR.update_online_pred" title="Permalink to this definition"></a></dt>
<dd><p>Update the predictions of online models to to_date.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>to_date</strong> (<em>pd.Timestamp</em>) – the pred before this date will be updated. None for updating to latest time in Calendar.</p></li>
<li><p><strong>exp_name</strong> (<em>str</em>) – the experiment name. If None, then use default_exp_name.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="module-qlib.workflow.online.update">
<span id="recordupdater"></span><h3>RecordUpdater<a class="headerlink" href="#module-qlib.workflow.online.update" title="Permalink to this heading"></a></h3>
<p>Updater is a module to update artifacts such as predictions when the stock data is updating.</p>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.update.RMDLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.update.</span></span><span class="sig-name descname"><span class="pre">RMDLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rec</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.RMDLoader" title="Permalink to this definition"></a></dt>
<dd><p>Recorder Model Dataset Loader</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.RMDLoader.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rec</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.RMDLoader.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.RMDLoader.get_dataset">
<span class="sig-name descname"><span class="pre">get_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unprepared_dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DatasetH</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DatasetH</span></span></span><a class="headerlink" href="#qlib.workflow.online.update.RMDLoader.get_dataset" title="Permalink to this definition"></a></dt>
<dd><p>Load, config and setup dataset.</p>
<p>This dataset is for inference.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_time</strong> – the start_time of underlying data</p></li>
<li><p><strong>end_time</strong> – the end_time of underlying data</p></li>
<li><p><strong>segments</strong> – dict
the segments config for dataset
Due to the time series dataset (TSDatasetH), the test segments maybe different from start_time and end_time</p></li>
<li><p><strong>unprepared_dataset</strong> – Optional[DatasetH]
if user don’t want to load dataset from recorder, please specify user’s dataset</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the instance of DatasetH</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.data.dataset.__init__.DatasetH" title="qlib.data.dataset.__init__.DatasetH">DatasetH</a></p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.update.RecordUpdater">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.update.</span></span><span class="sig-name descname"><span class="pre">RecordUpdater</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.RecordUpdater" title="Permalink to this definition"></a></dt>
<dd><p>Update a specific recorders</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.RecordUpdater.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.RecordUpdater.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.RecordUpdater.update">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.RecordUpdater.update" title="Permalink to this definition"></a></dt>
<dd><p>Update info for specific recorder</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.update.DSBasedUpdater">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.update.</span></span><span class="sig-name descname"><span class="pre">DSBasedUpdater</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record:</span> <span class="pre">~qlib.workflow.recorder.Recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_date=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">from_date=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hist_ref:</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq='day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fname='pred.pkl'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loader_cls:</span> <span class="pre">type</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'qlib.workflow.online.update.RMDLoader'&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.DSBasedUpdater" title="Permalink to this definition"></a></dt>
<dd><p>Dataset-Based Updater</p>
<ul class="simple">
<li><p>Providing updating feature for Updating data based on Qlib Dataset</p></li>
</ul>
<p>Assumption</p>
<ul>
<li><p>Based on Qlib dataset</p></li>
<li><p>The data to be updated is a multi-level index pd.DataFrame. For example label, prediction.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                         <span class="n">LABEL0</span>
<span class="n">datetime</span>   <span class="n">instrument</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">10</span> <span class="n">SH600000</span>    <span class="mf">0.006965</span>
           <span class="n">SH600004</span>    <span class="mf">0.003407</span>
<span class="o">...</span>                         <span class="o">...</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">28</span> <span class="n">SZ300498</span>    <span class="mf">0.015748</span>
           <span class="n">SZ300676</span>   <span class="o">-</span><span class="mf">0.001321</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.DSBasedUpdater.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record:</span> <span class="pre">~qlib.workflow.recorder.Recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_date=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">from_date=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hist_ref:</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq='day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fname='pred.pkl'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loader_cls:</span> <span class="pre">type</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'qlib.workflow.online.update.RMDLoader'&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.DSBasedUpdater.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init PredUpdater.</p>
<p>Expected behavior in following cases:</p>
<ul class="simple">
<li><p>if <cite>to_date</cite> is greater than the max date in the calendar, the data will be updated to the latest date</p></li>
<li><p>if there are data before <cite>from_date</cite> or after <cite>to_date</cite>, only the data between <cite>from_date</cite> and <cite>to_date</cite> are affected.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>record</strong> – Recorder</p></li>
<li><p><strong>to_date</strong> – <p>update to prediction to the <cite>to_date</cite></p>
<p>if to_date is None:</p>
<blockquote>
<div><p>data will updated to the latest date.</p>
</div></blockquote>
</p></li>
<li><p><strong>from_date</strong> – <p>the update will start from <cite>from_date</cite></p>
<p>if from_date is None:</p>
<blockquote>
<div><p>the updating will occur on the next tick after the latest data in historical data</p>
</div></blockquote>
</p></li>
<li><p><strong>hist_ref</strong> – <p>int
Sometimes, the dataset will have historical depends.
Leave the problem to users to set the length of historical dependency
If user doesn’t specify this parameter, Updater will try to load dataset to automatically determine the hist_ref</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the start_time is not included in the <cite>hist_ref</cite>; So the <cite>hist_ref</cite> will be <cite>step_len - 1</cite> in most cases</p>
</div>
</p></li>
<li><p><strong>loader_cls</strong> – type
the class to load the model and dataset</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.DSBasedUpdater.prepare_data">
<span class="sig-name descname"><span class="pre">prepare_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unprepared_dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DatasetH</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DatasetH</span></span></span><a class="headerlink" href="#qlib.workflow.online.update.DSBasedUpdater.prepare_data" title="Permalink to this definition"></a></dt>
<dd><p>Load dataset
- if unprepared_dataset is specified, then prepare the dataset directly
- Otherwise,</p>
<p>Separating this function will make it easier to reuse the dataset</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the instance of DatasetH</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#qlib.data.dataset.__init__.DatasetH" title="qlib.data.dataset.__init__.DatasetH">DatasetH</a></p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.DSBasedUpdater.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DatasetH</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ret_new</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">object</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.workflow.online.update.DSBasedUpdater.update" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<a class="reference internal" href="#qlib.data.dataset.__init__.DatasetH" title="qlib.data.dataset.__init__.DatasetH"><em>DatasetH</em></a>) – DatasetH: the instance of DatasetH. None for prepare it again.</p></li>
<li><p><strong>write</strong> (<em>bool</em>) – will the the write action be executed</p></li>
<li><p><strong>ret_new</strong> (<em>bool</em>) – will the updated data be returned</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the updated dataset</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[object]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.DSBasedUpdater.get_update_data">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_update_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.workflow.online.update.DSBasedUpdater.get_update_data" title="Permalink to this definition"></a></dt>
<dd><p>return the updated data based on the given dataset</p>
<p>The difference between <cite>get_update_data</cite> and <cite>update</cite>
- <cite>update_date</cite> only include some data specific feature
- <cite>update</cite> include some general routine steps(e.g. prepare dataset, checking)</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.update.PredUpdater">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.update.</span></span><span class="sig-name descname"><span class="pre">PredUpdater</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record:</span> <span class="pre">~qlib.workflow.recorder.Recorder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_date=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">from_date=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hist_ref:</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq='day'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fname='pred.pkl'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loader_cls:</span> <span class="pre">type</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'qlib.workflow.online.update.RMDLoader'&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.PredUpdater" title="Permalink to this definition"></a></dt>
<dd><p>Update the prediction in the Recorder</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.PredUpdater.get_update_data">
<span class="sig-name descname"><span class="pre">get_update_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.workflow.online.update.PredUpdater.get_update_data" title="Permalink to this definition"></a></dt>
<dd><p>return the updated data based on the given dataset</p>
<p>The difference between <cite>get_update_data</cite> and <cite>update</cite>
- <cite>update_date</cite> only include some data specific feature
- <cite>update</cite> include some general routine steps(e.g. prepare dataset, checking)</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.workflow.online.update.LabelUpdater">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.workflow.online.update.</span></span><span class="sig-name descname"><span class="pre">LabelUpdater</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.LabelUpdater" title="Permalink to this definition"></a></dt>
<dd><p>Update the label in the recorder</p>
<p>Assumption
- The label is generated from record_temp.SignalRecord.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.LabelUpdater.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.workflow.recorder.Recorder" title="qlib.workflow.recorder.Recorder"><span class="pre">Recorder</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.workflow.online.update.LabelUpdater.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Init PredUpdater.</p>
<p>Expected behavior in following cases:</p>
<ul class="simple">
<li><p>if <cite>to_date</cite> is greater than the max date in the calendar, the data will be updated to the latest date</p></li>
<li><p>if there are data before <cite>from_date</cite> or after <cite>to_date</cite>, only the data between <cite>from_date</cite> and <cite>to_date</cite> are affected.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>record</strong> – Recorder</p></li>
<li><p><strong>to_date</strong> – <p>update to prediction to the <cite>to_date</cite></p>
<p>if to_date is None:</p>
<blockquote>
<div><p>data will updated to the latest date.</p>
</div></blockquote>
</p></li>
<li><p><strong>from_date</strong> – <p>the update will start from <cite>from_date</cite></p>
<p>if from_date is None:</p>
<blockquote>
<div><p>the updating will occur on the next tick after the latest data in historical data</p>
</div></blockquote>
</p></li>
<li><p><strong>hist_ref</strong> – <p>int
Sometimes, the dataset will have historical depends.
Leave the problem to users to set the length of historical dependency
If user doesn’t specify this parameter, Updater will try to load dataset to automatically determine the hist_ref</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the start_time is not included in the <cite>hist_ref</cite>; So the <cite>hist_ref</cite> will be <cite>step_len - 1</cite> in most cases</p>
</div>
</p></li>
<li><p><strong>loader_cls</strong> – type
the class to load the model and dataset</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.workflow.online.update.LabelUpdater.get_update_data">
<span class="sig-name descname"><span class="pre">get_update_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#qlib.workflow.online.update.LabelUpdater.get_update_data" title="Permalink to this definition"></a></dt>
<dd><p>return the updated data based on the given dataset</p>
<p>The difference between <cite>get_update_data</cite> and <cite>update</cite>
- <cite>update_date</cite> only include some data specific feature
- <cite>update</cite> include some general routine steps(e.g. prepare dataset, checking)</p>
</dd></dl>
</dd></dl>
</section>
</section>
<section id="id10">
<h2>Utils<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h2>
<section id="module-qlib.utils.serial">
<span id="serializable"></span><h3>Serializable<a class="headerlink" href="#module-qlib.utils.serial" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.utils.serial.Serializable">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.utils.serial.</span></span><span class="sig-name descname"><span class="pre">Serializable</span></span><a class="headerlink" href="#qlib.utils.serial.Serializable" title="Permalink to this definition"></a></dt>
<dd><p>Serializable will change the behaviors of pickle.</p>
<blockquote>
<div><p>The rule to tell if a attribute will be kept or dropped when dumping.
The rule with higher priorities is on the top
- in the config attribute list -&gt; always dropped
- in the include attribute list -&gt; always kept
- in the exclude attribute list -&gt; always dropped
- name not starts with <cite>_</cite> -&gt; kept
- name starts with <cite>_</cite> -&gt; kept if <cite>dump_all</cite> is true else dropped</p>
</div></blockquote>
<p>It provides a syntactic sugar for distinguish the attributes which user doesn’t want.
- For examples, a learnable Datahandler just wants to save the parameters without data when dumping to disk</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.utils.serial.Serializable.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.utils.serial.Serializable.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="qlib.utils.serial.Serializable.dump_all">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dump_all</span></span><a class="headerlink" href="#qlib.utils.serial.Serializable.dump_all" title="Permalink to this definition"></a></dt>
<dd><p>will the object dump all object</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.utils.serial.Serializable.config">
<span class="sig-name descname"><span class="pre">config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">recursive</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.utils.serial.Serializable.config" title="Permalink to this definition"></a></dt>
<dd><p>configure the serializable object</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>keys</strong> (<em>kwargs may include following</em>) – <dl class="simple">
<dt>dump_all<span class="classifier">bool</span></dt><dd><p>will the object dump all object</p>
</dd>
<dt>exclude<span class="classifier">list</span></dt><dd><p>What attribute will not be dumped</p>
</dd>
<dt>include<span class="classifier">list</span></dt><dd><p>What attribute will be dumped</p>
</dd>
</dl>
</p></li>
<li><p><strong>recursive</strong> (<em>bool</em>) – will the configuration be recursive</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.utils.serial.Serializable.to_pickle">
<span class="sig-name descname"><span class="pre">to_pickle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.utils.serial.Serializable.to_pickle" title="Permalink to this definition"></a></dt>
<dd><p>Dump self to a pickle file.</p>
<p>path (Union[Path, str]): the path to dump</p>
<p>kwargs may include following keys</p>
<blockquote>
<div><dl class="simple">
<dt>dump_all<span class="classifier">bool</span></dt><dd><p>will the object dump all object</p>
</dd>
<dt>exclude<span class="classifier">list</span></dt><dd><p>What attribute will not be dumped</p>
</dd>
<dt>include<span class="classifier">list</span></dt><dd><p>What attribute will be dumped</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.utils.serial.Serializable.load">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.utils.serial.Serializable.load" title="Permalink to this definition"></a></dt>
<dd><p>Load the serializable class from a filepath.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filepath</strong> (<em>str</em>) – the path of file</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>TypeError</strong> – the pickled file must be <cite>type(cls)</cite></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the instance of <cite>type(cls)</cite></p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><cite>type(cls)</cite></p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.utils.serial.Serializable.get_backend">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_backend</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.utils.serial.Serializable.get_backend" title="Permalink to this definition"></a></dt>
<dd><p>Return the real backend of a Serializable class. The pickle_backend value can be “pickle” or “dill”.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>pickle or dill module based on pickle_backend</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>module</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.utils.serial.Serializable.general_dump">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">general_dump</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.utils.serial.Serializable.general_dump" title="Permalink to this definition"></a></dt>
<dd><p>A general dumping method for object</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obj</strong> (<em>object</em>) – the object to be dumped</p></li>
<li><p><strong>path</strong> (<em>Union</em><em>[</em><em>Path</em><em>, </em><em>str</em><em>]</em>) – the target path the data will be dumped</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
</section>
<section id="rl">
<h2>RL<a class="headerlink" href="#rl" title="Permalink to this heading"></a></h2>
<section id="module-qlib.rl">
<span id="base-component"></span><h3>Base Component<a class="headerlink" href="#module-qlib.rl" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.Interpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.</span></span><span class="sig-name descname"><span class="pre">Interpreter</span></span><a class="headerlink" href="#qlib.rl.Interpreter" title="Permalink to this definition"></a></dt>
<dd><p>Interpreter is a media between states produced by simulators and states needed by RL policies.
Interpreters are two-way:</p>
<ol class="arabic simple">
<li><p>From simulator state to policy state (aka observation), see <a class="reference internal" href="#qlib.rl.StateInterpreter" title="qlib.rl.StateInterpreter"><code class="xref py py-class docutils literal notranslate"><span class="pre">StateInterpreter</span></code></a>.</p></li>
<li><p>From policy action to action accepted by simulator, see <a class="reference internal" href="#qlib.rl.ActionInterpreter" title="qlib.rl.ActionInterpreter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ActionInterpreter</span></code></a>.</p></li>
</ol>
<p>Inherit one of the two sub-classes to define your own interpreter.
This super-class is only used for isinstance check.</p>
<p>Interpreters are recommended to be stateless, meaning that storing temporary information with <code class="docutils literal notranslate"><span class="pre">self.xxx</span></code>
in interpreter is anti-pattern. In future, we might support register some interpreter-related
states by calling <code class="docutils literal notranslate"><span class="pre">self.env.register_state()</span></code>, but it’s not planned for first iteration.</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.StateInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.</span></span><span class="sig-name descname"><span class="pre">StateInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.StateInterpreter" title="Permalink to this definition"></a></dt>
<dd><p>State Interpreter that interpret execution result of qlib executor into rl env state</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.StateInterpreter.validate">
<span class="sig-name descname"><span class="pre">validate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ObsType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.StateInterpreter.validate" title="Permalink to this definition"></a></dt>
<dd><p>Validate whether an observation belongs to the pre-defined observation space.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.StateInterpreter.interpret">
<span class="sig-name descname"><span class="pre">interpret</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulator_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">StateType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">ObsType</span></span></span><a class="headerlink" href="#qlib.rl.StateInterpreter.interpret" title="Permalink to this definition"></a></dt>
<dd><p>Interpret the state of simulator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>simulator_state</strong> – Retrieved with <code class="docutils literal notranslate"><span class="pre">simulator.get_state()</span></code>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>State needed by policy. Should conform with the state space defined in <code class="docutils literal notranslate"><span class="pre">observation_space</span></code>.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.ActionInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.</span></span><span class="sig-name descname"><span class="pre">ActionInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.ActionInterpreter" title="Permalink to this definition"></a></dt>
<dd><p>Action Interpreter that interpret rl agent action into qlib orders</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.ActionInterpreter.validate">
<span class="sig-name descname"><span class="pre">validate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PolicyActType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.ActionInterpreter.validate" title="Permalink to this definition"></a></dt>
<dd><p>Validate whether an action belongs to the pre-defined action space.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.ActionInterpreter.interpret">
<span class="sig-name descname"><span class="pre">interpret</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulator_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">StateType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PolicyActType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">ActType</span></span></span><a class="headerlink" href="#qlib.rl.ActionInterpreter.interpret" title="Permalink to this definition"></a></dt>
<dd><p>Convert the policy action to simulator action.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simulator_state</strong> – Retrieved with <code class="docutils literal notranslate"><span class="pre">simulator.get_state()</span></code>.</p></li>
<li><p><strong>action</strong> – Raw action given by policy.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>The action needed by simulator,</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.Reward">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.</span></span><span class="sig-name descname"><span class="pre">Reward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.Reward" title="Permalink to this definition"></a></dt>
<dd><p>Reward calculation component that takes a single argument: state of simulator. Returns a real number: reward.</p>
<p>Subclass should implement <code class="docutils literal notranslate"><span class="pre">reward(simulator_state)</span></code> to implement their own reward calculation recipe.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.Reward.reward">
<span class="sig-name descname"><span class="pre">reward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulator_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SimulatorState</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#qlib.rl.Reward.reward" title="Permalink to this definition"></a></dt>
<dd><p>Implement this method for your own reward.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.RewardCombination">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.</span></span><span class="sig-name descname"><span class="pre">RewardCombination</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rewards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.rl.Reward" title="qlib.rl.reward.Reward"><span class="pre">Reward</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.RewardCombination" title="Permalink to this definition"></a></dt>
<dd><p>Combination of multiple reward.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.RewardCombination.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rewards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.rl.Reward" title="qlib.rl.reward.Reward"><span class="pre">Reward</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.RewardCombination.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.RewardCombination.reward">
<span class="sig-name descname"><span class="pre">reward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulator_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#qlib.rl.RewardCombination.reward" title="Permalink to this definition"></a></dt>
<dd><p>Implement this method for your own reward.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.Simulator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.</span></span><span class="sig-name descname"><span class="pre">Simulator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">initial</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">InitialStateType</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.Simulator" title="Permalink to this definition"></a></dt>
<dd><p>Simulator that resets with <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, and transits with <code class="docutils literal notranslate"><span class="pre">step(action)</span></code>.</p>
<p>To make the data-flow clear, we make the following restrictions to Simulator:</p>
<ol class="arabic simple">
<li><p>The only way to modify the inner status of a simulator is by using <code class="docutils literal notranslate"><span class="pre">step(action)</span></code>.</p></li>
<li><p>External modules can <em>read</em> the status of a simulator by using <code class="docutils literal notranslate"><span class="pre">simulator.get_state()</span></code>,
and check whether the simulator is in the ending state by calling <code class="docutils literal notranslate"><span class="pre">simulator.done()</span></code>.</p></li>
</ol>
<p>A simulator is defined to be bounded with three types:</p>
<ul class="simple">
<li><p><em>InitialStateType</em> that is the type of the data used to create the simulator.</p></li>
<li><p><em>StateType</em> that is the type of the <strong>status</strong> (state) of the simulator.</p></li>
<li><p><em>ActType</em> that is the type of the <strong>action</strong>, which is the input received in each step.</p></li>
</ul>
<p>Different simulators might share the same StateType. For example, when they are dealing with the same task,
but with different simulation implementation. With the same type, they can safely share other components in the MDP.</p>
<p>Simulators are ephemeral. The lifecycle of a simulator starts with an initial state, and ends with the trajectory.
In another word, when the trajectory ends, simulator is recycled.
If simulators want to share context between (e.g., for speed-up purposes),
this could be done by accessing the weak reference of environment wrapper.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.Simulator.env">
<span class="sig-name descname"><span class="pre">env</span></span><a class="headerlink" href="#qlib.rl.Simulator.env" title="Permalink to this definition"></a></dt>
<dd><p>A reference of env-wrapper, which could be useful in some corner cases.
Simulators are discouraged to use this, because it’s prone to induce errors.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[<a class="reference internal" href="#qlib.rl.utils.EnvWrapper" title="qlib.rl.utils.EnvWrapper">EnvWrapper</a>]</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.Simulator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">initial</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">InitialStateType</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.Simulator.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.Simulator.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ActType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.Simulator.step" title="Permalink to this definition"></a></dt>
<dd><p>Receives an action of ActType.</p>
<p>Simulator should update its internal state, and return None.
The updated state can be retrieved with <code class="docutils literal notranslate"><span class="pre">simulator.get_state()</span></code>.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.Simulator.done">
<span class="sig-name descname"><span class="pre">done</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#qlib.rl.Simulator.done" title="Permalink to this definition"></a></dt>
<dd><p>Check whether the simulator is in a “done” state.
When simulator is in a “done” state,
it should no longer receives any <code class="docutils literal notranslate"><span class="pre">step</span></code> request.
As simulators are ephemeral, to reset the simulator,
the old one should be destroyed and a new simulator can be created.</p>
</dd></dl>
</dd></dl>
</section>
<section id="id11">
<h3>Strategy<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h3>
<span class="target" id="module-qlib.rl.strategy"></span><dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.strategy.SingleOrderStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.strategy.</span></span><span class="sig-name descname"><span class="pre">SingleOrderStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_range</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">TradeRange</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.strategy.SingleOrderStrategy" title="Permalink to this definition"></a></dt>
<dd><p>Strategy used to generate a trade decision with exactly one order.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.strategy.SingleOrderStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_range</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">TradeRange</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.strategy.SingleOrderStrategy.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outer_trade_decision</strong> (<em>BaseTradeDecision</em><em>, </em><em>optional</em>) – <p>the trade decision of outer strategy which this strategy relies, and it will be traded in
[start_time, end_time], by default None</p>
<ul>
<li><p>If the strategy is used to split trade decision, it will be used</p></li>
<li><p>If the strategy is used for portfolio management, it can be ignored</p></li>
</ul>
</p></li>
<li><p><strong>level_infra</strong> (<em>LevelInfrastructure</em><em>, </em><em>optional</em>) – level shared infrastructure for backtesting, including trade calendar</p></li>
<li><p><strong>common_infra</strong> (<em>CommonInfrastructure</em><em>, </em><em>optional</em>) – common infrastructure for backtesting, including trade_account, trade_exchange, .etc</p></li>
<li><p><strong>trade_exchange</strong> (<em>Exchange</em>) – <p>exchange that provides market info, used to deal order and generate report</p>
<ul>
<li><p>If <cite>trade_exchange</cite> is None, self.trade_exchange will be set with common_infra</p></li>
<li><p>It allows different trade_exchanges is used in different executions.</p></li>
<li><p>For example:</p>
<blockquote>
<div><ul class="simple">
<li><p>In daily execution, both daily exchange and minutely are usable, but the daily exchange is
recommended because it run faster.</p></li>
<li><p>In minutely execution, the daily exchange is not usable, only the minutely exchange is recommended.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.strategy.SingleOrderStrategy.generate_trade_decision">
<span class="sig-name descname"><span class="pre">generate_trade_decision</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">execute_result</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">TradeDecisionWO</span></span></span><a class="headerlink" href="#qlib.rl.strategy.SingleOrderStrategy.generate_trade_decision" title="Permalink to this definition"></a></dt>
<dd><p>Generate trade decision in each trading bar</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>execute_result</strong> (<em>List</em><em>[</em><em>object</em><em>]</em><em>, </em><em>optional</em>) – <p>the executed result for trade decision, by default None</p>
<ul class="simple">
<li><p>When call the generate_trade_decision firstly, <cite>execute_result</cite> could be None</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
<section id="id12">
<h3>Trainer<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h3>
<span class="target" id="module-qlib.rl.trainer"></span><p>Train, test, inference utilities.</p>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.trainer.</span></span><span class="sig-name descname"><span class="pre">Trainer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_every_n_iters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loggers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><span class="pre">LogWriter</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><span class="pre">LogWriter</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callbacks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Callback</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">finite_env_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FiniteEnvType</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'subproc'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">concurrency</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fast_dev_run</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.Trainer" title="Permalink to this definition"></a></dt>
<dd><p>Utility to train a policy on a particular task.</p>
<p>Different from traditional DL trainer, the iteration of this trainer is “collect”,
rather than “epoch”, or “mini-batch”.
In each collect, <code class="xref py py-class docutils literal notranslate"><span class="pre">Collector</span></code> collects a number of policy-env interactions, and accumulates
them into a replay buffer. This buffer is used as the “data” to train the policy.
At the end of each collect, the policy is <em>updated</em> several times.</p>
<p>The API has some resemblence with <a class="reference external" href="https://pytorch-lightning.readthedocs.io/">PyTorch Lightning</a>,
but it’s essentially different because this trainer is built for RL applications, and thus
most configurations are under RL context.
We are still looking for ways to incorporate existing trainer libraries, because it looks like
big efforts to build a trainer as powerful as those libraries, and also, that’s not our primary goal.</p>
<p>It’s essentially different
<a class="reference external" href="https://tianshou.readthedocs.io/en/master/api/tianshou.trainer.html">tianshou’s built-in trainers</a>,
as it’s far much more complicated than that.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>max_iters</strong> – Maximum iterations before stopping.</p></li>
<li><p><strong>val_every_n_iters</strong> – Perform validation every n iterations (i.e., training collects).</p></li>
<li><p><strong>logger</strong> – Logger to record the backtest results. Logger must be present because
without logger, all information will be lost.</p></li>
<li><p><strong>finite_env_type</strong> – Type of finite env implementation.</p></li>
<li><p><strong>concurrency</strong> – Parallel workers.</p></li>
<li><p><strong>fast_dev_run</strong> – Create a subset for debugging.
How this is implemented depends on the implementation of training vessel.
For <code class="xref py py-class docutils literal notranslate"><span class="pre">TrainingVessel</span></code>, if greater than zero,
a random subset sized <code class="docutils literal notranslate"><span class="pre">fast_dev_run</span></code> will be used
instead of <code class="docutils literal notranslate"><span class="pre">train_initial_states</span></code> and <code class="docutils literal notranslate"><span class="pre">val_initial_states</span></code>.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.should_stop">
<span class="sig-name descname"><span class="pre">should_stop</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#qlib.rl.trainer.Trainer.should_stop" title="Permalink to this definition"></a></dt>
<dd><p>Set to stop the training.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.metrics">
<span class="sig-name descname"><span class="pre">metrics</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">dict</span></em><a class="headerlink" href="#qlib.rl.trainer.Trainer.metrics" title="Permalink to this definition"></a></dt>
<dd><p>Numeric metrics of produced in train/val/test.
In the middle of training / validation, metrics will be of the latest episode.
When each iteration of training / validation finishes, metrics will be the aggregation
of all episodes encountered in this iteration.</p>
<p>Cleared on every new iteration of training.</p>
<p>In fit, validation metrics will be prefixed with <code class="docutils literal notranslate"><span class="pre">val/</span></code>.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.current_iter">
<span class="sig-name descname"><span class="pre">current_iter</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.trainer.Trainer.current_iter" title="Permalink to this definition"></a></dt>
<dd><p>Current iteration (collect) of training.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_every_n_iters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loggers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><span class="pre">LogWriter</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><span class="pre">LogWriter</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callbacks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Callback</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">finite_env_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FiniteEnvType</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'subproc'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">concurrency</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fast_dev_run</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.Trainer.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.loggers">
<span class="sig-name descname"><span class="pre">loggers</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.log.LogWriter"><span class="pre">LogWriter</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.rl.trainer.Trainer.loggers" title="Permalink to this definition"></a></dt>
<dd><p>A list of log writers.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.initialize">
<span class="sig-name descname"><span class="pre">initialize</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.Trainer.initialize" title="Permalink to this definition"></a></dt>
<dd><p>Initialize the whole training process.</p>
<p>The states here should be synchronized with state_dict.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.initialize_iter">
<span class="sig-name descname"><span class="pre">initialize_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.Trainer.initialize_iter" title="Permalink to this definition"></a></dt>
<dd><p>Initialize one iteration / collect.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.state_dict">
<span class="sig-name descname"><span class="pre">state_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.rl.trainer.Trainer.state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Putting every states of current training into a dict, at best effort.</p>
<p>It doesn’t try to handle all the possible kinds of states in the middle of one training collect.
For most cases at the end of each iteration, things should be usually correct.</p>
<p>Note that it’s also intended behavior that replay buffer data in the collector will be lost.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.load_state_dict">
<span class="sig-name descname"><span class="pre">load_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.Trainer.load_state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Load all states into current trainer.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.named_callbacks">
<span class="sig-name descname"><span class="pre">named_callbacks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callback</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.Trainer.named_callbacks" title="Permalink to this definition"></a></dt>
<dd><p>Retrieve a collection of callbacks where each one has a name.
Useful when saving checkpoints.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.named_loggers">
<span class="sig-name descname"><span class="pre">named_loggers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.log.LogWriter"><span class="pre">LogWriter</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.Trainer.named_loggers" title="Permalink to this definition"></a></dt>
<dd><p>Retrieve a collection of loggers where each one has a name.
Useful when saving checkpoints.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vessel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.TrainingVesselBase" title="qlib.rl.trainer.TrainingVesselBase"><span class="pre">TrainingVesselBase</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ckpt_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.Trainer.fit" title="Permalink to this definition"></a></dt>
<dd><p>Train the RL policy upon the defined simulator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vessel</strong> – A bundle of all elements used in training.</p></li>
<li><p><strong>ckpt_path</strong> – Load a pre-trained / paused training checkpoint.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.test">
<span class="sig-name descname"><span class="pre">test</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vessel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.TrainingVesselBase" title="qlib.rl.trainer.vessel.TrainingVesselBase"><span class="pre">TrainingVesselBase</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.Trainer.test" title="Permalink to this definition"></a></dt>
<dd><p>Test the RL policy against the simulator.</p>
<p>The simulator will be fed with data generated in <code class="docutils literal notranslate"><span class="pre">test_seed_iterator</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>vessel</strong> – A bundle of all related elements.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Trainer.venv_from_iterator">
<span class="sig-name descname"><span class="pre">venv_from_iterator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">FiniteVectorEnv</span></span></span><a class="headerlink" href="#qlib.rl.trainer.Trainer.venv_from_iterator" title="Permalink to this definition"></a></dt>
<dd><p>Create a vectorized environment from iterator and the training vessel.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVessel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.trainer.</span></span><span class="sig-name descname"><span class="pre">TrainingVessel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">simulator_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.Simulator" title="qlib.rl.Simulator"><span class="pre">Simulator</span></a><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ActType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.StateInterpreter" title="qlib.rl.StateInterpreter"><span class="pre">StateInterpreter</span></a><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ObsType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.ActionInterpreter" title="qlib.rl.ActionInterpreter"><span class="pre">ActionInterpreter</span></a><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PolicyActType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ActType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BasePolicy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.Reward" title="qlib.rl.Reward"><span class="pre">Reward</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_initial_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_initial_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_initial_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">20000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">episode_per_iter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.TrainingVessel" title="Permalink to this definition"></a></dt>
<dd><p>The default implementation of training vessel.</p>
<p><code class="docutils literal notranslate"><span class="pre">__init__</span></code> accepts a sequence of initial states so that iterator can be created.
<code class="docutils literal notranslate"><span class="pre">train</span></code>, <code class="docutils literal notranslate"><span class="pre">validate</span></code>, <code class="docutils literal notranslate"><span class="pre">test</span></code> each do one collect (and also update in train).
By default, the train initial states will be repeated infinitely during training,
and collector will control the number of episodes for each iteration.
In validation and testing, the val / test initial states will be used exactly once.</p>
<p>Extra hyper-parameters (only used in train) include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">buffer_size</span></code>: Size of replay buffer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">episode_per_iter</span></code>: Episodes per collect at training. Can be overridden by fast dev run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_kwargs</span></code>: Keyword arguments appearing in <code class="docutils literal notranslate"><span class="pre">policy.update</span></code>.
For example, <code class="docutils literal notranslate"><span class="pre">dict(repeat=10,</span> <span class="pre">batch_size=64)</span></code>.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVessel.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">simulator_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.Simulator" title="qlib.rl.Simulator"><span class="pre">Simulator</span></a><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ActType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.StateInterpreter" title="qlib.rl.StateInterpreter"><span class="pre">StateInterpreter</span></a><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ObsType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.ActionInterpreter" title="qlib.rl.ActionInterpreter"><span class="pre">ActionInterpreter</span></a><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PolicyActType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ActType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BasePolicy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.Reward" title="qlib.rl.Reward"><span class="pre">Reward</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_initial_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_initial_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_initial_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">20000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">episode_per_iter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.TrainingVessel.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVessel.train_seed_iterator">
<span class="sig-name descname"><span class="pre">train_seed_iterator</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">ContextManager</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVessel.train_seed_iterator" title="Permalink to this definition"></a></dt>
<dd><p>Override this to create a seed iterator for training.
If the iterable is a context manager, the whole training will be invoked in the with-block,
and the iterator will be automatically closed after the training is done.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVessel.val_seed_iterator">
<span class="sig-name descname"><span class="pre">val_seed_iterator</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">ContextManager</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVessel.val_seed_iterator" title="Permalink to this definition"></a></dt>
<dd><p>Override this to create a seed iterator for validation.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVessel.test_seed_iterator">
<span class="sig-name descname"><span class="pre">test_seed_iterator</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">ContextManager</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVessel.test_seed_iterator" title="Permalink to this definition"></a></dt>
<dd><p>Override this to create a seed iterator for testing.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVessel.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector_env</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FiniteVectorEnv</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVessel.train" title="Permalink to this definition"></a></dt>
<dd><p>Create a collector and collects <code class="docutils literal notranslate"><span class="pre">episode_per_iter</span></code> episodes.
Update the policy on the collected replay buffer.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVessel.validate">
<span class="sig-name descname"><span class="pre">validate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector_env</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FiniteVectorEnv</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVessel.validate" title="Permalink to this definition"></a></dt>
<dd><p>Implement this to validate the policy once.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVessel.test">
<span class="sig-name descname"><span class="pre">test</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector_env</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FiniteVectorEnv</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVessel.test" title="Permalink to this definition"></a></dt>
<dd><p>Implement this to evaluate the policy on test environment once.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVesselBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.trainer.</span></span><span class="sig-name descname"><span class="pre">TrainingVesselBase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.TrainingVesselBase" title="Permalink to this definition"></a></dt>
<dd><p>A ship that contains simulator, interpreter, and policy, will be sent to trainer.
This class controls algorithm-related parts of training, while trainer is responsible for runtime part.</p>
<p>The ship also defines the most important logic of the core training part,
and (optionally) some callbacks to insert customized logics at specific events.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVesselBase.train_seed_iterator">
<span class="sig-name descname"><span class="pre">train_seed_iterator</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">ContextManager</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVesselBase.train_seed_iterator" title="Permalink to this definition"></a></dt>
<dd><p>Override this to create a seed iterator for training.
If the iterable is a context manager, the whole training will be invoked in the with-block,
and the iterator will be automatically closed after the training is done.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVesselBase.val_seed_iterator">
<span class="sig-name descname"><span class="pre">val_seed_iterator</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">ContextManager</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVesselBase.val_seed_iterator" title="Permalink to this definition"></a></dt>
<dd><p>Override this to create a seed iterator for validation.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVesselBase.test_seed_iterator">
<span class="sig-name descname"><span class="pre">test_seed_iterator</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">ContextManager</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVesselBase.test_seed_iterator" title="Permalink to this definition"></a></dt>
<dd><p>Override this to create a seed iterator for testing.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVesselBase.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector_env</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseVectorEnv</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVesselBase.train" title="Permalink to this definition"></a></dt>
<dd><p>Implement this to train one iteration. In RL, one iteration usually refers to one collect.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVesselBase.validate">
<span class="sig-name descname"><span class="pre">validate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector_env</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FiniteVectorEnv</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVesselBase.validate" title="Permalink to this definition"></a></dt>
<dd><p>Implement this to validate the policy once.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVesselBase.test">
<span class="sig-name descname"><span class="pre">test</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector_env</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FiniteVectorEnv</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVesselBase.test" title="Permalink to this definition"></a></dt>
<dd><p>Implement this to evaluate the policy on test environment once.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVesselBase.state_dict">
<span class="sig-name descname"><span class="pre">state_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Dict</span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVesselBase.state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Return a checkpoint of current vessel state.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.TrainingVesselBase.load_state_dict">
<span class="sig-name descname"><span class="pre">load_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.TrainingVesselBase.load_state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Restore a checkpoint from a previously saved state dict.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.trainer.Checkpoint">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.trainer.</span></span><span class="sig-name descname"><span class="pre">Checkpoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dirpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'{iter:03d}.pth'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_latest</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'link'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'copy'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'link'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">every_n_iters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_on_fit_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.Checkpoint" title="Permalink to this definition"></a></dt>
<dd><p>Save checkpoints periodically for persistence and recovery.</p>
<p>Reference: <a class="reference external" href="https://github.com/PyTorchLightning/pytorch-lightning/blob/bfa8b7be/pytorch_lightning/callbacks/model_checkpoint.py">https://github.com/PyTorchLightning/pytorch-lightning/blob/bfa8b7be/pytorch_lightning/callbacks/model_checkpoint.py</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dirpath</strong> – Directory to save the checkpoint file.</p></li>
<li><p><strong>filename</strong> – <p>Checkpoint filename. Can contain named formatting options to be auto-filled.
For example: <code class="docutils literal notranslate"><span class="pre">{iter:03d}-{reward:.2f}.pth</span></code>.
Supported argument names are:</p>
<ul>
<li><p>iter (int)</p></li>
<li><p>metrics in <code class="docutils literal notranslate"><span class="pre">trainer.metrics</span></code></p></li>
<li><p>time string, in the format of <code class="docutils literal notranslate"><span class="pre">%Y%m%d%H%M%S</span></code></p></li>
</ul>
</p></li>
<li><p><strong>save_latest</strong> – Save the latest checkpoint in <code class="docutils literal notranslate"><span class="pre">latest.pth</span></code>.
If <code class="docutils literal notranslate"><span class="pre">link</span></code>, <code class="docutils literal notranslate"><span class="pre">latest.pth</span></code> will be created as a softlink.
If <code class="docutils literal notranslate"><span class="pre">copy</span></code>, <code class="docutils literal notranslate"><span class="pre">latest.pth</span></code> will be stored as an individual copy.
Set to none to disable this.</p></li>
<li><p><strong>every_n_iters</strong> – Checkpoints are saved at the end of every n iterations of training,
after validation if applicable.</p></li>
<li><p><strong>time_interval</strong> – Maximum time (seconds) before checkpoints save again.</p></li>
<li><p><strong>save_on_fit_end</strong> – Save one last checkpoint at the end to fit.
Do nothing if a checkpoint is already saved there.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Checkpoint.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dirpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'{iter:03d}.pth'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_latest</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'link'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'copy'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'link'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">every_n_iters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_on_fit_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.Checkpoint.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Checkpoint.on_fit_end">
<span class="sig-name descname"><span class="pre">on_fit_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.Trainer" title="qlib.rl.trainer.Trainer"><span class="pre">Trainer</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vessel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.TrainingVesselBase" title="qlib.rl.trainer.TrainingVesselBase"><span class="pre">TrainingVesselBase</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.Checkpoint.on_fit_end" title="Permalink to this definition"></a></dt>
<dd><p>Called after the whole fit process ends.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.Checkpoint.on_iter_end">
<span class="sig-name descname"><span class="pre">on_iter_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.Trainer" title="qlib.rl.trainer.Trainer"><span class="pre">Trainer</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vessel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.TrainingVesselBase" title="qlib.rl.trainer.TrainingVesselBase"><span class="pre">TrainingVesselBase</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.Checkpoint.on_iter_end" title="Permalink to this definition"></a></dt>
<dd><p>Called upon every end of iteration.
This is called <strong>after</strong> the bump of <code class="docutils literal notranslate"><span class="pre">current_iter</span></code>,
when the previous iteration is considered complete.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.trainer.EarlyStopping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.trainer.</span></span><span class="sig-name descname"><span class="pre">EarlyStopping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">monitor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'reward'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_delta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patience</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'min'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'max'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'max'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restore_best_weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.EarlyStopping" title="Permalink to this definition"></a></dt>
<dd><p>Stop training when a monitored metric has stopped improving.</p>
<p>The earlystopping callback will be triggered each time validation ends.
It will examine the metrics produced in validation,
and get the metric with name <code class="docutils literal notranslate"><span class="pre">monitor`</span> <span class="pre">(``monitor</span></code> is <code class="docutils literal notranslate"><span class="pre">reward</span></code> by default),
to check whether it’s no longer increasing / decreasing.
It takes <code class="docutils literal notranslate"><span class="pre">min_delta</span></code> and <code class="docutils literal notranslate"><span class="pre">patience</span></code> if applicable.
If it’s found to be not increasing / decreasing any more.
<code class="docutils literal notranslate"><span class="pre">trainer.should_stop</span></code> will be set to true,
and the training terminates.</p>
<p>Implementation reference: <a class="reference external" href="https://github.com/keras-team/keras/blob/v2.9.0/keras/callbacks.py#L1744-L1893">https://github.com/keras-team/keras/blob/v2.9.0/keras/callbacks.py#L1744-L1893</a></p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.EarlyStopping.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">monitor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'reward'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_delta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patience</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'min'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'max'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'max'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restore_best_weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.EarlyStopping.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.EarlyStopping.state_dict">
<span class="sig-name descname"><span class="pre">state_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.rl.trainer.EarlyStopping.state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Get a state dict of the callback for pause and resume.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.EarlyStopping.load_state_dict">
<span class="sig-name descname"><span class="pre">load_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.EarlyStopping.load_state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Resume the callback from a saved state dict.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.EarlyStopping.on_fit_start">
<span class="sig-name descname"><span class="pre">on_fit_start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.Trainer" title="qlib.rl.trainer.Trainer"><span class="pre">Trainer</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vessel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.TrainingVesselBase" title="qlib.rl.trainer.TrainingVesselBase"><span class="pre">TrainingVesselBase</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.EarlyStopping.on_fit_start" title="Permalink to this definition"></a></dt>
<dd><p>Called before the whole fit process begins.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.EarlyStopping.on_validate_end">
<span class="sig-name descname"><span class="pre">on_validate_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.Trainer" title="qlib.rl.trainer.Trainer"><span class="pre">Trainer</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vessel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.TrainingVesselBase" title="qlib.rl.trainer.TrainingVesselBase"><span class="pre">TrainingVesselBase</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.EarlyStopping.on_validate_end" title="Permalink to this definition"></a></dt>
<dd><p>Called when the validation ends.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.trainer.MetricsWriter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.trainer.</span></span><span class="sig-name descname"><span class="pre">MetricsWriter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dirpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.trainer.MetricsWriter" title="Permalink to this definition"></a></dt>
<dd><p>Dump training metrics to file.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.MetricsWriter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dirpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.MetricsWriter.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.MetricsWriter.on_train_end">
<span class="sig-name descname"><span class="pre">on_train_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.Trainer" title="qlib.rl.trainer.Trainer"><span class="pre">Trainer</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vessel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.TrainingVesselBase" title="qlib.rl.trainer.TrainingVesselBase"><span class="pre">TrainingVesselBase</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.MetricsWriter.on_train_end" title="Permalink to this definition"></a></dt>
<dd><p>Called when the training ends.
To access all outputs produced during training, cache the data in either trainer and vessel,
and post-process them in this hook.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.trainer.MetricsWriter.on_validate_end">
<span class="sig-name descname"><span class="pre">on_validate_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.Trainer" title="qlib.rl.trainer.Trainer"><span class="pre">Trainer</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vessel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.trainer.TrainingVesselBase" title="qlib.rl.trainer.TrainingVesselBase"><span class="pre">TrainingVesselBase</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.MetricsWriter.on_validate_end" title="Permalink to this definition"></a></dt>
<dd><p>Called when the validation ends.</p>
</dd></dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.rl.trainer.train">
<span class="sig-prename descclassname"><span class="pre">qlib.rl.trainer.</span></span><span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulator_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.Simulator" title="qlib.rl.simulator.Simulator"><span class="pre">Simulator</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.StateInterpreter" title="qlib.rl.interpreter.StateInterpreter"><span class="pre">StateInterpreter</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.ActionInterpreter" title="qlib.rl.interpreter.ActionInterpreter"><span class="pre">ActionInterpreter</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BasePolicy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.Reward" title="qlib.rl.reward.Reward"><span class="pre">Reward</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vessel_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainer_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.train" title="Permalink to this definition"></a></dt>
<dd><p>Train a policy with the parallelism provided by RL framework.</p>
<p>Experimental API. Parameters might change shortly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simulator_fn</strong> – Callable receiving initial seed, returning a simulator.</p></li>
<li><p><strong>state_interpreter</strong> – Interprets the state of simulators.</p></li>
<li><p><strong>action_interpreter</strong> – Interprets the policy actions.</p></li>
<li><p><strong>initial_states</strong> – Initial states to iterate over. Every state will be run exactly once.</p></li>
<li><p><strong>policy</strong> – Policy to train against.</p></li>
<li><p><strong>reward</strong> – Reward function.</p></li>
<li><p><strong>vessel_kwargs</strong> – Keyword arguments passed to <a class="reference internal" href="#qlib.rl.trainer.TrainingVessel" title="qlib.rl.trainer.TrainingVessel"><code class="xref py py-class docutils literal notranslate"><span class="pre">TrainingVessel</span></code></a>, like <code class="docutils literal notranslate"><span class="pre">episode_per_iter</span></code>.</p></li>
<li><p><strong>trainer_kwargs</strong> – Keyword arguments passed to <a class="reference internal" href="#qlib.rl.trainer.Trainer" title="qlib.rl.trainer.Trainer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trainer</span></code></a>, like <code class="docutils literal notranslate"><span class="pre">finite_env_type</span></code>, <code class="docutils literal notranslate"><span class="pre">concurrency</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.rl.trainer.backtest">
<span class="sig-prename descclassname"><span class="pre">qlib.rl.trainer.</span></span><span class="sig-name descname"><span class="pre">backtest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulator_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.Simulator" title="qlib.rl.Simulator"><span class="pre">Simulator</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.StateInterpreter" title="qlib.rl.StateInterpreter"><span class="pre">StateInterpreter</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.ActionInterpreter" title="qlib.rl.ActionInterpreter"><span class="pre">ActionInterpreter</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_states</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BasePolicy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><span class="pre">LogWriter</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><span class="pre">LogWriter</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.Reward" title="qlib.rl.Reward"><span class="pre">Reward</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">finite_env_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FiniteEnvType</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'subproc'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">concurrency</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.trainer.backtest" title="Permalink to this definition"></a></dt>
<dd><p>Backtest with the parallelism provided by RL framework.</p>
<p>Experimental API. Parameters might change shortly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simulator_fn</strong> – Callable receiving initial seed, returning a simulator.</p></li>
<li><p><strong>state_interpreter</strong> – Interprets the state of simulators.</p></li>
<li><p><strong>action_interpreter</strong> – Interprets the policy actions.</p></li>
<li><p><strong>initial_states</strong> – Initial states to iterate over. Every state will be run exactly once.</p></li>
<li><p><strong>policy</strong> – Policy to test against.</p></li>
<li><p><strong>logger</strong> – Logger to record the backtest results. Logger must be present because
without logger, all information will be lost.</p></li>
<li><p><strong>reward</strong> – Optional reward function. For backtest, this is for testing the rewards
and logging them only.</p></li>
<li><p><strong>finite_env_type</strong> – Type of finite env implementation.</p></li>
<li><p><strong>concurrency</strong> – Parallel workers.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</section>
<section id="module-qlib.rl.order_execution">
<span id="order-execution"></span><h3>Order Execution<a class="headerlink" href="#module-qlib.rl.order_execution" title="Permalink to this heading"></a></h3>
<p>Currently it supports single-asset order execution.
Multi-asset is on the way.</p>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.FullHistoryStateInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">FullHistoryStateInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_ticks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">processed_data_provider</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ProcessedDataProvider</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.FullHistoryStateInterpreter" title="Permalink to this definition"></a></dt>
<dd><p>The observation of all the history, including today (until this moment), and yesterday.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>max_step</strong> – Total number of steps (an upper-bound estimation). For example, 390min / 30min-per-step = 13 steps.</p></li>
<li><p><strong>data_ticks</strong> – Equal to the total number of records. For example, in SAOE per minute,
the total ticks is the length of day in minutes.</p></li>
<li><p><strong>data_dim</strong> – Number of dimensions in data.</p></li>
<li><p><strong>processed_data_provider</strong> – Provider of the processed data.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.FullHistoryStateInterpreter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_ticks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">processed_data_provider</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ProcessedDataProvider</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.FullHistoryStateInterpreter.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.FullHistoryStateInterpreter.interpret">
<span class="sig-name descname"><span class="pre">interpret</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.order_execution.SAOEState" title="qlib.rl.order_execution.state.SAOEState"><span class="pre">SAOEState</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">FullHistoryObs</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.FullHistoryStateInterpreter.interpret" title="Permalink to this definition"></a></dt>
<dd><p>Interpret the state of simulator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>simulator_state</strong> – Retrieved with <code class="docutils literal notranslate"><span class="pre">simulator.get_state()</span></code>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>State needed by policy. Should conform with the state space defined in <code class="docutils literal notranslate"><span class="pre">observation_space</span></code>.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.CurrentStepStateInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">CurrentStepStateInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.CurrentStepStateInterpreter" title="Permalink to this definition"></a></dt>
<dd><p>The observation of current step.</p>
<p>Used when policy only depends on the latest state, but not history.
The key list is not full. You can add more if more information is needed by your policy.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.CurrentStepStateInterpreter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.CurrentStepStateInterpreter.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.CurrentStepStateInterpreter.interpret">
<span class="sig-name descname"><span class="pre">interpret</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.order_execution.SAOEState" title="qlib.rl.order_execution.state.SAOEState"><span class="pre">SAOEState</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">CurrentStateObs</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.CurrentStepStateInterpreter.interpret" title="Permalink to this definition"></a></dt>
<dd><p>Interpret the state of simulator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>simulator_state</strong> – Retrieved with <code class="docutils literal notranslate"><span class="pre">simulator.get_state()</span></code>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>State needed by policy. Should conform with the state space defined in <code class="docutils literal notranslate"><span class="pre">observation_space</span></code>.</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.CategoricalActionInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">CategoricalActionInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.CategoricalActionInterpreter" title="Permalink to this definition"></a></dt>
<dd><p>Convert a discrete policy action to a continuous action, then multiplied by <code class="docutils literal notranslate"><span class="pre">order.amount</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>values</strong> – It can be a list of length $L$: $[a_1, a_2, ldots, a_L]$.
Then when policy givens decision $x$, $a_x$ times order amount is the output.
It can also be an integer $n$, in which case the list of length $n+1$ is auto-generated,
i.e., $[0, 1/n, 2/n, ldots, n/n]$.</p></li>
<li><p><strong>max_step</strong> – Total number of steps (an upper-bound estimation). For example, 390min / 30min-per-step = 13 steps.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.CategoricalActionInterpreter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.CategoricalActionInterpreter.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.CategoricalActionInterpreter.interpret">
<span class="sig-name descname"><span class="pre">interpret</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.order_execution.SAOEState" title="qlib.rl.order_execution.state.SAOEState"><span class="pre">SAOEState</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.CategoricalActionInterpreter.interpret" title="Permalink to this definition"></a></dt>
<dd><p>Convert the policy action to simulator action.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simulator_state</strong> – Retrieved with <code class="docutils literal notranslate"><span class="pre">simulator.get_state()</span></code>.</p></li>
<li><p><strong>action</strong> – Raw action given by policy.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>The action needed by simulator,</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.TwapRelativeActionInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">TwapRelativeActionInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.TwapRelativeActionInterpreter" title="Permalink to this definition"></a></dt>
<dd><p>Convert a continuous ratio to deal amount.</p>
<p>The ratio is relative to TWAP on the remainder of the day.
For example, there are 5 steps left, and the left position is 300.
With TWAP strategy, in each position, 60 should be traded.
When this interpreter receives action $a$, its output is $60 cdot a$.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.TwapRelativeActionInterpreter.interpret">
<span class="sig-name descname"><span class="pre">interpret</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.order_execution.SAOEState" title="qlib.rl.order_execution.state.SAOEState"><span class="pre">SAOEState</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.TwapRelativeActionInterpreter.interpret" title="Permalink to this definition"></a></dt>
<dd><p>Convert the policy action to simulator action.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simulator_state</strong> – Retrieved with <code class="docutils literal notranslate"><span class="pre">simulator.get_state()</span></code>.</p></li>
<li><p><strong>action</strong> – Raw action given by policy.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>The action needed by simulator,</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.Recurrent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">Recurrent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FullHistoryObs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rnn_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'rnn'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'lstm'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'gru'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'gru'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rnn_num_layers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.Recurrent" title="Permalink to this definition"></a></dt>
<dd><p>The network architecture proposed in <a class="reference external" href="https://seqml.github.io/opd/opd_aaai21_supplement.pdf">OPD</a>.</p>
<p>At every time step the input of policy network is divided into two parts,
the public variables and the private variables. which are handled by <code class="docutils literal notranslate"><span class="pre">raw_rnn</span></code>
and <code class="docutils literal notranslate"><span class="pre">pri_rnn</span></code> in this network, respectively.</p>
<p>One minor difference is that, in this implementation, we don’t assume the direction to be fixed.
Thus, another <code class="docutils literal notranslate"><span class="pre">dire_fc</span></code> is added to produce an extra direction-related feature.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.Recurrent.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FullHistoryObs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rnn_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'rnn'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'lstm'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'gru'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'gru'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rnn_num_layers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.Recurrent.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Initialize internal Module state, shared by both nn.Module and ScriptModule.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.Recurrent.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Batch</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tensor</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.Recurrent.forward" title="Permalink to this definition"></a></dt>
<dd><p>Input should be a dict (at least) containing:</p>
<ul class="simple">
<li><p>data_processed: [N, T, C]</p></li>
<li><p>cur_step: [N]  (int)</p></li>
<li><p>cur_time: [N]  (int)</p></li>
<li><p>position_history: [N, S]  (S is number of steps)</p></li>
<li><p>target: [N]</p></li>
<li><p>num_step: [N]  (int)</p></li>
<li><p>acquiring: [N]  (0 or 1)</p></li>
</ul>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.AllOne">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">AllOne</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">gym.Space</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">gym.Space</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill_value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.AllOne" title="Permalink to this definition"></a></dt>
<dd><p>Forward returns a batch full of 1.</p>
<p>Useful when implementing some baselines (e.g., TWAP).</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.AllOne.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">gym.Space</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">gym.Space</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill_value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.AllOne.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.AllOne.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Batch</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">np.ndarray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Batch</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.AllOne.forward" title="Permalink to this definition"></a></dt>
<dd><p>Compute action over the given batch data.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Batch</span></code> which MUST have the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">act</span></code> an numpy.ndarray or a torch.Tensor, the action over                 given batch data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state</span></code> a dict, an numpy.ndarray or a torch.Tensor, the                 internal state of the policy, <code class="docutils literal notranslate"><span class="pre">None</span></code> as default.</p></li>
</ul>
</p>
</dd>
</dl>
<p>Other keys are user-defined. It depends on the algorithm. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># some code</span>
<span class="k">return</span> <span class="n">Batch</span><span class="p">(</span><span class="n">logits</span><span class="o">=...</span><span class="p">,</span> <span class="n">act</span><span class="o">=...</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dist</span><span class="o">=...</span><span class="p">)</span>
</pre></div>
</div>
<p>The keyword <code class="docutils literal notranslate"><span class="pre">policy</span></code> is reserved and the corresponding data will be
stored into the replay buffer. For instance,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># some code</span>
<span class="k">return</span> <span class="n">Batch</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="n">Batch</span><span class="p">(</span><span class="n">log_prob</span><span class="o">=</span><span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">act</span><span class="p">)))</span>
<span class="c1"># and in the sampled data batch, you can directly use</span>
<span class="c1"># batch.policy.log_prob to get your data.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In continuous action space, you should do another step “map_action” to get
the real action:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">act</span> <span class="o">=</span> <span class="n">policy</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span><span class="o">.</span><span class="n">act</span>  <span class="c1"># doesn't map to the target action range</span>
<span class="n">act</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">map_action</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.PPO">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">PPO</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">network</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Space</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Space</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_decay</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">discount_factor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_grad_norm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_normalization</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps_clip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_clip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vf_coef</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gae_lambda</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deterministic_eval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.PPO" title="Permalink to this definition"></a></dt>
<dd><p>A wrapper of tianshou PPOPolicy.</p>
<p>Differences:</p>
<ul class="simple">
<li><p>Auto-create actor and critic network. Supports discrete action space only.</p></li>
<li><p>Dedup common parameters between actor network and critic network
(not sure whether this is included in latest tianshou or not).</p></li>
<li><p>Support a <code class="docutils literal notranslate"><span class="pre">weight_file</span></code> that supports loading checkpoint.</p></li>
<li><p>Some parameters’ default values are different from original.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.PPO.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">network</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Space</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_space</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Space</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_decay</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">discount_factor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_grad_norm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_normalization</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps_clip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_clip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vf_coef</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gae_lambda</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deterministic_eval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.PPO.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.PAPenaltyReward">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">PAPenaltyReward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">penalty</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.PAPenaltyReward" title="Permalink to this definition"></a></dt>
<dd><p>Encourage higher PAs, but penalize stacking all the amounts within a very short time.
Formally, for each time step, the reward is <span class="math notranslate nohighlight">\((PA_t * vol_t / target - vol_t^2 * penalty)\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>penalty</strong> – The penalty for large volume in a short time.</p></li>
<li><p><strong>scale</strong> – The weight used to scale up or down the reward.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.PAPenaltyReward.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">penalty</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.PAPenaltyReward.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.PAPenaltyReward.reward">
<span class="sig-name descname"><span class="pre">reward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulator_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.order_execution.SAOEState" title="qlib.rl.order_execution.state.SAOEState"><span class="pre">SAOEState</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.PAPenaltyReward.reward" title="Permalink to this definition"></a></dt>
<dd><p>Implement this method for your own reward.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">SingleAssetOrderExecutionSimple</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_columns_today</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_columns_yesterday</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_granularity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticks_per_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vol_threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple" title="Permalink to this definition"></a></dt>
<dd><p>Single-asset order execution (SAOE) simulator.</p>
<p>As there’s no “calendar” in the simple simulator, ticks are used to trade.
A tick is a record (a line) in the pickle-styled data file.
Each tick is considered as a individual trading opportunity.
If such fine granularity is not needed, use <code class="docutils literal notranslate"><span class="pre">ticks_per_step</span></code> to
lengthen the ticks for each step.</p>
<p>In each step, the traded amount are “equally” separated to each tick,
then bounded by volume maximum execution volume (i.e., <code class="docutils literal notranslate"><span class="pre">vol_threshold</span></code>),
and if it’s the last step, try to ensure all the amount to be executed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>order</strong> – The seed to start an SAOE simulator is an order.</p></li>
<li><p><strong>data_dir</strong> – Path to load backtest data.</p></li>
<li><p><strong>feature_columns_today</strong> – Columns of today’s feature.</p></li>
<li><p><strong>feature_columns_yesterday</strong> – Columns of yesterday’s feature.</p></li>
<li><p><strong>data_granularity</strong> – Number of ticks between consecutive data entries.</p></li>
<li><p><strong>ticks_per_step</strong> – How many ticks per step.</p></li>
<li><p><strong>vol_threshold</strong> – Maximum execution volume (divided by market execution volume).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_columns_today</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_columns_yesterday</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_granularity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticks_per_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vol_threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple.ticks_index">
<span class="sig-name descname"><span class="pre">ticks_index</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.DatetimeIndex</span></em><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple.ticks_index" title="Permalink to this definition"></a></dt>
<dd><p>All available ticks for the day (not restricted to order).</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple.ticks_for_order">
<span class="sig-name descname"><span class="pre">ticks_for_order</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.DatetimeIndex</span></em><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple.ticks_for_order" title="Permalink to this definition"></a></dt>
<dd><p>Ticks that is available for trading (sliced by order).</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple.twap_price">
<span class="sig-name descname"><span class="pre">twap_price</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple.twap_price" title="Permalink to this definition"></a></dt>
<dd><p>This price is used to compute price advantage.
It”s defined as the average price in the period from order”s start time to end time.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple.history_exec">
<span class="sig-name descname"><span class="pre">history_exec</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.DataFrame</span></em><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple.history_exec" title="Permalink to this definition"></a></dt>
<dd><p>All execution history at every possible time ticks. See <a class="reference internal" href="#qlib.rl.order_execution.SAOEMetrics" title="qlib.rl.order_execution.SAOEMetrics"><code class="xref py py-class docutils literal notranslate"><span class="pre">SAOEMetrics</span></code></a> for available columns.
Index is <code class="docutils literal notranslate"><span class="pre">datetime</span></code>.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple.history_steps">
<span class="sig-name descname"><span class="pre">history_steps</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.DataFrame</span></em><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple.history_steps" title="Permalink to this definition"></a></dt>
<dd><p>Positions at each step. The position before first step is also recorded.
See <a class="reference internal" href="#qlib.rl.order_execution.SAOEMetrics" title="qlib.rl.order_execution.SAOEMetrics"><code class="xref py py-class docutils literal notranslate"><span class="pre">SAOEMetrics</span></code></a> for available columns.
Index is <code class="docutils literal notranslate"><span class="pre">datetime</span></code>, which is the <strong>starting</strong> time of each step.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple.metrics">
<span class="sig-name descname"><span class="pre">metrics</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.order_execution.SAOEMetrics" title="qlib.rl.order_execution.SAOEMetrics"><span class="pre">SAOEMetrics</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple.metrics" title="Permalink to this definition"></a></dt>
<dd><p>Metrics. Only available when done.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">amount</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple.step" title="Permalink to this definition"></a></dt>
<dd><p>Execute one step or SAOE.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>amount</strong> – The amount you wish to deal. The simulator doesn’t guarantee all the amount to be successfully dealt.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SingleAssetOrderExecutionSimple.done">
<span class="sig-name descname"><span class="pre">done</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SingleAssetOrderExecutionSimple.done" title="Permalink to this definition"></a></dt>
<dd><p>Check whether the simulator is in a “done” state.
When simulator is in a “done” state,
it should no longer receives any <code class="docutils literal notranslate"><span class="pre">step</span></code> request.
As simulators are ephemeral, to reset the simulator,
the old one should be destroyed and a new simulator can be created.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEStateAdapter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">SAOEStateAdapter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">executor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseExecutor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exchange</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Exchange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticks_per_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backtest_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">IntradayBacktestData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_granularity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.SAOEStateAdapter" title="Permalink to this definition"></a></dt>
<dd><p>Maintain states of the environment. SAOEStateAdapter accepts execution results and update its internal state
according to the execution results with additional information acquired from executors &amp; exchange. For example,
it gets the dealt order amount from execution results, and get the corresponding market price / volume from
exchange.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adapter</span> <span class="o">=</span> <span class="n">SAOEStateAdapter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">adapter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">saoe_state</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEStateAdapter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">executor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseExecutor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exchange</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Exchange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticks_per_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backtest_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">IntradayBacktestData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_granularity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SAOEStateAdapter.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEStateAdapter.generate_metrics_after_done">
<span class="sig-name descname"><span class="pre">generate_metrics_after_done</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SAOEStateAdapter.generate_metrics_after_done" title="Permalink to this definition"></a></dt>
<dd><p>Generate metrics once the upper level execution is done</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">SAOEMetrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics" title="Permalink to this definition"></a></dt>
<dd><p>Metrics for SAOE accumulated for a “period”.
It could be accumulated for a day, or a period of time (e.g., 30min), or calculated separately for every minute.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The type hints are for single elements. In lots of times, they can be vectorized.
For example, <code class="docutils literal notranslate"><span class="pre">market_volume</span></code> could be a list of float (or ndarray) rather tahn a single float.</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.stock_id">
<span class="sig-name descname"><span class="pre">stock_id</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.stock_id" title="Permalink to this definition"></a></dt>
<dd><p>Stock ID of this record.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.datetime">
<span class="sig-name descname"><span class="pre">datetime</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.Timestamp</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">pd.DatetimeIndex</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.datetime" title="Permalink to this definition"></a></dt>
<dd><p>Datetime of this record (this is index in the dataframe).</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.direction">
<span class="sig-name descname"><span class="pre">direction</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.direction" title="Permalink to this definition"></a></dt>
<dd><p>Direction of the order. 0 for sell, 1 for buy.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.market_volume">
<span class="sig-name descname"><span class="pre">market_volume</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.market_volume" title="Permalink to this definition"></a></dt>
<dd><p>(total) market volume traded in the period.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.market_price">
<span class="sig-name descname"><span class="pre">market_price</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.market_price" title="Permalink to this definition"></a></dt>
<dd><p>Deal price. If it’s a period of time, this is the average market deal price.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.amount">
<span class="sig-name descname"><span class="pre">amount</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.amount" title="Permalink to this definition"></a></dt>
<dd><p>Total amount (volume) strategy intends to trade.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.inner_amount">
<span class="sig-name descname"><span class="pre">inner_amount</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.inner_amount" title="Permalink to this definition"></a></dt>
<dd><p>Total amount that the lower-level strategy intends to trade
(might be larger than amount, e.g., to ensure ffr).</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.deal_amount">
<span class="sig-name descname"><span class="pre">deal_amount</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.deal_amount" title="Permalink to this definition"></a></dt>
<dd><p>Amount that successfully takes effect (must be less than inner_amount).</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.trade_price">
<span class="sig-name descname"><span class="pre">trade_price</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.trade_price" title="Permalink to this definition"></a></dt>
<dd><p>The average deal price for this strategy.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.trade_value">
<span class="sig-name descname"><span class="pre">trade_value</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.trade_value" title="Permalink to this definition"></a></dt>
<dd><p>Total worth of trading. In the simple simulation, trade_value = deal_amount * price.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.position">
<span class="sig-name descname"><span class="pre">position</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.position" title="Permalink to this definition"></a></dt>
<dd><p>Position left after this “period”.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.ffr">
<span class="sig-name descname"><span class="pre">ffr</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.ffr" title="Permalink to this definition"></a></dt>
<dd><p>Completed how much percent of the daily order.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEMetrics.pa">
<span class="sig-name descname"><span class="pre">pa</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEMetrics.pa" title="Permalink to this definition"></a></dt>
<dd><p>Price advantage compared to baseline (i.e., trade with baseline market price).
The baseline is trade price when using TWAP strategy to execute this order.
Please note that there could be data leak here).
Unit is BP (basis point, 1/10000).</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">SAOEState</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pd.Timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">history_exec</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pd.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">history_steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pd.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metrics</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.order_execution.SAOEMetrics" title="qlib.rl.order_execution.SAOEMetrics"><span class="pre">SAOEMetrics</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backtest_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseIntradayBacktestData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticks_per_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticks_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pd.DatetimeIndex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticks_for_order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pd.DatetimeIndex</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.SAOEState" title="Permalink to this definition"></a></dt>
<dd><p>Data structure holding a state for SAOE simulator.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.order">
<span class="sig-name descname"><span class="pre">order</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Order</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.order" title="Permalink to this definition"></a></dt>
<dd><p>The order we are dealing with.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.cur_time">
<span class="sig-name descname"><span class="pre">cur_time</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.Timestamp</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.cur_time" title="Permalink to this definition"></a></dt>
<dd><ol class="arabic simple" start="30">
<li></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Current time, e.g., 9</p>
</dd>
</dl>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.cur_step">
<span class="sig-name descname"><span class="pre">cur_step</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.cur_step" title="Permalink to this definition"></a></dt>
<dd><p>Current step, e.g., 0.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.position">
<span class="sig-name descname"><span class="pre">position</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.position" title="Permalink to this definition"></a></dt>
<dd><p>Current remaining volume to execute.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.history_exec">
<span class="sig-name descname"><span class="pre">history_exec</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.DataFrame</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.history_exec" title="Permalink to this definition"></a></dt>
<dd><p>See <code class="xref py py-attr docutils literal notranslate"><span class="pre">SingleAssetOrderExecution.history_exec</span></code>.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.history_steps">
<span class="sig-name descname"><span class="pre">history_steps</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.DataFrame</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.history_steps" title="Permalink to this definition"></a></dt>
<dd><p>See <code class="xref py py-attr docutils literal notranslate"><span class="pre">SingleAssetOrderExecution.history_steps</span></code>.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.metrics">
<span class="sig-name descname"><span class="pre">metrics</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.order_execution.SAOEMetrics" title="qlib.rl.order_execution.SAOEMetrics"><span class="pre">SAOEMetrics</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.metrics" title="Permalink to this definition"></a></dt>
<dd><p>Daily metric, only available when the trading is in “done” state.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.backtest_data">
<span class="sig-name descname"><span class="pre">backtest_data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">BaseIntradayBacktestData</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.backtest_data" title="Permalink to this definition"></a></dt>
<dd><p>Backtest data is included in the state.
Actually, only the time index of this data is needed, at this moment.
I include the full data so that algorithms (e.g., VWAP) that relies on the raw data can be implemented.
Interpreter can use this as they wish, but they should be careful not to leak future data.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.ticks_per_step">
<span class="sig-name descname"><span class="pre">ticks_per_step</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.ticks_per_step" title="Permalink to this definition"></a></dt>
<dd><p>How many ticks for each step.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.ticks_index">
<span class="sig-name descname"><span class="pre">ticks_index</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.DatetimeIndex</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.ticks_index" title="Permalink to this definition"></a></dt>
<dd><p>31, …, 14:59].</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Trading ticks in all day, NOT sliced by order (defined in data). e.g., [9</p>
</dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even"><p>30, 9</p>
</dd>
</dl>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEState.ticks_for_order">
<span class="sig-name descname"><span class="pre">ticks_for_order</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">pd.DatetimeIndex</span></em><a class="headerlink" href="#qlib.rl.order_execution.SAOEState.ticks_for_order" title="Permalink to this definition"></a></dt>
<dd><p>46, …, 14:44].</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Trading ticks sliced by order, e.g., [9</p>
</dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even"><p>45, 9</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">SAOEStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BasePolicy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_granularity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.SAOEStrategy" title="Permalink to this definition"></a></dt>
<dd><p>RL-based strategies that use SAOEState as state.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BasePolicy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_granularity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SAOEStrategy.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>policy</strong> – RL policy for generate action</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEStrategy.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SAOEStrategy.reset" title="Permalink to this definition"></a></dt>
<dd><ul class="simple">
<li><p>reset <cite>level_infra</cite>, used to reset trade calendar, .etc</p></li>
<li><p>reset <cite>common_infra</cite>, used to reset <cite>trade_account</cite>, <cite>trade_exchange</cite>, .etc</p></li>
<li><p>reset <cite>outer_trade_decision</cite>, used to make split decision</p></li>
</ul>
<p><strong>NOTE</strong>:
split this function into <cite>reset</cite> and <cite>_reset</cite> will make following cases more convenient
1. Users want to initialize his strategy by overriding <cite>reset</cite>, but they don’t want to affect the <cite>_reset</cite>
called when initialization</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEStrategy.post_upper_level_exe_step">
<span class="sig-name descname"><span class="pre">post_upper_level_exe_step</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SAOEStrategy.post_upper_level_exe_step" title="Permalink to this definition"></a></dt>
<dd><p>A hook for doing sth after the upper level executor finished its execution (for example, finalize
the metrics collection).</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEStrategy.post_exe_step">
<span class="sig-name descname"><span class="pre">post_exe_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">execute_result</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SAOEStrategy.post_exe_step" title="Permalink to this definition"></a></dt>
<dd><p>A hook for doing sth after the corresponding executor finished its execution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>execute_result</strong> – the execution result</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEStrategy.generate_trade_decision">
<span class="sig-name descname"><span class="pre">generate_trade_decision</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">execute_result</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">BaseTradeDecision</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SAOEStrategy.generate_trade_decision" title="Permalink to this definition"></a></dt>
<dd><p>For SAOEStrategy, we need to update the <cite>self._last_step_range</cite> every time a decision is generated.
This operation should be invisible to developers, so we implement it in <cite>generate_trade_decision()</cite>
The concrete logic to generate decisions should be implemented in <cite>_generate_trade_decision()</cite>.
In other words, all subclass of <cite>SAOEStrategy</cite> should overwrite <cite>_generate_trade_decision()</cite> instead of
<cite>generate_trade_decision()</cite>.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.ProxySAOEStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">ProxySAOEStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.ProxySAOEStrategy" title="Permalink to this definition"></a></dt>
<dd><p>Proxy strategy that uses SAOEState. It is called a ‘proxy’ strategy because it does not make any decisions
by itself. Instead, when the strategy is required to generate a decision, it will yield the environment’s
information and let the outside agents to make the decision. Please refer to <cite>_generate_trade_decision</cite> for
more details.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.ProxySAOEStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.ProxySAOEStrategy.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>policy</strong> – RL policy for generate action</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.ProxySAOEStrategy.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.ProxySAOEStrategy.reset" title="Permalink to this definition"></a></dt>
<dd><ul class="simple">
<li><p>reset <cite>level_infra</cite>, used to reset trade calendar, .etc</p></li>
<li><p>reset <cite>common_infra</cite>, used to reset <cite>trade_account</cite>, <cite>trade_exchange</cite>, .etc</p></li>
<li><p>reset <cite>outer_trade_decision</cite>, used to make split decision</p></li>
</ul>
<p><strong>NOTE</strong>:
split this function into <cite>reset</cite> and <cite>_reset</cite> will make following cases more convenient
1. Users want to initialize his strategy by overriding <cite>reset</cite>, but they don’t want to affect the <cite>_reset</cite>
called when initialization</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEIntStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.order_execution.</span></span><span class="sig-name descname"><span class="pre">SAOEIntStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">BasePolicy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.StateInterpreter" title="qlib.rl.StateInterpreter"><span class="pre">StateInterpreter</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.ActionInterpreter" title="qlib.rl.ActionInterpreter"><span class="pre">ActionInterpreter</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">network</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">torch.nn.Module</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.order_execution.SAOEIntStrategy" title="Permalink to this definition"></a></dt>
<dd><p>(SAOE)state based strategy with (Int)preters.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEIntStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">BasePolicy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.StateInterpreter" title="qlib.rl.StateInterpreter"><span class="pre">StateInterpreter</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.ActionInterpreter" title="qlib.rl.ActionInterpreter"><span class="pre">ActionInterpreter</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">network</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">torch.nn.Module</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LevelInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">common_infra</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CommonInfrastructure</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SAOEIntStrategy.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>policy</strong> – RL policy for generate action</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.order_execution.SAOEIntStrategy.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outer_trade_decision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseTradeDecision</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.order_execution.SAOEIntStrategy.reset" title="Permalink to this definition"></a></dt>
<dd><ul class="simple">
<li><p>reset <cite>level_infra</cite>, used to reset trade calendar, .etc</p></li>
<li><p>reset <cite>common_infra</cite>, used to reset <cite>trade_account</cite>, <cite>trade_exchange</cite>, .etc</p></li>
<li><p>reset <cite>outer_trade_decision</cite>, used to make split decision</p></li>
</ul>
<p><strong>NOTE</strong>:
split this function into <cite>reset</cite> and <cite>_reset</cite> will make following cases more convenient
1. Users want to initialize his strategy by overriding <cite>reset</cite>, but they don’t want to affect the <cite>_reset</cite>
called when initialization</p>
</dd></dl>
</dd></dl>
</section>
<section id="id13">
<h3>Utils<a class="headerlink" href="#id13" title="Permalink to this heading"></a></h3>
<span class="target" id="module-qlib.rl.utils"></span><dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.utils.LogLevel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">LogLevel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.LogLevel" title="Permalink to this definition"></a></dt>
<dd><p>Log-levels for RL training.
The behavior of handling each log level depends on the implementation of <a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogWriter</span></code></a>.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogLevel.DEBUG">
<span class="sig-name descname"><span class="pre">DEBUG</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">10</span></em><a class="headerlink" href="#qlib.rl.utils.LogLevel.DEBUG" title="Permalink to this definition"></a></dt>
<dd><p>If you only want to see the metric in debug mode.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogLevel.PERIODIC">
<span class="sig-name descname"><span class="pre">PERIODIC</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">20</span></em><a class="headerlink" href="#qlib.rl.utils.LogLevel.PERIODIC" title="Permalink to this definition"></a></dt>
<dd><p>If you want to see the metric periodically.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogLevel.INFO">
<span class="sig-name descname"><span class="pre">INFO</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">30</span></em><a class="headerlink" href="#qlib.rl.utils.LogLevel.INFO" title="Permalink to this definition"></a></dt>
<dd><p>Important log messages.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogLevel.CRITICAL">
<span class="sig-name descname"><span class="pre">CRITICAL</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">40</span></em><a class="headerlink" href="#qlib.rl.utils.LogLevel.CRITICAL" title="Permalink to this definition"></a></dt>
<dd><p>LogWriter should always handle CRITICAL messages</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.utils.DataQueue">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">DataQueue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repeat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">producer_num_workers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">queue_maxsize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.DataQueue" title="Permalink to this definition"></a></dt>
<dd><p>Main process (producer) produces data and stores them in a queue.
Sub-processes (consumers) can retrieve the data-points from the queue.
Data-points are generated via reading items from <code class="docutils literal notranslate"><span class="pre">dataset</span></code>.</p>
<p><a class="reference internal" href="#qlib.rl.utils.DataQueue" title="qlib.rl.utils.DataQueue"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataQueue</span></code></a> is ephemeral. You must create a new DataQueue
when the <code class="docutils literal notranslate"><span class="pre">repeat</span></code> is exhausted.</p>
<p>See the documents of <code class="xref py py-class docutils literal notranslate"><span class="pre">qlib.rl.utils.FiniteVectorEnv</span></code> for more background.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> – The dataset to read data from. Must implement <code class="docutils literal notranslate"><span class="pre">__len__</span></code> and <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>.</p></li>
<li><p><strong>repeat</strong> – Iterate over the data-points for how many times. Use <code class="docutils literal notranslate"><span class="pre">-1</span></code> to iterate forever.</p></li>
<li><p><strong>shuffle</strong> – If <code class="docutils literal notranslate"><span class="pre">shuffle</span></code> is true, the items will be read in random order.</p></li>
<li><p><strong>producer_num_workers</strong> – Concurrent workers for data-loading.</p></li>
<li><p><strong>queue_maxsize</strong> – Maximum items to put into queue before it jams.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data_queue</span> <span class="o">=</span> <span class="n">DataQueue</span><span class="p">(</span><span class="n">my_dataset</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">data_queue</span><span class="p">:</span>
<span class="gp">... </span>    <span class="o">...</span>
</pre></div>
</div>
<p>In worker:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_queue</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.DataQueue.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repeat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">producer_num_workers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">queue_maxsize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.DataQueue.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.utils.EnvWrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">EnvWrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulator_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.Simulator" title="qlib.rl.Simulator"><span class="pre">Simulator</span></a><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ActType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.StateInterpreter" title="qlib.rl.StateInterpreter"><span class="pre">StateInterpreter</span></a><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ObsType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.ActionInterpreter" title="qlib.rl.ActionInterpreter"><span class="pre">ActionInterpreter</span></a><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PolicyActType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ActType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed_iterator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.Reward" title="qlib.rl.Reward"><span class="pre">Reward</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aux_info_collector</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">AuxiliaryInfoCollector</span><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.utils.LogCollector" title="qlib.rl.utils.LogCollector"><span class="pre">LogCollector</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.EnvWrapper" title="Permalink to this definition"></a></dt>
<dd><p>Qlib-based RL environment, subclassing <code class="docutils literal notranslate"><span class="pre">gym.Env</span></code>.
A wrapper of components, including simulator, state-interpreter, action-interpreter, reward.</p>
<p>This is what the framework of simulator - interpreter - policy looks like in RL training.
All the components other than policy needs to be assembled into a single object called “environment”.
The “environment” are replicated into multiple workers, and (at least in tianshou’s implementation),
one single policy (agent) plays against a batch of environments.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simulator_fn</strong> – A callable that is the simulator factory.
When <code class="docutils literal notranslate"><span class="pre">seed_iterator</span></code> is present, the factory should take one argument,
that is the seed (aka initial state).
Otherwise, it should take zero argument.</p></li>
<li><p><strong>state_interpreter</strong> – State-observation converter.</p></li>
<li><p><strong>action_interpreter</strong> – Policy-simulator action converter.</p></li>
<li><p><strong>seed_iterator</strong> (<em>str</em><em> | </em><em>Iterator</em><em>[</em><em>InitialStateType</em><em>] </em><em>| </em><em>None</em>) – An iterable of seed. With the help of <a class="reference internal" href="#qlib.rl.utils.DataQueue" title="qlib.rl.utils.DataQueue"><code class="xref py py-class docutils literal notranslate"><span class="pre">qlib.rl.utils.DataQueue</span></code></a>,
environment workers in different processes can share one <code class="docutils literal notranslate"><span class="pre">seed_iterator</span></code>.</p></li>
<li><p><strong>reward_fn</strong> – A callable that accepts the StateType and returns a float (at least in single-agent case).</p></li>
<li><p><strong>aux_info_collector</strong> – Collect auxiliary information. Could be useful in MARL.</p></li>
<li><p><strong>logger</strong> – Log collector that collects the logs. The collected logs are sent back to main process,
via the return value of <code class="docutils literal notranslate"><span class="pre">env.step()</span></code>.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.EnvWrapper.status">
<span class="sig-name descname"><span class="pre">status</span></span><a class="headerlink" href="#qlib.rl.utils.EnvWrapper.status" title="Permalink to this definition"></a></dt>
<dd><p>Status indicator. All terms are in <em>RL language</em>.
It can be used if users care about data on the RL side.
Can be none when no trajectory is available.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#qlib.rl.utils.EnvWrapperStatus" title="qlib.rl.utils.EnvWrapperStatus">EnvWrapperStatus</a></p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.EnvWrapper.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulator_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.Simulator" title="qlib.rl.Simulator"><span class="pre">Simulator</span></a><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ActType</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.StateInterpreter" title="qlib.rl.StateInterpreter"><span class="pre">StateInterpreter</span></a><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ObsType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_interpreter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.ActionInterpreter" title="qlib.rl.ActionInterpreter"><span class="pre">ActionInterpreter</span></a><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PolicyActType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ActType</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed_iterator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">InitialStateType</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.Reward" title="qlib.rl.Reward"><span class="pre">Reward</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aux_info_collector</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">AuxiliaryInfoCollector</span><span class="p"><span class="pre">[</span></span><span class="pre">StateType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.utils.LogCollector" title="qlib.rl.utils.LogCollector"><span class="pre">LogCollector</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.EnvWrapper.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.EnvWrapper.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">ObsType</span></span></span><a class="headerlink" href="#qlib.rl.utils.EnvWrapper.reset" title="Permalink to this definition"></a></dt>
<dd><p>Try to get a state from state queue, and init the simulator with this state.
If the queue is exhausted, generate an invalid (nan) observation.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.EnvWrapper.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy_action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PolicyActType</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">ObsType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">InfoDict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.utils.EnvWrapper.step" title="Permalink to this definition"></a></dt>
<dd><p>Environment step.</p>
<p>See the code along with comments to get a sequence of things happening here.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.EnvWrapper.render">
<span class="sig-name descname"><span class="pre">render</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'human'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.EnvWrapper.render" title="Permalink to this definition"></a></dt>
<dd><p>Compute the render frames as specified by render_mode attribute during initialization of the environment.</p>
<p>The set of supported modes varies per environment. (And some
third-party environments may not support rendering at all.)
By convention, if render_mode is:</p>
<ul class="simple">
<li><p>None (default): no render is computed.</p></li>
<li><p>human: render return None.
The environment is continuously rendered in the current display or terminal. Usually for human consumption.</p></li>
<li><p>rgb_array: return a single frame representing the current state of the environment.
A frame is a numpy.ndarray with shape (x, y, 3) representing RGB values for an x-by-y pixel image.</p></li>
<li><p>rgb_array_list: return a list of frames representing the states of the environment since the last reset.
Each frame is a numpy.ndarray with shape (x, y, 3), as with <cite>rgb_array</cite>.</p></li>
<li><p>ansi: Return a strings (str) or StringIO.StringIO containing a
terminal-style text representation for each time step.
The text can include newlines and ANSI escape sequences (e.g. for colors).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that your class’s metadata ‘render_modes’ key includes
the list of supported modes. It’s recommended to call super()
in implementations to use the functionality of this method.</p>
</div>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.utils.LogCollector">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">LogCollector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">min_loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.LogCollector" title="Permalink to this definition"></a></dt>
<dd><p>Logs are first collected in each environment worker,
and then aggregated to stream at the central thread in vector env.</p>
<p>In <a class="reference internal" href="#qlib.rl.utils.LogCollector" title="qlib.rl.utils.LogCollector"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogCollector</span></code></a>, every metric is added to a dict, which needs to be <code class="docutils literal notranslate"><span class="pre">reset()</span></code> at each step.
The dict is sent via the <code class="docutils literal notranslate"><span class="pre">info</span></code> in <code class="docutils literal notranslate"><span class="pre">env.step()</span></code>, and decoded by the <a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogWriter</span></code></a> at vector env.</p>
<p><code class="docutils literal notranslate"><span class="pre">min_loglevel</span></code> is for optimization purposes: to avoid too much traffic on networks / in pipe.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogCollector.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">min_loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogCollector.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogCollector.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogCollector.reset" title="Permalink to this definition"></a></dt>
<dd><p>Clear all collected contents.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogCollector.add_string">
<span class="sig-name descname"><span class="pre">add_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">string</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogCollector.add_string" title="Permalink to this definition"></a></dt>
<dd><p>Add a string with name into logged contents.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogCollector.add_scalar">
<span class="sig-name descname"><span class="pre">add_scalar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scalar</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogCollector.add_scalar" title="Permalink to this definition"></a></dt>
<dd><p>Add a scalar with name into logged contents.
Scalar will be converted into a float.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogCollector.add_array">
<span class="sig-name descname"><span class="pre">add_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">array</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">pd.DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">pd.Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogCollector.add_array" title="Permalink to this definition"></a></dt>
<dd><p>Add an array with name into logging.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogCollector.add_any">
<span class="sig-name descname"><span class="pre">add_any</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogCollector.add_any" title="Permalink to this definition"></a></dt>
<dd><p>Log something with any type.</p>
<p>As it’s an “any” object, the only LogWriter accepting it is pickle.
Therefore, pickle must be able to serialize it.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">LogWriter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.LogWriter" title="Permalink to this definition"></a></dt>
<dd><p>Base class for log writers, triggered at every reset and step by finite env.</p>
<p>What to do with a specific log depends on the implementation of subclassing <a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogWriter</span></code></a>.
The general principle is that, it should handle logs above its loglevel (inclusive),
and discard logs that are not acceptable. For instance, console loggers obviously can’t handle an image.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.episode_count">
<span class="sig-name descname"><span class="pre">episode_count</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.utils.LogWriter.episode_count" title="Permalink to this definition"></a></dt>
<dd><p>Counter of episodes.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.step_count">
<span class="sig-name descname"><span class="pre">step_count</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.utils.LogWriter.step_count" title="Permalink to this definition"></a></dt>
<dd><p>Counter of steps.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.active_env_ids">
<span class="sig-name descname"><span class="pre">active_env_ids</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Set</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.rl.utils.LogWriter.active_env_ids" title="Permalink to this definition"></a></dt>
<dd><p>Active environment ids in vector env.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.global_step">
<span class="sig-name descname"><span class="pre">global_step</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.utils.LogWriter.global_step" title="Permalink to this definition"></a></dt>
<dd><p>Counter of steps. Won”t be cleared in <code class="docutils literal notranslate"><span class="pre">clear</span></code>.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.global_episode">
<span class="sig-name descname"><span class="pre">global_episode</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.utils.LogWriter.global_episode" title="Permalink to this definition"></a></dt>
<dd><p>Counter of episodes. Won”t be cleared in <code class="docutils literal notranslate"><span class="pre">clear</span></code>.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.episode_lengths">
<span class="sig-name descname"><span class="pre">episode_lengths</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.rl.utils.LogWriter.episode_lengths" title="Permalink to this definition"></a></dt>
<dd><p>Map from environment id to episode length.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.episode_rewards">
<span class="sig-name descname"><span class="pre">episode_rewards</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.rl.utils.LogWriter.episode_rewards" title="Permalink to this definition"></a></dt>
<dd><p>Map from environment id to episode total reward.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.episode_logs">
<span class="sig-name descname"><span class="pre">episode_logs</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.rl.utils.LogWriter.episode_logs" title="Permalink to this definition"></a></dt>
<dd><p>Map from environment id to episode logs.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.LogWriter.clear" title="Permalink to this definition"></a></dt>
<dd><p>Clear all the metrics for a fresh start.
To make the logger instance reusable.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.state_dict">
<span class="sig-name descname"><span class="pre">state_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Save the states of the logger to a dict.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.load_state_dict">
<span class="sig-name descname"><span class="pre">load_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.load_state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Load the states of current logger from a dict.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.aggregation">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">aggregation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.aggregation" title="Permalink to this definition"></a></dt>
<dd><p>Aggregation function from step-wise to episode-wise.</p>
<p>If it’s a sequence of float, take the mean.
Otherwise, take the first element.</p>
<p>If a name is specified and,</p>
<ul class="simple">
<li><p>if it’s <code class="docutils literal notranslate"><span class="pre">reward</span></code>, the reduction will be sum.</p></li>
</ul>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.log_episode">
<span class="sig-name descname"><span class="pre">log_episode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rewards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.log_episode" title="Permalink to this definition"></a></dt>
<dd><p>This is triggered at the end of each trajectory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>length</strong> – Length of this trajectory.</p></li>
<li><p><strong>rewards</strong> – A list of rewards at each step of this episode.</p></li>
<li><p><strong>contents</strong> – Logged contents for every step.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.log_step">
<span class="sig-name descname"><span class="pre">log_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reward</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.log_step" title="Permalink to this definition"></a></dt>
<dd><p>This is triggered at each step.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reward</strong> – Reward for this step.</p></li>
<li><p><strong>contents</strong> – Logged contents for this step.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.on_env_step">
<span class="sig-name descname"><span class="pre">on_env_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ObsType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rew</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">done</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">info</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">InfoDict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.on_env_step" title="Permalink to this definition"></a></dt>
<dd><p>Callback for finite env, on each step.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.on_env_reset">
<span class="sig-name descname"><span class="pre">on_env_reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ObsType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.on_env_reset" title="Permalink to this definition"></a></dt>
<dd><p>Callback for finite env.</p>
<p>Reset episode statistics. Nothing task-specific is logged here because of
<a class="reference external" href="https://github.com/thu-ml/tianshou/issues/605">a limitation of tianshou</a>.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.on_env_all_ready">
<span class="sig-name descname"><span class="pre">on_env_all_ready</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.on_env_all_ready" title="Permalink to this definition"></a></dt>
<dd><p>When all environments are ready to run.
Usually, loggers should be reset here.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogWriter.on_env_all_done">
<span class="sig-name descname"><span class="pre">on_env_all_done</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogWriter.on_env_all_done" title="Permalink to this definition"></a></dt>
<dd><p>All done. Time for cleanup.</p>
</dd></dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="qlib.rl.utils.vectorize_env">
<span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">vectorize_env</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">gym.Env</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FiniteEnvType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">concurrency</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><span class="pre">LogWriter</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#qlib.rl.utils.LogWriter" title="qlib.rl.utils.LogWriter"><span class="pre">LogWriter</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">FiniteVectorEnv</span></span></span><a class="headerlink" href="#qlib.rl.utils.vectorize_env" title="Permalink to this definition"></a></dt>
<dd><p>Helper function to create a vector env. Can be used to replace usual VectorEnv.</p>
<p>For example, once you wrote:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DummyVectorEnv</span><span class="p">([</span><span class="k">lambda</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">env_num</span><span class="p">)])</span>
</pre></div>
</div>
<p>Now you can replace it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">finite_env_factory</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">task</span><span class="p">),</span> <span class="s2">"dummy"</span><span class="p">,</span> <span class="n">env_num</span><span class="p">,</span> <span class="n">my_logger</span><span class="p">)</span>
</pre></div>
</div>
<p>By doing such replacement, you have two additional features enabled (compared to normal VectorEnv):</p>
<ol class="arabic simple">
<li><p>The vector env will check for NaN observation and kill the worker when its found.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">FiniteVectorEnv</span></code> for why we need this.</p></li>
<li><p>A logger to explicit collect logs from environment workers.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>env_factory</strong> – Callable to instantiate one single <code class="docutils literal notranslate"><span class="pre">gym.Env</span></code>.
All concurrent workers will have the same <code class="docutils literal notranslate"><span class="pre">env_factory</span></code>.</p></li>
<li><p><strong>env_type</strong> – dummy or subproc or shmem. Corresponding to
<a class="reference external" href="https://tianshou.readthedocs.io/en/master/api/tianshou.env.html#vectorenv">parallelism in tianshou</a>.</p></li>
<li><p><strong>concurrency</strong> – Concurrent environment workers.</p></li>
<li><p><strong>logger</strong> – Log writers.</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please do not use lambda expression here for <code class="docutils literal notranslate"><span class="pre">env_factory</span></code> as it may create incorrectly-shared instances.</p>
<p>Don’t do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vectorize_env</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">EnvWrapper</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Please do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">env_factory</span><span class="p">():</span> <span class="o">...</span>
<span class="n">vectorize_env</span><span class="p">(</span><span class="n">env_factory</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.utils.ConsoleWriter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">ConsoleWriter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_every_n_episode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">total_episodes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">float_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">':.4f'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">counter_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">':4d'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.ConsoleWriter" title="Permalink to this definition"></a></dt>
<dd><p>Write log messages to console periodically.</p>
<p>It tracks an average meter for each metric, which is the average value since last <code class="docutils literal notranslate"><span class="pre">clear()</span></code> till now.
The display format for each metric is <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span> <span class="pre">&lt;latest_value&gt;</span> <span class="pre">(&lt;average_value&gt;)</span></code>.</p>
<p>Non-single-number metrics are auto skipped.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.ConsoleWriter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_every_n_episode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">total_episodes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">float_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">':.4f'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">counter_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">':4d'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.ConsoleWriter.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.ConsoleWriter.prefix">
<span class="sig-name descname"><span class="pre">prefix</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#qlib.rl.utils.ConsoleWriter.prefix" title="Permalink to this definition"></a></dt>
<dd><p>Prefix can be set via <code class="docutils literal notranslate"><span class="pre">writer.prefix</span></code>.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.ConsoleWriter.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.ConsoleWriter.clear" title="Permalink to this definition"></a></dt>
<dd><p>Clear all the metrics for a fresh start.
To make the logger instance reusable.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.ConsoleWriter.log_episode">
<span class="sig-name descname"><span class="pre">log_episode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rewards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.ConsoleWriter.log_episode" title="Permalink to this definition"></a></dt>
<dd><p>This is triggered at the end of each trajectory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>length</strong> – Length of this trajectory.</p></li>
<li><p><strong>rewards</strong> – A list of rewards at each step of this episode.</p></li>
<li><p><strong>contents</strong> – Logged contents for every step.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.utils.CsvWriter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">CsvWriter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.CsvWriter" title="Permalink to this definition"></a></dt>
<dd><p>Dump all episode metrics to a <code class="docutils literal notranslate"><span class="pre">result.csv</span></code>.</p>
<p>This is not the correct implementation. It’s only used for first iteration.</p>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.CsvWriter.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.CsvWriter.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.CsvWriter.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.CsvWriter.clear" title="Permalink to this definition"></a></dt>
<dd><p>Clear all the metrics for a fresh start.
To make the logger instance reusable.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.CsvWriter.log_episode">
<span class="sig-name descname"><span class="pre">log_episode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rewards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.CsvWriter.log_episode" title="Permalink to this definition"></a></dt>
<dd><p>This is triggered at the end of each trajectory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>length</strong> – Length of this trajectory.</p></li>
<li><p><strong>rewards</strong> – A list of rewards at each step of this episode.</p></li>
<li><p><strong>contents</strong> – Logged contents for every step.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.CsvWriter.on_env_all_done">
<span class="sig-name descname"><span class="pre">on_env_all_done</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.CsvWriter.on_env_all_done" title="Permalink to this definition"></a></dt>
<dd><p>All done. Time for cleanup.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.utils.EnvWrapperStatus">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">EnvWrapperStatus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.EnvWrapperStatus" title="Permalink to this definition"></a></dt>
<dd><p>This is the status data structure used in EnvWrapper.
The fields here are in the semantics of RL.
For example, <code class="docutils literal notranslate"><span class="pre">obs</span></code> means the observation fed into policy.
<code class="docutils literal notranslate"><span class="pre">action</span></code> means the raw action returned by policy.</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">qlib.rl.utils.</span></span><span class="sig-name descname"><span class="pre">LogBuffer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogBuffer" title="qlib.rl.utils.LogBuffer"><span class="pre">LogBuffer</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.LogBuffer" title="Permalink to this definition"></a></dt>
<dd><p>Keep all numbers in memory.</p>
<p>Objects that can’t be aggregated like strings, tensors, images can’t be stored in the buffer.
To persist them, please use <code class="xref py py-class docutils literal notranslate"><span class="pre">PickleWriter</span></code>.</p>
<p>Every time, Log buffer receives a new metric, the callback is triggered,
which is useful when tracking metrics inside a trainer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>callback</strong> – <p>A callback receiving three arguments:</p>
<ul class="simple">
<li><p>on_episode: Whether it’s called at the end of an episode</p></li>
<li><p>on_collect: Whether it’s called at the end of a collect</p></li>
<li><p>log_buffer: the <code class="xref py py-class docutils literal notranslate"><span class="pre">LogBbuffer</span></code> object</p></li>
</ul>
<p>No return value is expected.</p>
</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogBuffer" title="qlib.rl.utils.LogBuffer"><span class="pre">LogBuffer</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loglevel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#qlib.rl.utils.LogLevel" title="qlib.rl.utils.LogLevel"><span class="pre">LogLevel</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LogLevel.PERIODIC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.LogBuffer.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.state_dict">
<span class="sig-name descname"><span class="pre">state_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogBuffer.state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Save the states of the logger to a dict.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.load_state_dict">
<span class="sig-name descname"><span class="pre">load_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogBuffer.load_state_dict" title="Permalink to this definition"></a></dt>
<dd><p>Load the states of current logger from a dict.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#qlib.rl.utils.LogBuffer.clear" title="Permalink to this definition"></a></dt>
<dd><p>Clear all the metrics for a fresh start.
To make the logger instance reusable.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.log_episode">
<span class="sig-name descname"><span class="pre">log_episode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rewards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogBuffer.log_episode" title="Permalink to this definition"></a></dt>
<dd><p>This is triggered at the end of each trajectory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>length</strong> – Length of this trajectory.</p></li>
<li><p><strong>rewards</strong> – A list of rewards at each step of this episode.</p></li>
<li><p><strong>contents</strong> – Logged contents for every step.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.on_env_all_done">
<span class="sig-name descname"><span class="pre">on_env_all_done</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#qlib.rl.utils.LogBuffer.on_env_all_done" title="Permalink to this definition"></a></dt>
<dd><p>All done. Time for cleanup.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.episode_metrics">
<span class="sig-name descname"><span class="pre">episode_metrics</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.utils.LogBuffer.episode_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Retrieve the numeric metrics of the latest episode.</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.collect_metrics">
<span class="sig-name descname"><span class="pre">collect_metrics</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#qlib.rl.utils.LogBuffer.collect_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Retrieve the aggregated metrics of the latest collect.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.episode_count">
<span class="sig-name descname"><span class="pre">episode_count</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.utils.LogBuffer.episode_count" title="Permalink to this definition"></a></dt>
<dd><p>Counter of episodes.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.step_count">
<span class="sig-name descname"><span class="pre">step_count</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.utils.LogBuffer.step_count" title="Permalink to this definition"></a></dt>
<dd><p>Counter of steps.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.global_step">
<span class="sig-name descname"><span class="pre">global_step</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.utils.LogBuffer.global_step" title="Permalink to this definition"></a></dt>
<dd><p>Counter of steps. Won”t be cleared in <code class="docutils literal notranslate"><span class="pre">clear</span></code>.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.global_episode">
<span class="sig-name descname"><span class="pre">global_episode</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#qlib.rl.utils.LogBuffer.global_episode" title="Permalink to this definition"></a></dt>
<dd><p>Counter of episodes. Won”t be cleared in <code class="docutils literal notranslate"><span class="pre">clear</span></code>.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.active_env_ids">
<span class="sig-name descname"><span class="pre">active_env_ids</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Set</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.rl.utils.LogBuffer.active_env_ids" title="Permalink to this definition"></a></dt>
<dd><p>Active environment ids in vector env.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.episode_lengths">
<span class="sig-name descname"><span class="pre">episode_lengths</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.rl.utils.LogBuffer.episode_lengths" title="Permalink to this definition"></a></dt>
<dd><p>Map from environment id to episode length.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.episode_rewards">
<span class="sig-name descname"><span class="pre">episode_rewards</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.rl.utils.LogBuffer.episode_rewards" title="Permalink to this definition"></a></dt>
<dd><p>Map from environment id to episode total reward.</p>
</dd></dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="qlib.rl.utils.LogBuffer.episode_logs">
<span class="sig-name descname"><span class="pre">episode_logs</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#qlib.rl.utils.LogBuffer.episode_logs" title="Permalink to this definition"></a></dt>
<dd><p>Map from environment id to episode logs.</p>
</dd></dl>
</dd></dl>
</section>
</section>
</section>
</div>
</body>
</html>
